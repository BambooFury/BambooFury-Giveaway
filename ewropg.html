<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BambooFury Twitch Giveaways</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Poppins:wght@500;600;700&display=swap" rel="stylesheet">
    <style>
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }
        
        @keyframes rainbow {
            0% { background-position: 0% 50%; }
            100% { background-position: 100% 50%; }
        }
        
        .twitch-gradient {
            background: linear-gradient(135deg, #9146FF 0%, #9B59B6 30%, #E91E63 60%, #F368E0 100%);
            background-size: 300% 300%;
            animation: rainbow 8s ease infinite;
        }
        
        .neon-border {
            box-shadow: 0 0 10px rgba(145, 70, 255, 0.6), 0 0 20px rgba(145, 70, 255, 0.4);
        }
        
        .neon-text {
            text-shadow: 0 0 5px rgba(145, 70, 255, 0.7), 0 0 10px rgba(145, 70, 255, 0.5);
        }
        
        .celebrate-animation {
            animation: pulse 1s infinite, rainbow 5s linear infinite;
        }
        
        .chat-message {
            transition: all 0.3s ease;
        }
        
        .chat-message:hover {
            transform: translateX(5px);
        }
        
        /* Moderation buttons styling */
        .mod-action {
            font-size: 16px;
            transition: all 0.3s ease;
            border-radius: 8px;
            padding: 6px 8px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid transparent;
            backdrop-filter: blur(10px);
            position: relative;
            overflow: hidden;
        }
        
        .mod-action::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: left 0.5s;
        }
        
        .mod-action:hover::before {
            left: 100%;
        }
        
        .mod-action:hover {
            transform: scale(1.15) translateY(-2px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.3);
        }
        
        .mod-action:active {
            transform: scale(0.95);
        }
        
        /* Specific button styles */
        .mod-warn {
            background: linear-gradient(135deg, rgba(245, 158, 11, 0.2) 0%, rgba(217, 119, 6, 0.2) 100%);
            border-color: rgba(245, 158, 11, 0.3);
            color: #FCD34D;
        }
        
        .mod-warn:hover {
            background: linear-gradient(135deg, rgba(245, 158, 11, 0.3) 0%, rgba(217, 119, 6, 0.3) 100%);
            border-color: rgba(245, 158, 11, 0.5);
            box-shadow: 0 8px 25px rgba(245, 158, 11, 0.4);
        }
        
        .mod-timeout {
            background: linear-gradient(135deg, rgba(251, 146, 60, 0.2) 0%, rgba(234, 88, 12, 0.2) 100%);
            border-color: rgba(251, 146, 60, 0.3);
            color: #FED7AA;
        }
        
        .mod-timeout:hover {
            background: linear-gradient(135deg, rgba(251, 146, 60, 0.3) 0%, rgba(234, 88, 12, 0.3) 100%);
            border-color: rgba(251, 146, 60, 0.5);
            box-shadow: 0 8px 25px rgba(251, 146, 60, 0.4);
        }
        
        .mod-ban {
            background: linear-gradient(135deg, rgba(239, 68, 68, 0.2) 0%, rgba(220, 38, 38, 0.2) 100%);
            border-color: rgba(239, 68, 68, 0.3);
            color: #FCA5A5;
        }
        
        .mod-ban:hover {
            background: linear-gradient(135deg, rgba(239, 68, 68, 0.3) 0%, rgba(220, 38, 38, 0.3) 100%);
            border-color: rgba(239, 68, 68, 0.5);
            box-shadow: 0 8px 25px rgba(239, 68, 68, 0.4);
        }
        
        /* Moderation status badges styling */
        .mod-badge {
            display: inline-block;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 10px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            border: 1px solid;
            position: relative;
            backdrop-filter: blur(5px);
            animation: modBadgeGlow 2s ease-in-out infinite alternate;
        }
        
        .mod-badge-warned {
            background: linear-gradient(135deg, rgba(245, 158, 11, 0.8) 0%, rgba(217, 119, 6, 0.9) 100%);
            border-color: rgba(245, 158, 11, 0.6);
            color: #FFFBEB;
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.8);
            box-shadow: 
                0 2px 8px rgba(245, 158, 11, 0.4),
                inset 0 1px 0 rgba(255, 255, 255, 0.2);
        }
        
        .mod-badge-timeout {
            background: linear-gradient(135deg, rgba(251, 146, 60, 0.8) 0%, rgba(234, 88, 12, 0.9) 100%);
            border-color: rgba(251, 146, 60, 0.6);
            color: #FFF7ED;
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.8);
            box-shadow: 
                0 2px 8px rgba(251, 146, 60, 0.4),
                inset 0 1px 0 rgba(255, 255, 255, 0.2);
        }
        
        .mod-badge-banned {
            background: linear-gradient(135deg, rgba(239, 68, 68, 0.8) 0%, rgba(220, 38, 38, 0.9) 100%);
            border-color: rgba(239, 68, 68, 0.6);
            color: #FEF2F2;
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.8);
            box-shadow: 
                0 2px 8px rgba(239, 68, 68, 0.4),
                inset 0 1px 0 rgba(255, 255, 255, 0.2);
        }
        
        @keyframes modBadgeGlow {
            0% {
                box-shadow: 
                    0 2px 8px rgba(var(--glow-color), 0.4),
                    inset 0 1px 0 rgba(255, 255, 255, 0.2);
            }
            100% {
                box-shadow: 
                    0 4px 16px rgba(var(--glow-color), 0.6),
                    0 0 0 1px rgba(var(--glow-color), 0.3),
                    inset 0 1px 0 rgba(255, 255, 255, 0.3);
            }
        }
        
        .mod-badge-warned {
            --glow-color: 245, 158, 11;
        }
        
        .mod-badge-timeout {
            --glow-color: 251, 146, 60;
        }
        
        .mod-badge-banned {
            --glow-color: 239, 68, 68;
        }
        
        /* Disconnect button styling */
        #disconnectBtn {
            border-radius: 8px;
        }
        
        #disconnectBtn:hover {
            background: rgba(239, 68, 68, 0.1);
        }
        
        /* Clear winners button styling */
        #clearWinnersBtn {
            position: relative;
            overflow: hidden;
        }
        
        #clearWinnersBtn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(239, 68, 68, 0.3), transparent);
            transition: left 0.5s;
        }
        
        #clearWinnersBtn:hover::before {
            left: 100%;
        }
        
        #clearWinnersBtn:active {
            transform: scale(0.95);
        }
        
        /* Confirmation modal styling */
        .confirm-modal {
            backdrop-filter: blur(10px);
            animation: modalFadeIn 0.3s ease-out;
        }
        
        @keyframes modalFadeIn {
            from {
                opacity: 0;
                transform: scale(0.9);
            }
            to {
                opacity: 1;
                transform: scale(1);
            }
        }
        
        .confirm-modal-content {
            animation: modalSlideUp 0.3s ease-out;
        }
        
        @keyframes modalSlideUp {
            from {
                transform: translateY(30px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }
        
        @keyframes modalFadeOut {
            from {
                opacity: 1;
                transform: scale(1);
            }
            to {
                opacity: 0;
                transform: scale(0.9);
            }
        }
        
        .sidebar {
            transition: transform 0.3s ease;
        }
        
        .floating-btn {
            position: fixed;
            bottom: 2rem;
            right: 2rem;
            z-index: 50;
            transition: all 0.3s ease;
        }
        
        .floating-btn:hover {
            transform: translateY(-5px) scale(1.05);
        }
        
        .slide-in {
            animation: slideIn 0.5s forwards;
        }
        
        @keyframes slideIn {
            from { transform: translateY(20px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        
        .success-message {
            background: linear-gradient(135deg, #10B981 0%, #059669 100%);
            border: 1px solid rgba(16, 185, 129, 0.3);
            box-shadow: 0 4px 15px rgba(16, 185, 129, 0.2);
        }
        
        .error-message {
            background: linear-gradient(135deg, #EF4444 0%, #DC2626 100%);
            border: 1px solid rgba(239, 68, 68, 0.3);
            box-shadow: 0 4px 15px rgba(239, 68, 68, 0.2);
        }
        
        /* Custom scrollbar for chat */
        #chatContainer::-webkit-scrollbar {
            width: 8px;
        }
        
        #chatContainer::-webkit-scrollbar-track {
            background: #1f2937;
            border-radius: 4px;
        }
        
        #chatContainer::-webkit-scrollbar-thumb {
            background: #374151;
            border-radius: 4px;
        }
        
        #chatContainer::-webkit-scrollbar-thumb:hover {
            background: #4b5563;
        }
        
        /* Custom scrollbar for winner chat */
        #winnerChatContainer::-webkit-scrollbar {
            width: 6px;
        }
        
        #winnerChatContainer::-webkit-scrollbar-track {
            background: #374151;
            border-radius: 3px;
        }
        
        #winnerChatContainer::-webkit-scrollbar-thumb {
            background: #4b5563;
            border-radius: 3px;
        }
        
        #winnerChatContainer::-webkit-scrollbar-thumb:hover {
            background: #6b7280;
        }
        
        /* Animated Twitch logo background for auth modal */
        .twitch-bg {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            overflow: hidden;
            z-index: -1;
        }
        
        .twitch-logo {
            position: absolute;
            opacity: 0.08;
            animation: float 20s infinite linear;
            color: #9146FF;
        }
        
        .twitch-logo:nth-child(1) {
            top: 10%;
            left: 10%;
            animation-delay: 0s;
            animation-duration: 25s;
        }
        
        .twitch-logo:nth-child(2) {
            top: 20%;
            left: 80%;
            animation-delay: -5s;
            animation-duration: 30s;
        }
        
        .twitch-logo:nth-child(3) {
            top: 60%;
            left: 15%;
            animation-delay: -10s;
            animation-duration: 35s;
        }
        
        .twitch-logo:nth-child(4) {
            top: 40%;
            left: 70%;
            animation-delay: -15s;
            animation-duration: 28s;
        }
        
        .twitch-logo:nth-child(5) {
            top: 80%;
            left: 50%;
            animation-delay: -20s;
            animation-duration: 22s;
        }
        
        .twitch-logo:nth-child(6) {
            top: 15%;
            left: 45%;
            animation-delay: -8s;
            animation-duration: 32s;
        }
        
        .twitch-logo:nth-child(7) {
            top: 70%;
            left: 85%;
            animation-delay: -12s;
            animation-duration: 26s;
        }
        
        .twitch-logo:nth-child(8) {
            top: 35%;
            left: 20%;
            animation-delay: -18s;
            animation-duration: 24s;
        }
        
        @keyframes float {
            0% {
                transform: translateY(0px) rotate(0deg) scale(1);
                opacity: 0.08;
            }
            25% {
                opacity: 0.12;
                transform: translateY(-5px) rotate(90deg) scale(1.1);
            }
            50% {
                opacity: 0.15;
                transform: translateY(-10px) rotate(180deg) scale(0.9);
            }
            75% {
                opacity: 0.1;
                transform: translateY(-15px) rotate(270deg) scale(1.2);
            }
            100% {
                transform: translateY(-20px) rotate(360deg) scale(1);
                opacity: 0.08;
            }
        }
        
        /* Dashboard animated background */
        .dashboard-bg {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            overflow: hidden;
            z-index: 0;
            opacity: 0.6;
            pointer-events: none;
        }
        
        .dashboard-icon {
            position: absolute;
            animation: dashboardFloat 20s infinite linear;
            opacity: 0.08;
            filter: drop-shadow(0 0 10px rgba(145, 70, 255, 0.3));
        }
        
        /* Twitch and streaming icons for dashboard */
        .dashboard-icon:nth-child(1) {
            top: 5%;
            left: 5%;
            animation-delay: 0s;
            animation-duration: 25s;
            color: #9146FF;
        }
        
        .dashboard-icon:nth-child(2) {
            top: 15%;
            right: 10%;
            animation-delay: -3s;
            animation-duration: 22s;
            color: #FF6B6B;
        }
        
        .dashboard-icon:nth-child(3) {
            top: 35%;
            left: 8%;
            animation-delay: -7s;
            animation-duration: 28s;
            color: #4ECDC4;
        }
        
        .dashboard-icon:nth-child(4) {
            top: 50%;
            right: 15%;
            animation-delay: -12s;
            animation-duration: 24s;
            color: #45B7D1;
        }
        
        .dashboard-icon:nth-child(5) {
            top: 70%;
            left: 12%;
            animation-delay: -16s;
            animation-duration: 30s;
            color: #96CEB4;
        }
        
        .dashboard-icon:nth-child(6) {
            bottom: 15%;
            right: 8%;
            animation-delay: -20s;
            animation-duration: 26s;
            color: #FFEAA7;
        }
        
        .dashboard-icon:nth-child(7) {
            top: 25%;
            left: 50%;
            animation-delay: -9s;
            animation-duration: 32s;
            color: #DDA0DD;
        }
        
        .dashboard-icon:nth-child(8) {
            bottom: 30%;
            left: 35%;
            animation-delay: -14s;
            animation-duration: 27s;
            color: #98D8C8;
        }
        
        .dashboard-icon:nth-child(9) {
            top: 10%;
            left: 75%;
            animation-delay: -18s;
            animation-duration: 29s;
            color: #F7DC6F;
        }
        
        .dashboard-icon:nth-child(10) {
            bottom: 40%;
            right: 25%;
            animation-delay: -22s;
            animation-duration: 23s;
            color: #BB8FCE;
        }
        
        .dashboard-icon:nth-child(11) {
            top: 60%;
            left: 60%;
            animation-delay: -5s;
            animation-duration: 35s;
            color: #9146FF;
        }
        
        .dashboard-icon:nth-child(12) {
            bottom: 10%;
            left: 20%;
            animation-delay: -11s;
            animation-duration: 31s;
            color: #FF6B6B;
        }
        
        .dashboard-icon:nth-child(13) {
            top: 40%;
            right: 40%;
            animation-delay: -25s;
            animation-duration: 33s;
            color: #4ECDC4;
        }
        
        .dashboard-icon:nth-child(14) {
            bottom: 20%;
            right: 50%;
            animation-delay: -8s;
            animation-duration: 21s;
            color: #45B7D1;
        }
        
        .dashboard-icon:nth-child(15) {
            top: 80%;
            left: 80%;
            animation-delay: -15s;
            animation-duration: 34s;
            color: #96CEB4;
        }
        
        @keyframes dashboardFloat {
            0% {
                transform: translateY(0px) rotate(0deg) scale(1);
                opacity: 0.08;
            }
            15% {
                opacity: 0.12;
                transform: translateY(-5px) rotate(54deg) scale(1.05);
            }
            30% {
                opacity: 0.15;
                transform: translateY(-8px) rotate(108deg) scale(0.95);
            }
            45% {
                opacity: 0.18;
                transform: translateY(-12px) rotate(162deg) scale(1.1);
            }
            60% {
                opacity: 0.14;
                transform: translateY(-10px) rotate(216deg) scale(0.9);
            }
            75% {
                opacity: 0.11;
                transform: translateY(-6px) rotate(270deg) scale(1.08);
            }
            90% {
                opacity: 0.09;
                transform: translateY(-3px) rotate(324deg) scale(0.98);
            }
            100% {
                transform: translateY(0px) rotate(360deg) scale(1);
                opacity: 0.08;
            }
        }
        
        /* Floating particles for dashboard */
        .particle {
            position: absolute;
            background: linear-gradient(135deg, #9146FF, #FF6B6B, #4ECDC4, #45B7D1);
            border-radius: 50%;
            animation: particleFloat 20s infinite linear;
            opacity: 0.15;
            filter: blur(1px);
        }
        
        .particle:nth-child(odd) {
            animation-direction: reverse;
        }
        
        .particle:nth-child(3n) {
            background: radial-gradient(circle, #9146FF, #DDA0DD);
        }
        
        .particle:nth-child(4n) {
            background: radial-gradient(circle, #4ECDC4, #96CEB4);
        }
        
        .particle:nth-child(5n) {
            background: radial-gradient(circle, #FF6B6B, #FFEAA7);
        }
        
        @keyframes particleFloat {
            0% {
                transform: translateY(100vh) rotate(0deg) scale(0.8);
                opacity: 0;
            }
            5% {
                opacity: 0.1;
            }
            50% {
                opacity: 0.2;
                transform: translateY(50vh) rotate(180deg) scale(1.2);
            }
            95% {
                opacity: 0.1;
            }
            100% {
                transform: translateY(-100px) rotate(360deg) scale(0.8);
                opacity: 0;
            }
        }
        
        /* Twitch streaming elements */
        .streaming-element {
            position: absolute;
            animation: streamingFloat 15s infinite ease-in-out;
            opacity: 0.1;
            color: #9146FF;
        }
        
        .streaming-element:nth-child(odd) {
            animation-direction: alternate;
        }
        
        @keyframes streamingFloat {
            0%, 100% {
                transform: translateY(0px) rotate(0deg);
                opacity: 0.1;
            }
            25% {
                transform: translateY(-20px) rotate(90deg);
                opacity: 0.2;
            }
            50% {
                transform: translateY(-10px) rotate(180deg);
                opacity: 0.15;
            }
            75% {
                transform: translateY(-30px) rotate(270deg);
                opacity: 0.25;
            }
        }
        
        /* Pulsing effect for special elements */
        .dashboard-pulse {
            animation: dashboardPulse 3s ease-in-out infinite;
        }
        
        @keyframes dashboardPulse {
            0%, 100% {
                opacity: 0.08;
                transform: scale(1);
            }
            50% {
                opacity: 0.2;
                transform: scale(1.05);
            }
        }
        
        /* Pulsing animation for auth modal */
        .auth-modal-pulse {
            animation: authPulse 2s ease-in-out infinite;
        }
        
        @keyframes authPulse {
            0%, 100% {
                box-shadow: 0 0 10px rgba(145, 70, 255, 0.6), 0 0 20px rgba(145, 70, 255, 0.4);
            }
            50% {
                box-shadow: 0 0 20px rgba(145, 70, 255, 0.8), 0 0 40px rgba(145, 70, 255, 0.6);
            }
        }
        
        /* Settings gear rotation animation */
        .settings-gear {
            transition: transform 0.3s ease;
        }
        
        .settings-gear:hover {
            animation: rotateGear 1s ease-in-out infinite;
        }
        
        @keyframes rotateGear {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Custom scrollbar styles */
        .chat-messages::-webkit-scrollbar,
        .winners-list::-webkit-scrollbar,
        .modal-content::-webkit-scrollbar {
            width: 8px;
        }
        
        .chat-messages::-webkit-scrollbar-track,
        .winners-list::-webkit-scrollbar-track,
        .modal-content::-webkit-scrollbar-track {
            background: #374151;
            border-radius: 4px;
        }
        
        .chat-messages::-webkit-scrollbar-thumb,
        .winners-list::-webkit-scrollbar-thumb,
        .modal-content::-webkit-scrollbar-thumb {
            background: #6B7280;
            border-radius: 4px;
        }
        
        .chat-messages::-webkit-scrollbar-thumb:hover,
        .winners-list::-webkit-scrollbar-thumb:hover,
        .modal-content::-webkit-scrollbar-thumb:hover {
            background: #9CA3AF;
        }
        
        /* Giveaway modal background animations */
        .giveaway-bg {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            overflow: hidden;
            z-index: -1;
            opacity: 0.8;
        }
        
        .giveaway-icon {
            position: absolute;
            animation: giveawayFloat 15s infinite linear;
            color: #9146FF;
            opacity: 0.1;
        }
        
        .giveaway-icon:nth-child(1) {
            top: 5%;
            left: 10%;
            animation-delay: 0s;
            animation-duration: 20s;
        }
        
        .giveaway-icon:nth-child(2) {
            top: 15%;
            right: 15%;
            animation-delay: -3s;
            animation-duration: 18s;
        }
        
        .giveaway-icon:nth-child(3) {
            top: 40%;
            left: 5%;
            animation-delay: -6s;
            animation-duration: 22s;
        }
        
        .giveaway-icon:nth-child(4) {
            top: 60%;
            right: 10%;
            animation-delay: -9s;
            animation-duration: 16s;
        }
        
        .giveaway-icon:nth-child(5) {
            bottom: 20%;
            left: 20%;
            animation-delay: -12s;
            animation-duration: 24s;
        }
        
        .giveaway-icon:nth-child(6) {
            bottom: 10%;
            right: 25%;
            animation-delay: -15s;
            animation-duration: 19s;
        }
        
        .giveaway-icon:nth-child(7) {
            top: 25%;
            left: 50%;
            animation-delay: -18s;
            animation-duration: 21s;
        }
        
        @keyframes giveawayFloat {
            0% {
                transform: translateY(0px) rotate(0deg) scale(1);
                opacity: 0.1;
            }
            25% {
                opacity: 0.2;
                transform: translateY(-10px) rotate(90deg) scale(1.1);
            }
            50% {
                opacity: 0.15;
                transform: translateY(-5px) rotate(180deg) scale(0.9);
            }
            75% {
                opacity: 0.25;
                transform: translateY(-15px) rotate(270deg) scale(1.2);
            }
            100% {
                transform: translateY(0px) rotate(360deg) scale(1);
                opacity: 0.1;
            }
        }
        
        /* Sparkle animation for giveaway icons */
        .giveaway-sparkle {
            position: absolute;
            animation: sparkle 3s infinite ease-in-out;
        }
        
        .giveaway-sparkle:nth-child(odd) {
            animation-delay: 0.5s;
        }
        
        .giveaway-sparkle:nth-child(even) {
            animation-delay: 1.5s;
        }
        
        @keyframes sparkle {
            0%, 100% {
                opacity: 0;
                transform: scale(0.5);
            }
            50% {
                opacity: 1;
                transform: scale(1.2);
            }
        }
        
        /* Modal pulse effect */
        .giveaway-modal-pulse {
            animation: giveawayModalPulse 3s ease-in-out infinite;
        }
        
        @keyframes giveawayModalPulse {
            0%, 100% {
                box-shadow: 0 0 15px rgba(147, 51, 234, 0.4), 0 0 30px rgba(147, 51, 234, 0.2);
            }
            50% {
                box-shadow: 0 0 25px rgba(147, 51, 234, 0.6), 0 0 50px rgba(147, 51, 234, 0.4);
            }
        }
        
        /* Owner settings dropdown */
        #ownerSettingsDropdown {
            position: fixed !important;
            z-index: 99999 !important;
            background: rgba(31, 41, 55, 0.98) !important;
            backdrop-filter: blur(15px) !important;
            border: 2px solid rgba(147, 51, 234, 0.8) !important;
            box-shadow: 0 20px 50px rgba(0, 0, 0, 0.8), 0 0 0 1px rgba(147, 51, 234, 0.5) !important;
            transform: translateZ(0) !important;
            will-change: transform !important;
            max-height: 300px !important;
            overflow-y: auto !important;
        }
        
        /* Custom scrollbar for owner dropdown */
        #ownerSettingsDropdown::-webkit-scrollbar {
            width: 8px;
        }
        
        #ownerSettingsDropdown::-webkit-scrollbar-track {
            background: rgba(31, 41, 55, 0.5);
            border-radius: 4px;
        }
        
        #ownerSettingsDropdown::-webkit-scrollbar-thumb {
            background: rgba(147, 51, 234, 0.6);
            border-radius: 4px;
        }
        
        #ownerSettingsDropdown::-webkit-scrollbar-thumb:hover {
            background: rgba(147, 51, 234, 0.8);
        }
        
        /* Custom scrollbar for channel settings modal */
        #channelSettingsModal::-webkit-scrollbar {
            width: 8px;
        }
        
        #channelSettingsModal::-webkit-scrollbar-track {
            background: #1f2937;
            border-radius: 4px;
        }
        
        #channelSettingsModal::-webkit-scrollbar-thumb {
            background: #374151;
            border-radius: 4px;
        }
        
        #channelSettingsModal::-webkit-scrollbar-thumb:hover {
            background: #4b5563;
        }
        
        /* Custom scrollbar for user management modal */
        #userManagementModal::-webkit-scrollbar {
            width: 8px;
        }
        
        #userManagementModal::-webkit-scrollbar-track {
            background: #1f2937;
            border-radius: 4px;
        }
        
        #userManagementModal::-webkit-scrollbar-thumb {
            background: #374151;
            border-radius: 4px;
        }
        
        #userManagementModal::-webkit-scrollbar-thumb:hover {
            background: #4b5563;
        }
        
        /* Ensure the parent container has proper stacking */
        #connectionStatus {
            position: relative !important;
            z-index: 99998 !important;
        }
        
        /* Force dropdown above everything */
        .owner-dropdown-container {
            position: fixed !important;
            z-index: 100000 !important;
            pointer-events: none !important;
        }
        
        .owner-dropdown-container > * {
            pointer-events: auto !important;
        }
    </style>
</head>
<body class="bg-gray-900 text-gray-100 font-sans min-h-screen">
    <!-- Notification Container -->
    <div id="notifications" class="fixed top-4 right-4 z-50 space-y-2"></div>

    <!-- Twitch Auth Modal -->
    <div id="authModal" class="fixed inset-0 bg-black bg-opacity-90 z-50 flex items-center justify-center p-4">
        <!-- Animated Twitch Background -->
        <div class="twitch-bg">
            <div class="twitch-logo">
                <svg width="120" height="120" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M2.149 0l-1.612 4.119v16.836h5.731v3.045h3.224l3.045-3.045h4.657l6.269-6.269v-14.686h-19.313zm17.124 13.612l-3.582 3.582h-5.731l-3.045 3.045v-3.045h-3.582v-15.045h15.045v11.463zm-3.582-7.343v6.262h-2.149v-6.262h2.149zm-5.731 0v6.262h-2.149v-6.262h2.149z"/>
                </svg>
            </div>
            <div class="twitch-logo">
                <svg width="80" height="80" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M2.149 0l-1.612 4.119v16.836h5.731v3.045h3.224l3.045-3.045h4.657l6.269-6.269v-14.686h-19.313zm17.124 13.612l-3.582 3.582h-5.731l-3.045 3.045v-3.045h-3.582v-15.045h15.045v11.463zm-3.582-7.343v6.262h-2.149v-6.262h2.149zm-5.731 0v6.262h-2.149v-6.262h2.149z"/>
                </svg>
            </div>
            <div class="twitch-logo">
                <svg width="100" height="100" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M2.149 0l-1.612 4.119v16.836h5.731v3.045h3.224l3.045-3.045h4.657l6.269-6.269v-14.686h-19.313zm17.124 13.612l-3.582 3.582h-5.731l-3.045 3.045v-3.045h-3.582v-15.045h15.045v11.463zm-3.582-7.343v6.262h-2.149v-6.262h2.149zm-5.731 0v6.262h-2.149v-6.262h2.149z"/>
                </svg>
            </div>
            <div class="twitch-logo">
                <svg width="90" height="90" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M2.149 0l-1.612 4.119v16.836h5.731v3.045h3.224l3.045-3.045h4.657l6.269-6.269v-14.686h-19.313zm17.124 13.612l-3.582 3.582h-5.731l-3.045 3.045v-3.045h-3.582v-15.045h15.045v11.463zm-3.582-7.343v6.262h-2.149v-6.262h2.149zm-5.731 0v6.262h-2.149v-6.262h2.149z"/>
                </svg>
            </div>
            <div class="twitch-logo">
                <svg width="110" height="110" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M2.149 0l-1.612 4.119v16.836h5.731v3.045h3.224l3.045-3.045h4.657l6.269-6.269v-14.686h-19.313zm17.124 13.612l-3.582 3.582h-5.731l-3.045 3.045v-3.045h-3.582v-15.045h15.045v11.463zm-3.582-7.343v6.262h-2.149v-6.262h2.149zm-5.731 0v6.262h-2.149v-6.262h2.149z"/>
                </svg>
            </div>
            <div class="twitch-logo">
                <svg width="75" height="75" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M2.149 0l-1.612 4.119v16.836h5.731v3.045h3.224l3.045-3.045h4.657l6.269-6.269v-14.686h-19.313zm17.124 13.612l-3.582 3.582h-5.731l-3.045 3.045v-3.045h-3.582v-15.045h15.045v11.463zm-3.582-7.343v6.262h-2.149v-6.262h2.149zm-5.731 0v6.262h-2.149v-6.262h2.149z"/>
                </svg>
            </div>
            <div class="twitch-logo">
                <svg width="95" height="95" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M2.149 0l-1.612 4.119v16.836h5.731v3.045h3.224l3.045-3.045h4.657l6.269-6.269v-14.686h-19.313zm17.124 13.612l-3.582 3.582h-5.731l-3.045 3.045v-3.045h-3.582v-15.045h15.045v11.463zm-3.582-7.343v6.262h-2.149v-6.262h2.149zm-5.731 0v6.262h-2.149v-6.262h2.149z"/>
                </svg>
            </div>
            <div class="twitch-logo">
                <svg width="85" height="85" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M2.149 0l-1.612 4.119v16.836h5.731v3.045h3.224l3.045-3.045h4.657l6.269-6.269v-14.686h-19.313zm17.124 13.612l-3.582 3.582h-5.731l-3.045 3.045v-3.045h-3.582v-15.045h15.045v11.463zm-3.582-7.343v6.262h-2.149v-6.262h2.149zm-5.731 0v6.262h-2.149v-6.262h2.149z"/>
                </svg>
            </div>
            
            <!-- Additional decorative elements for auth modal -->
            <div class="twitch-logo" style="top: 5%; right: 5%; animation-duration: 20s; opacity: 0.06;">
                <svg width="60" height="60" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/>
                </svg>
            </div>
            <div class="twitch-logo" style="bottom: 5%; left: 5%; animation-duration: 22s; opacity: 0.06;">
                <svg width="70" height="70" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M21.58 16.09l-1.09-7.66C20.21 6.46 18.52 5 16.53 5H7.47C5.48 5 3.79 6.46 3.51 8.43l-1.09 7.66C2.2 17.63 3.39 19 4.94 19h0c0.68 0 1.32-0.27 1.8-0.75L9 16h6l2.26 2.25c0.48 0.48 1.12 0.75 1.8 0.75h0C20.61 19 21.8 17.63 21.58 16.09z"/>
                </svg>
            </div>
            <div class="twitch-logo" style="bottom: 10%; right: 10%; animation-duration: 26s; opacity: 0.06;">
                <svg width="50" height="50" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/>
                </svg>
            </div>
        </div>
        
        <div class="bg-gray-800 rounded-xl max-w-md w-full p-8 auth-modal-pulse slide-in relative">
            <div class="flex justify-center mb-6">
                <div class="relative">
                    <svg class="w-16 h-16 animate-pulse" viewBox="0 0 24 24" fill="none">
                        <path d="M2.149 0l-1.612 4.119v16.836h5.731v3.045h3.224l3.045-3.045h4.657l6.269-6.269v-14.686h-19.313zm17.124 13.612l-3.582 3.582h-5.731l-3.045 3.045v-3.045h-3.582v-15.045h15.045v11.463zm-3.582-7.343v6.262h-2.149v-6.262h2.149zm-5.731 0v6.262h-2.149v-6.262h2.149z" fill="#9146FF"/>
                    </svg>
                    <div class="absolute inset-0 bg-gradient-to-r from-purple-600 to-pink-600 rounded-full opacity-20 animate-ping"></div>
                </div>
            </div>
            <h2 class="text-2xl font-bold text-center mb-4 neon-text bg-gradient-to-r from-purple-400 to-pink-400 bg-clip-text text-transparent">
                Подключить Twitch аккаунт
            </h2>
            <p class="text-gray-300 mb-6 text-center">
                Для управления розыгрышами нужен доступ к вашему Twitch чату и никнейму.
            </p>
            <button id="twitchAuthBtn" class="w-full bg-gradient-to-r from-[#9146FF] to-[#7d3fd2] hover:from-[#7d3fd2] hover:to-[#6930c3] text-white font-bold py-3 px-4 rounded-lg transition duration-200 transform hover:scale-105 flex items-center justify-center gap-2 shadow-lg hover:shadow-xl">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="#ffffff">
                    <path d="M2.149 0l-1.612 4.119v16.836h5.731v3.045h3.224l3.045-3.045h4.657l6.269-6.269v-14.686h-19.313zm17.124 13.612l-3.582 3.582h-5.731l-3.045 3.045v-3.045h-3.582v-15.045h15.045v11.463zm-3.582-7.343v6.262h-2.149v-6.262h2.149zm-5.731 0v6.262h-2.149v-6.262h2.149z"/>
                </svg>
                Подключить через Twitch
            </button>
            <p class="text-sm text-gray-400 mt-4 text-center">
                Мы запросим только необходимые права для проведения розыгрышей.
            </p>
            
            <!-- Additional features info -->
            <div class="mt-6 space-y-2">
                <div class="flex items-center space-x-2 text-sm text-gray-300">
                    <svg class="w-4 h-4 text-green-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                    </svg>
                    <span>Автоматическое отслеживание участников</span>
                </div>
                <div class="flex items-center space-x-2 text-sm text-gray-300">
                    <svg class="w-4 h-4 text-green-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                    </svg>
                    <span>Честный выбор победителей</span>
                </div>
                <div class="flex items-center space-x-2 text-sm text-gray-300">
                    <svg class="w-4 h-4 text-green-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                    </svg>
                    <span>Реальный счетчик зрителей</span>
                </div>
            </div>
        </div>
    </div>

    <!-- Main Dashboard -->
    <div id="dashboard" class="hidden">
        <!-- Dashboard Animated Background -->
        <div class="dashboard-bg">
            <!-- Twitch and streaming icons -->
            <div class="dashboard-icon">
                <svg width="120" height="120" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M2.149 0l-1.612 4.119v16.836h5.731v3.045h3.224l3.045-3.045h4.657l6.269-6.269v-14.686h-19.313zm17.124 13.612l-3.582 3.582h-5.731l-3.045 3.045v-3.045h-3.582v-15.045h15.045v11.463zm-3.582-7.343v6.262h-2.149v-6.262h2.149zm-5.731 0v6.262h-2.149v-6.262h2.149z"/>
                </svg>
            </div>
            <div class="dashboard-icon dashboard-pulse">
                <svg width="80" height="80" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/>
                </svg>
            </div>
            <div class="dashboard-icon">
                <svg width="100" height="100" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M21.58 16.09l-1.09-7.66C20.21 6.46 18.52 5 16.53 5H7.47C5.48 5 3.79 6.46 3.51 8.43l-1.09 7.66C2.2 17.63 3.39 19 4.94 19h0c0.68 0 1.32-0.27 1.8-0.75L9 16h6l2.26 2.25c0.48 0.48 1.12 0.75 1.8 0.75h0C20.61 19 21.8 17.63 21.58 16.09z"/>
                </svg>
            </div>
            <div class="dashboard-icon dashboard-pulse">
                <svg width="90" height="90" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/>
                </svg>
            </div>
            <div class="dashboard-icon">
                <svg width="110" height="110" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/>
                </svg>
            </div>
            <div class="dashboard-icon">
                <svg width="75" height="75" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zM9 17H7v-7h2v7zm4 0h-2V7h2v10zm4 0h-2v-4h2v4z"/>
                </svg>
            </div>
            <div class="dashboard-icon">
                <svg width="95" height="95" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M2.149 0l-1.612 4.119v16.836h5.731v3.045h3.224l3.045-3.045h4.657l6.269-6.269v-14.686h-19.313zm17.124 13.612l-3.582 3.582h-5.731l-3.045 3.045v-3.045h-3.582v-15.045h15.045v11.463zm-3.582-7.343v6.262h-2.149v-6.262h2.149zm-5.731 0v6.262h-2.149v-6.262h2.149z"/>
                </svg>
            </div>
            <div class="dashboard-icon">
                <svg width="85" height="85" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm3.5 6L12 10.5 8.5 8 12 5.5 15.5 8zM8.5 16L12 13.5 15.5 16 12 18.5 8.5 16z"/>
                </svg>
            </div>
            <div class="dashboard-icon dashboard-pulse">
                <svg width="105" height="105" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M20 4H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm-5 14H4v-4h11v4zm0-5H4V9h11v4zm5 5h-4V9h4v9z"/>
                </svg>
            </div>
            <div class="dashboard-icon">
                <svg width="70" height="70" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 3c1.66 0 3 1.34 3 3s-1.34 3-3 3-3-1.34-3-3 1.34-3 3-3zm0 14.2c-2.5 0-4.71-1.28-6-3.22.03-1.99 4-3.08 6-3.08 1.99 0 5.97 1.09 6 3.08-1.29 1.94-3.5 3.22-6 3.22z"/>
                </svg>
            </div>
            
            <!-- More Twitch icons -->
            <div class="dashboard-icon">
                <svg width="65" height="65" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M2.149 0l-1.612 4.119v16.836h5.731v3.045h3.224l3.045-3.045h4.657l6.269-6.269v-14.686h-19.313zm17.124 13.612l-3.582 3.582h-5.731l-3.045 3.045v-3.045h-3.582v-15.045h15.045v11.463zm-3.582-7.343v6.262h-2.149v-6.262h2.149zm-5.731 0v6.262h-2.149v-6.262h2.149z"/>
                </svg>
            </div>
            <div class="dashboard-icon dashboard-pulse">
                <svg width="88" height="88" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/>
                </svg>
            </div>
            <div class="dashboard-icon">
                <svg width="77" height="77" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M21.58 16.09l-1.09-7.66C20.21 6.46 18.52 5 16.53 5H7.47C5.48 5 3.79 6.46 3.51 8.43l-1.09 7.66C2.2 17.63 3.39 19 4.94 19h0c0.68 0 1.32-0.27 1.8-0.75L9 16h6l2.26 2.25c0.48 0.48 1.12 0.75 1.8 0.75h0C20.61 19 21.8 17.63 21.58 16.09z"/>
                </svg>
            </div>
            <div class="dashboard-icon">
                <svg width="93" height="93" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm3.5 6L12 10.5 8.5 8 12 5.5 15.5 8zM8.5 16L12 13.5 15.5 16 12 18.5 8.5 16z"/>
                </svg>
            </div>
            <div class="dashboard-icon dashboard-pulse">
                <svg width="82" height="82" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M2.149 0l-1.612 4.119v16.836h5.731v3.045h3.224l3.045-3.045h4.657l6.269-6.269v-14.686h-19.313zm17.124 13.612l-3.582 3.582h-5.731l-3.045 3.045v-3.045h-3.582v-15.045h15.045v11.463zm-3.582-7.343v6.262h-2.149v-6.262h2.149zm-5.731 0v6.262h-2.149v-6.262h2.149z"/>
                </svg>
            </div>
            
            <!-- Streaming elements -->
            <div class="streaming-element" style="top: 12%; left: 25%; animation-delay: -2s;">
                <svg width="45" height="45" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M8 5v14l11-7z"/>
                </svg>
            </div>
            <div class="streaming-element" style="top: 65%; right: 20%; animation-delay: -8s;">
                <svg width="38" height="38" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M12 14c1.66 0 2.99-1.34 2.99-3L15 5c0-1.66-1.34-3-3-3S9 3.34 9 5v6c0 1.66 1.34 3 3 3zm5.3-3c0 3-2.54 5.1-5.3 5.1S6.7 14 6.7 11H5c0 3.41 2.72 6.23 6 6.72V21h2v-3.28c3.28-.48 6-3.3 6-6.72h-1.7z"/>
                </svg>
            </div>
            <div class="streaming-element" style="top: 35%; left: 80%; animation-delay: -5s;">
                <svg width="42" height="42" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/>
                </svg>
            </div>
            <div class="streaming-element" style="bottom: 45%; left: 15%; animation-delay: -12s;">
                <svg width="50" height="50" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/>
                </svg>
            </div>
            
            <!-- Enhanced floating particles -->
            <div class="particle" style="width: 6px; height: 6px; top: 8%; left: 18%; animation-delay: 0s;"></div>
            <div class="particle" style="width: 4px; height: 4px; top: 25%; left: 65%; animation-delay: -2s;"></div>
            <div class="particle" style="width: 8px; height: 8px; top: 45%; left: 12%; animation-delay: -4s;"></div>
            <div class="particle" style="width: 5px; height: 5px; top: 65%; left: 75%; animation-delay: -6s;"></div>
            <div class="particle" style="width: 7px; height: 7px; top: 18%; left: 45%; animation-delay: -8s;"></div>
            <div class="particle" style="width: 3px; height: 3px; top: 78%; left: 25%; animation-delay: -10s;"></div>
            <div class="particle" style="width: 6px; height: 6px; top: 38%; left: 85%; animation-delay: -12s;"></div>
            <div class="particle" style="width: 4px; height: 4px; top: 58%; left: 8%; animation-delay: -14s;"></div>
            <div class="particle" style="width: 9px; height: 9px; top: 88%; left: 55%; animation-delay: -16s;"></div>
            <div class="particle" style="width: 5px; height: 5px; top: 15%; left: 78%; animation-delay: -18s;"></div>
            <div class="particle" style="width: 7px; height: 7px; top: 72%; left: 38%; animation-delay: -20s;"></div>
            <div class="particle" style="width: 4px; height: 4px; top: 52%; left: 90%; animation-delay: -22s;"></div>
            <div class="particle" style="width: 6px; height: 6px; top: 28%; left: 3%; animation-delay: -24s;"></div>
            <div class="particle" style="width: 8px; height: 8px; top: 85%; left: 68%; animation-delay: -26s;"></div>
            <div class="particle" style="width: 3px; height: 3px; top: 42%; left: 52%; animation-delay: -28s;"></div>
            <div class="particle" style="width: 5px; height: 5px; top: 95%; left: 15%; animation-delay: -30s;"></div>
            <div class="particle" style="width: 7px; height: 7px; top: 2%; left: 88%; animation-delay: -32s;"></div>
            <div class="particle" style="width: 4px; height: 4px; top: 68%; left: 62%; animation-delay: -34s;"></div>
            <div class="particle" style="width: 6px; height: 6px; top: 32%; left: 28%; animation-delay: -36s;"></div>
            <div class="particle" style="width: 8px; height: 8px; top: 82%; left: 92%; animation-delay: -38s;"></div>
        </div>
        
        <div class="twitch-gradient p-1">
            <div class="bg-gray-900 relative overflow-hidden">
                <!-- Main Content Background Animation -->
                <div class="dashboard-bg">
                    <!-- Twitch and streaming icons -->
                    <div class="dashboard-icon">
                        <svg width="120" height="120" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M2.149 0l-1.612 4.119v16.836h5.731v3.045h3.224l3.045-3.045h4.657l6.269-6.269v-14.686h-19.313zm17.124 13.612l-3.582 3.582h-5.731l-3.045 3.045v-3.045h-3.582v-15.045h15.045v11.463zm-3.582-7.343v6.262h-2.149v-6.262h2.149zm-5.731 0v6.262h-2.149v-6.262h2.149z"/>
                        </svg>
                    </div>
                    <div class="dashboard-icon dashboard-pulse">
                        <svg width="80" height="80" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/>
                        </svg>
                    </div>
                    <div class="dashboard-icon">
                        <svg width="100" height="100" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M21.58 16.09l-1.09-7.66C20.21 6.46 18.52 5 16.53 5H7.47C5.48 5 3.79 6.46 3.51 8.43l-1.09 7.66C2.2 17.63 3.39 19 4.94 19h0c0.68 0 1.32-0.27 1.8-0.75L9 16h6l2.26 2.25c0.48 0.48 1.12 0.75 1.8 0.75h0C20.61 19 21.8 17.63 21.58 16.09z"/>
                        </svg>
                    </div>
                    <div class="dashboard-icon dashboard-pulse">
                        <svg width="90" height="90" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/>
                        </svg>
                    </div>
                    <div class="dashboard-icon">
                        <svg width="110" height="110" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/>
                        </svg>
                    </div>
                    <div class="dashboard-icon">
                        <svg width="75" height="75" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zM9 17H7v-7h2v7zm4 0h-2V7h2v10zm4 0h-2v-4h2v4z"/>
                        </svg>
                    </div>
                    <div class="dashboard-icon">
                        <svg width="95" height="95" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M2.149 0l-1.612 4.119v16.836h5.731v3.045h3.224l3.045-3.045h4.657l6.269-6.269v-14.686h-19.313zm17.124 13.612l-3.582 3.582h-5.731l-3.045 3.045v-3.045h-3.582v-15.045h15.045v11.463zm-3.582-7.343v6.262h-2.149v-6.262h2.149zm-5.731 0v6.262h-2.149v-6.262h2.149z"/>
                        </svg>
                    </div>
                    <div class="dashboard-icon">
                        <svg width="85" height="85" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm3.5 6L12 10.5 8.5 8 12 5.5 15.5 8zM8.5 16L12 13.5 15.5 16 12 18.5 8.5 16z"/>
                        </svg>
                    </div>
                    <div class="dashboard-icon dashboard-pulse">
                        <svg width="105" height="105" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M20 4H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm-5 14H4v-4h11v4zm0-5H4V9h11v4zm5 5h-4V9h4v9z"/>
                        </svg>
                    </div>
                    <div class="dashboard-icon">
                        <svg width="70" height="70" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 3c1.66 0 3 1.34 3 3s-1.34 3-3 3-3-1.34-3-3 1.34-3 3-3zm0 14.2c-2.5 0-4.71-1.28-6-3.22.03-1.99 4-3.08 6-3.08 1.99 0 5.97 1.09 6 3.08-1.29 1.94-3.5 3.22-6 3.22z"/>
                        </svg>
                    </div>
                    
                    <!-- More Twitch icons -->
                    <div class="dashboard-icon">
                        <svg width="65" height="65" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M2.149 0l-1.612 4.119v16.836h5.731v3.045h3.224l3.045-3.045h4.657l6.269-6.269v-14.686h-19.313zm17.124 13.612l-3.582 3.582h-5.731l-3.045 3.045v-3.045h-3.582v-15.045h15.045v11.463zm-3.582-7.343v6.262h-2.149v-6.262h2.149zm-5.731 0v6.262h-2.149v-6.262h2.149z"/>
                        </svg>
                    </div>
                    <div class="dashboard-icon dashboard-pulse">
                        <svg width="88" height="88" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/>
                        </svg>
                    </div>
                    <div class="dashboard-icon">
                        <svg width="77" height="77" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M21.58 16.09l-1.09-7.66C20.21 6.46 18.52 5 16.53 5H7.47C5.48 5 3.79 6.46 3.51 8.43l-1.09 7.66C2.2 17.63 3.39 19 4.94 19h0c0.68 0 1.32-0.27 1.8-0.75L9 16h6l2.26 2.25c0.48 0.48 1.12 0.75 1.8 0.75h0C20.61 19 21.8 17.63 21.58 16.09z"/>
                        </svg>
                    </div>
                    <div class="dashboard-icon">
                        <svg width="93" height="93" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm3.5 6L12 10.5 8.5 8 12 5.5 15.5 8zM8.5 16L12 13.5 15.5 16 12 18.5 8.5 16z"/>
                        </svg>
                    </div>
                    <div class="dashboard-icon dashboard-pulse">
                        <svg width="82" height="82" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M2.149 0l-1.612 4.119v16.836h5.731v3.045h3.224l3.045-3.045h4.657l6.269-6.269v-14.686h-19.313zm17.124 13.612l-3.582 3.582h-5.731l-3.045 3.045v-3.045h-3.582v-15.045h15.045v11.463zm-3.582-7.343v6.262h-2.149v-6.262h2.149zm-5.731 0v6.262h-2.149v-6.262h2.149z"/>
                        </svg>
                    </div>
                    
                    <!-- Streaming elements -->
                    <div class="streaming-element" style="top: 12%; left: 25%; animation-delay: -2s;">
                        <svg width="45" height="45" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M8 5v14l11-7z"/>
                        </svg>
                    </div>
                    <div class="streaming-element" style="top: 65%; right: 20%; animation-delay: -8s;">
                        <svg width="38" height="38" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M12 14c1.66 0 2.99-1.34 2.99-3L15 5c0-1.66-1.34-3-3-3S9 3.34 9 5v6c0 1.66 1.34 3 3 3zm5.3-3c0 3-2.54 5.1-5.3 5.1S6.7 14 6.7 11H5c0 3.41 2.72 6.23 6 6.72V21h2v-3.28c3.28-.48 6-3.3 6-6.72h-1.7z"/>
                        </svg>
                    </div>
                    <div class="streaming-element" style="top: 35%; left: 80%; animation-delay: -5s;">
                        <svg width="42" height="42" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/>
                        </svg>
                    </div>
                    <div class="streaming-element" style="bottom: 45%; left: 15%; animation-delay: -12s;">
                        <svg width="50" height="50" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/>
                        </svg>
                    </div>
                    
                    <!-- Enhanced floating particles -->
                    <div class="particle" style="width: 6px; height: 6px; top: 8%; left: 18%; animation-delay: 0s;"></div>
                    <div class="particle" style="width: 4px; height: 4px; top: 25%; left: 65%; animation-delay: -2s;"></div>
                    <div class="particle" style="width: 8px; height: 8px; top: 45%; left: 12%; animation-delay: -4s;"></div>
                    <div class="particle" style="width: 5px; height: 5px; top: 65%; left: 75%; animation-delay: -6s;"></div>
                    <div class="particle" style="width: 7px; height: 7px; top: 18%; left: 45%; animation-delay: -8s;"></div>
                    <div class="particle" style="width: 3px; height: 3px; top: 78%; left: 25%; animation-delay: -10s;"></div>
                    <div class="particle" style="width: 6px; height: 6px; top: 38%; left: 85%; animation-delay: -12s;"></div>
                    <div class="particle" style="width: 4px; height: 4px; top: 58%; left: 8%; animation-delay: -14s;"></div>
                    <div class="particle" style="width: 9px; height: 9px; top: 88%; left: 55%; animation-delay: -16s;"></div>
                    <div class="particle" style="width: 5px; height: 5px; top: 15%; left: 78%; animation-delay: -18s;"></div>
                    <div class="particle" style="width: 7px; height: 7px; top: 72%; left: 38%; animation-delay: -20s;"></div>
                    <div class="particle" style="width: 4px; height: 4px; top: 52%; left: 90%; animation-delay: -22s;"></div>
                    <div class="particle" style="width: 6px; height: 6px; top: 28%; left: 3%; animation-delay: -24s;"></div>
                    <div class="particle" style="width: 8px; height: 8px; top: 85%; left: 68%; animation-delay: -26s;"></div>
                    <div class="particle" style="width: 3px; height: 3px; top: 42%; left: 52%; animation-delay: -28s;"></div>
                    <div class="particle" style="width: 5px; height: 5px; top: 95%; left: 15%; animation-delay: -30s;"></div>
                    <div class="particle" style="width: 7px; height: 7px; top: 2%; left: 88%; animation-delay: -32s;"></div>
                    <div class="particle" style="width: 4px; height: 4px; top: 68%; left: 62%; animation-delay: -34s;"></div>
                    <div class="particle" style="width: 6px; height: 6px; top: 32%; left: 28%; animation-delay: -36s;"></div>
                    <div class="particle" style="width: 8px; height: 8px; top: 82%; left: 92%; animation-delay: -38s;"></div>
                </div>
                <!-- Dashboard Animated Background for main content area -->
                <div class="dashboard-bg">
                    <!-- Twitch and streaming icons -->
                    <div class="dashboard-icon">
                        <svg width="120" height="120" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M2.149 0l-1.612 4.119v16.836h5.731v3.045h3.224l3.045-3.045h4.657l6.269-6.269v-14.686h-19.313zm17.124 13.612l-3.582 3.582h-5.731l-3.045 3.045v-3.045h-3.582v-15.045h15.045v11.463zm-3.582-7.343v6.262h-2.149v-6.262h2.149zm-5.731 0v6.262h-2.149v-6.262h2.149z"/>
                        </svg>
                    </div>
                    <div class="dashboard-icon dashboard-pulse">
                        <svg width="80" height="80" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/>
                        </svg>
                    </div>
                    <div class="dashboard-icon">
                        <svg width="100" height="100" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M21.58 16.09l-1.09-7.66C20.21 6.46 18.52 5 16.53 5H7.47C5.48 5 3.79 6.46 3.51 8.43l-1.09 7.66C2.2 17.63 3.39 19 4.94 19h0c0.68 0 1.32-0.27 1.8-0.75L9 16h6l2.26 2.25c0.48 0.48 1.12 0.75 1.8 0.75h0C20.61 19 21.8 17.63 21.58 16.09z"/>
                        </svg>
                    </div>
                    <div class="dashboard-icon dashboard-pulse">
                        <svg width="90" height="90" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/>
                        </svg>
                    </div>
                    <div class="dashboard-icon">
                        <svg width="110" height="110" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/>
                        </svg>
                    </div>
                    <div class="dashboard-icon">
                        <svg width="75" height="75" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zM9 17H7v-7h2v7zm4 0h-2V7h2v10zm4 0h-2v-4h2v4z"/>
                        </svg>
                    </div>
                    <div class="dashboard-icon">
                        <svg width="95" height="95" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M2.149 0l-1.612 4.119v16.836h5.731v3.045h3.224l3.045-3.045h4.657l6.269-6.269v-14.686h-19.313zm17.124 13.612l-3.582 3.582h-5.731l-3.045 3.045v-3.045h-3.582v-15.045h15.045v11.463zm-3.582-7.343v6.262h-2.149v-6.262h2.149zm-5.731 0v6.262h-2.149v-6.262h2.149z"/>
                        </svg>
                    </div>
                    <div class="dashboard-icon">
                        <svg width="85" height="85" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm3.5 6L12 10.5 8.5 8 12 5.5 15.5 8zM8.5 16L12 13.5 15.5 16 12 18.5 8.5 16z"/>
                        </svg>
                    </div>
                    <div class="dashboard-icon dashboard-pulse">
                        <svg width="105" height="105" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M20 4H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm-5 14H4v-4h11v4zm0-5H4V9h11v4zm5 5h-4V9h4v9z"/>
                        </svg>
                    </div>
                    <div class="dashboard-icon">
                        <svg width="70" height="70" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 3c1.66 0 3 1.34 3 3s-1.34 3-3 3-3-1.34-3-3 1.34-3 3-3zm0 14.2c-2.5 0-4.71-1.28-6-3.22.03-1.99 4-3.08 6-3.08 1.99 0 5.97 1.09 6 3.08-1.29 1.94-3.5 3.22-6 3.22z"/>
                        </svg>
                    </div>
                    
                    <!-- More Twitch icons -->
                    <div class="dashboard-icon">
                        <svg width="65" height="65" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M2.149 0l-1.612 4.119v16.836h5.731v3.045h3.224l3.045-3.045h4.657l6.269-6.269v-14.686h-19.313zm17.124 13.612l-3.582 3.582h-5.731l-3.045 3.045v-3.045h-3.582v-15.045h15.045v11.463zm-3.582-7.343v6.262h-2.149v-6.262h2.149zm-5.731 0v6.262h-2.149v-6.262h2.149z"/>
                        </svg>
                    </div>
                    <div class="dashboard-icon dashboard-pulse">
                        <svg width="88" height="88" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/>
                        </svg>
                    </div>
                    <div class="dashboard-icon">
                        <svg width="77" height="77" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M21.58 16.09l-1.09-7.66C20.21 6.46 18.52 5 16.53 5H7.47C5.48 5 3.79 6.46 3.51 8.43l-1.09 7.66C2.2 17.63 3.39 19 4.94 19h0c0.68 0 1.32-0.27 1.8-0.75L9 16h6l2.26 2.25c0.48 0.48 1.12 0.75 1.8 0.75h0C20.61 19 21.8 17.63 21.58 16.09z"/>
                        </svg>
                    </div>
                    <div class="dashboard-icon">
                        <svg width="93" height="93" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm3.5 6L12 10.5 8.5 8 12 5.5 15.5 8zM8.5 16L12 13.5 15.5 16 12 18.5 8.5 16z"/>
                        </svg>
                    </div>
                    <div class="dashboard-icon dashboard-pulse">
                        <svg width="82" height="82" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M2.149 0l-1.612 4.119v16.836h5.731v3.045h3.224l3.045-3.045h4.657l6.269-6.269v-14.686h-19.313zm17.124 13.612l-3.582 3.582h-5.731l-3.045 3.045v-3.045h-3.582v-15.045h15.045v11.463zm-3.582-7.343v6.262h-2.149v-6.262h2.149zm-5.731 0v6.262h-2.149v-6.262h2.149z"/>
                        </svg>
                    </div>
                    
                    <!-- Streaming elements -->
                    <div class="streaming-element" style="top: 12%; left: 25%; animation-delay: -2s;">
                        <svg width="45" height="45" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M8 5v14l11-7z"/>
                        </svg>
                    </div>
                    <div class="streaming-element" style="top: 65%; right: 20%; animation-delay: -8s;">
                        <svg width="38" height="38" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M12 14c1.66 0 2.99-1.34 2.99-3L15 5c0-1.66-1.34-3-3-3S9 3.34 9 5v6c0 1.66 1.34 3 3 3zm5.3-3c0 3-2.54 5.1-5.3 5.1S6.7 14 6.7 11H5c0 3.41 2.72 6.23 6 6.72V21h2v-3.28c3.28-.48 6-3.3 6-6.72h-1.7z"/>
                        </svg>
                    </div>
                    <div class="streaming-element" style="top: 35%; left: 80%; animation-delay: -5s;">
                        <svg width="42" height="42" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/>
                        </svg>
                    </div>
                    <div class="streaming-element" style="bottom: 45%; left: 15%; animation-delay: -12s;">
                        <svg width="50" height="50" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/>
                        </svg>
                    </div>
                    
                    <!-- Enhanced floating particles -->
                    <div class="particle" style="width: 6px; height: 6px; top: 8%; left: 18%; animation-delay: 0s;"></div>
                    <div class="particle" style="width: 4px; height: 4px; top: 25%; left: 65%; animation-delay: -2s;"></div>
                    <div class="particle" style="width: 8px; height: 8px; top: 45%; left: 12%; animation-delay: -4s;"></div>
                    <div class="particle" style="width: 5px; height: 5px; top: 65%; left: 75%; animation-delay: -6s;"></div>
                    <div class="particle" style="width: 7px; height: 7px; top: 18%; left: 45%; animation-delay: -8s;"></div>
                    <div class="particle" style="width: 3px; height: 3px; top: 78%; left: 25%; animation-delay: -10s;"></div>
                    <div class="particle" style="width: 6px; height: 6px; top: 38%; left: 85%; animation-delay: -12s;"></div>
                    <div class="particle" style="width: 4px; height: 4px; top: 58%; left: 8%; animation-delay: -14s;"></div>
                    <div class="particle" style="width: 9px; height: 9px; top: 88%; left: 55%; animation-delay: -16s;"></div>
                    <div class="particle" style="width: 5px; height: 5px; top: 15%; left: 78%; animation-delay: -18s;"></div>
                    <div class="particle" style="width: 7px; height: 7px; top: 72%; left: 38%; animation-delay: -20s;"></div>
                    <div class="particle" style="width: 4px; height: 4px; top: 52%; left: 90%; animation-delay: -22s;"></div>
                    <div class="particle" style="width: 6px; height: 6px; top: 28%; left: 3%; animation-delay: -24s;"></div>
                    <div class="particle" style="width: 8px; height: 8px; top: 85%; left: 68%; animation-delay: -26s;"></div>
                    <div class="particle" style="width: 3px; height: 3px; top: 42%; left: 52%; animation-delay: -28s;"></div>
                    <div class="particle" style="width: 5px; height: 5px; top: 95%; left: 15%; animation-delay: -30s;"></div>
                    <div class="particle" style="width: 7px; height: 7px; top: 2%; left: 88%; animation-delay: -32s;"></div>
                    <div class="particle" style="width: 4px; height: 4px; top: 68%; left: 62%; animation-delay: -34s;"></div>
                    <div class="particle" style="width: 6px; height: 6px; top: 32%; left: 28%; animation-delay: -36s;"></div>
                    <div class="particle" style="width: 8px; height: 8px; top: 82%; left: 92%; animation-delay: -38s;"></div>
                </div>
                
                <!-- Header -->
                <header class="container mx-auto px-4 py-4 flex justify-between items-center relative z-10">
                    <div class="flex items-center space-x-2">
                        <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="#9146FF">
                            <path d="M2.149 0l-1.612 4.119v16.836h5.731v3.045h3.224l3.045-3.045h4.657l6.269-6.269v-14.686h-19.313zm17.124 13.612l-3.582 3.582h-5.731l-3.045 3.045v-3.045h-3.582v-15.045h15.045v11.463zm-3.582-7.343v6.262h-2.149v-6.262h2.149zm-5.731 0v6.262h-2.149v-6.262h2.149z"/>
                        </svg>
                        <h1 class="text-2xl font-bold bg-gradient-to-r from-purple-400 to-pink-500 bg-clip-text text-transparent">BambooFury Giveaways</h1>
                    </div>
                    <div class="flex items-center space-x-4">
                        <!-- Global Settings Button -->
                        <button id="globalSettingsBtn" class="text-gray-400 hover:text-gray-300 transition-all duration-300 transform hover:scale-110 p-2" title="Настройки">
                            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="settings-gear transition-all duration-300">
                                <path d="M12 15a3 3 0 1 0 0-6 3 3 0 0 0 0 6Z"/>
                                <path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1Z"/>
                            </svg>
                        </button>
                        
                        <div id="connectionStatus" class="flex items-center text-sm relative">
                            <div id="streamerAvatar" class="w-8 h-8 rounded-full mr-2 overflow-hidden bg-purple-600 flex items-center justify-center">
                                <span class="text-xs text-white">?</span>
                            </div>
                            <div class="relative">
                                <button id="username" class="font-medium hover:text-purple-400 transition-colors duration-200 cursor-pointer">Подключен</button>
                                <!-- Settings dropdown for BambooFury only -->
                                <div id="ownerSettingsDropdown" class="bg-gray-800 border border-gray-600 rounded-lg shadow-xl min-w-48 hidden">
                                    <div class="p-2">
                                        <button id="channelSettingsBtn" class="w-full text-left px-3 py-2 hover:bg-gray-700 rounded text-sm flex items-center space-x-2">
                                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                                <circle cx="12" cy="12" r="3"></circle>
                                                <path d="M12 1v6m0 6v6M5.64 7.05l4.95 4.95m4.95-4.95l-4.95 4.95M1 12h6m6 0h6"></path>
                                            </svg>
                                            <span>Настройки канала</span>
                                        </button>
                                        <button id="userManagementBtn" class="w-full text-left px-3 py-2 hover:bg-gray-700 rounded text-sm flex items-center space-x-2">
                                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                                <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
                                                <circle cx="9" cy="7" r="4"></circle>
                                                <path d="M23 21v-2a4 4 0 0 0-3-3.87"></path>
                                                <path d="M16 3.13a4 4 0 0 1 0 7.75"></path>
                                            </svg>
                                            <span>Управление пользователями</span>
                                        </button>
                                        <div class="border-t border-gray-600 my-1"></div>
                                        <div class="px-3 py-1 text-xs text-gray-400">Только для владельца</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <button id="disconnectBtn" class="text-gray-400 hover:text-red-400 transition-all duration-300 transform hover:scale-110 p-2" title="Отключить аккаунт">
                            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"></path>
                                <polyline points="16,17 21,12 16,7"></polyline>
                                <line x1="21" y1="12" x2="9" y2="12"></line>
                            </svg>
                        </button>
                    </div>
                </header>

                <!-- Main Content -->
                <div class="container mx-auto px-4 pb-12 flex flex-col lg:flex-row gap-8 min-h-[calc(100vh-120px)] relative z-10">
                    <!-- Chat Column -->
                    <div class="lg:w-1/3 bg-gray-800 rounded-xl overflow-hidden neon-border">
                        <div class="bg-gray-700 px-4 py-3 border-b border-gray-600 flex justify-between items-center">
                            <h2 class="font-bold text-lg">Чат стрима</h2>
                            <span id="viewerCount" class="bg-purple-900 text-xs px-2 py-1 rounded-full">0 зрителей</span>
                        </div>
                        <div id="chatContainer" class="h-[400px] lg:h-[calc(100vh-220px)] overflow-y-auto p-4 pb-0">
                            <div class="text-center text-gray-500 py-8">
                                Подключен к чату Twitch. Сообщения появятся здесь.
                            </div>
                        </div>
                        <div class="p-4 border-t border-gray-700 bg-gray-800">
                            <input type="text" id="chatFilter" placeholder="Фильтр чата..." class="w-full bg-gray-700 border border-gray-600 rounded px-3 py-2 focus:outline-none focus:ring-2 focus:ring-purple-500">
                        </div>
                    </div>

                    <!-- Giveaways Column -->
                    <div class="lg:flex-1">
                        <div class="bg-gray-800 rounded-xl p-4 neon-border mb-6">
                            <div class="flex justify-between items-center mb-4">
                                <h2 class="font-bold text-xl">Активные розыгрыши</h2>
                                <button id="newGiveawayBtn" class="bg-gradient-to-r from-purple-600 to-pink-600 hover:from-purple-700 hover:to-pink-700 text-white px-4 py-2 rounded-lg transition transform hover:scale-105">
                                    Новый розыгрыш
                                </button>
                            </div>
                            
                            <div id="giveawaysList" class="space-y-4">
                                <!-- Giveaways will be populated here -->
                            </div>
                        </div>

                        <!-- Recent Winners -->
                        <div class="bg-gray-800 rounded-xl p-4 neon-border">
                            <div class="flex justify-between items-center mb-4">
                                <h2 class="font-bold text-xl">Последние победители</h2>
                                <button id="clearWinnersBtn" class="group relative p-2 bg-gray-700 hover:bg-red-600 rounded-lg transition-all duration-300 transform hover:scale-110 border border-gray-600 hover:border-red-500" title="Очистить список победителей">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-gray-400 group-hover:text-white transition-colors duration-300">
                                        <path d="M3 6h18"></path>
                                        <path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"></path>
                                        <path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"></path>
                                        <line x1="10" y1="11" x2="10" y2="17"></line>
                                        <line x1="14" y1="11" x2="14" y2="17"></line>
                                    </svg>
                                    <div class="absolute -top-10 left-1/2 transform -translate-x-1/2 bg-gray-900 text-white text-xs px-2 py-1 rounded opacity-0 group-hover:opacity-100 transition-opacity duration-300 pointer-events-none whitespace-nowrap">
                                        Очистить историю
                                    </div>
                                </button>
                            </div>
                            <div id="winnersList" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3">
                                <!-- Winners will be populated here -->
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- New Giveaway Modal -->
    <div id="newGiveawayModal" class="fixed inset-0 bg-black bg-opacity-80 z-50 flex items-center justify-center p-4 hidden">
        <div class="bg-gray-800 rounded-xl max-w-md w-full p-6 giveaway-modal-pulse slide-in relative overflow-hidden">
            <!-- Animated Background -->
            <div class="giveaway-bg">
                <!-- Twitch Icons -->
                <div class="giveaway-icon">
                    <svg width="60" height="60" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M2.149 0l-1.612 4.119v16.836h5.731v3.045h3.224l3.045-3.045h4.657l6.269-6.269v-14.686h-19.313zm17.124 13.612l-3.582 3.582h-5.731l-3.045 3.045v-3.045h-3.582v-15.045h15.045v11.463zm-3.582-7.343v6.262h-2.149v-6.262h2.149zm-5.731 0v6.262h-2.149v-6.262h2.149z"/>
                    </svg>
                </div>
                <div class="giveaway-icon">
                    <svg width="50" height="50" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/>
                    </svg>
                </div>
                <div class="giveaway-icon">
                    <svg width="45" height="45" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/>
                    </svg>
                </div>
                <div class="giveaway-icon">
                    <svg width="55" height="55" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M9 11H7v9h2v-9zm4 0h-2v9h2v-9zm4 0h-2v9h2v-9zm2-7v2H5V4h3.5l1-1h5l1 1H19zm-2 2H7v16h10V6z"/>
                    </svg>
                </div>
                <div class="giveaway-icon">
                    <svg width="65" height="65" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/>
                    </svg>
                </div>
                <div class="giveaway-icon">
                    <svg width="40" height="40" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M7 14c-1.66 0-3 1.34-3 3 0 1.31-1.16 2-2 2 .92 1.22 2.49 2 4 2 2.21 0 4-1.79 4-4 0-1.66-1.34-3-3-3zm13.71-9.37l-1.34-1.34c-.39-.39-1.02-.39-1.41 0L9 12.25 11.75 15l8.96-8.96c.39-.39.39-1.02 0-1.41z"/>
                    </svg>
                </div>
                <div class="giveaway-icon">
                    <svg width="70" height="70" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M2.149 0l-1.612 4.119v16.836h5.731v3.045h3.224l3.045-3.045h4.657l6.269-6.269v-14.686h-19.313zm17.124 13.612l-3.582 3.582h-5.731l-3.045 3.045v-3.045h-3.582v-15.045h15.045v11.463zm-3.582-7.343v6.262h-2.149v-6.262h2.149zm-5.731 0v6.262h-2.149v-6.262h2.149z"/>
                    </svg>
                </div>
                
                <!-- Sparkle Effects -->
                <div class="giveaway-sparkle" style="top: 20%; left: 30%; color: #FFD700;">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/>
                    </svg>
                </div>
                <div class="giveaway-sparkle" style="top: 70%; right: 20%; color: #FF69B4;">
                    <svg width="15" height="15" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/>
                    </svg>
                </div>
                <div class="giveaway-sparkle" style="bottom: 30%; left: 15%; color: #00FFFF;">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/>
                    </svg>
                </div>
                <div class="giveaway-sparkle" style="top: 40%; right: 40%; color: #32CD32;">
                    <svg width="12" height="12" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/>
                    </svg>
                </div>
                <div class="giveaway-sparkle" style="bottom: 60%; left: 60%; color: #FF4500;">
                    <svg width="14" height="14" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/>
                    </svg>
                </div>
            </div>
            
            <div class="flex justify-between items-center mb-4 relative z-10">
                <div class="flex items-center space-x-3">
                    <div class="w-8 h-8 bg-gradient-to-r from-purple-600 to-pink-600 rounded-full flex items-center justify-center">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none">
                            <!-- Кубик Рубика 3D -->
                            <defs>
                                <linearGradient id="redFaceSmall" x1="0%" y1="0%" x2="100%" y2="100%">
                                    <stop offset="0%" style="stop-color:#FF6B6B;stop-opacity:1" />
                                    <stop offset="100%" style="stop-color:#DC143C;stop-opacity:1" />
                                </linearGradient>
                                <linearGradient id="blueFaceSmall" x1="0%" y1="0%" x2="100%" y2="100%">
                                    <stop offset="0%" style="stop-color:#4ECDC4;stop-opacity:1" />
                                    <stop offset="100%" style="stop-color:#2E8B87;stop-opacity:1" />
                                </linearGradient>
                                <linearGradient id="whiteFaceSmall" x1="0%" y1="0%" x2="100%" y2="100%">
                                    <stop offset="0%" style="stop-color:#FFFFFF;stop-opacity:1" />
                                    <stop offset="100%" style="stop-color:#E8E8E8;stop-opacity:1" />
                                </linearGradient>
                            </defs>
                            
                            <!-- Левая грань (красная) -->
                            <polygon points="2,8 2,16 8,18 8,10" fill="url(#redFaceSmall)" stroke="#000" stroke-width="0.5"/>
                            
                            <!-- Верхняя грань (белая) -->
                            <polygon points="2,8 8,10 16,8 10,6" fill="url(#whiteFaceSmall)" stroke="#000" stroke-width="0.5"/>
                            
                            <!-- Правая грань (синяя) -->
                            <polygon points="10,6 16,8 16,16 10,14" fill="url(#blueFaceSmall)" stroke="#000" stroke-width="0.5"/>
                            
                            <!-- Разделительные линии -->
                            <line x1="2" y1="11" x2="8" y2="13" stroke="#000" stroke-width="0.3"/>
                            <line x1="2" y1="13.5" x2="8" y2="15.5" stroke="#000" stroke-width="0.3"/>
                            <line x1="4.7" y1="9" x2="4.7" y2="17" stroke="#000" stroke-width="0.3"/>
                            
                            <line x1="6" y1="7" x2="12" y2="9" stroke="#000" stroke-width="0.3"/>
                            <line x1="8" y1="6.5" x2="14" y2="8.5" stroke="#000" stroke-width="0.3"/>
                            
                            <line x1="10" y1="9" x2="16" y2="11" stroke="#000" stroke-width="0.3"/>
                            <line x1="10" y1="11.5" x2="16" y2="13.5" stroke="#000" stroke-width="0.3"/>
                            <line x1="13" y1="7" x2="13" y2="15" stroke="#000" stroke-width="0.3"/>
                            
                            <!-- Блики для 3D эффекта -->
                            <polygon points="2,8 3,8.5 3,16.5 2,16" fill="rgba(255,255,255,0.3)" stroke="none"/>
                            <polygon points="2,8 3,8.5 9,10.5 8,10" fill="rgba(255,255,255,0.4)" stroke="none"/>
                        </svg>
                    </div>
                    <h2 class="text-xl font-bold bg-gradient-to-r from-purple-400 to-pink-400 bg-clip-text text-transparent">Новый розыгрыш</h2>
                </div>
                <button id="closeGiveawayModal" class="text-gray-400 hover:text-white transition-all duration-200 hover:scale-110 relative z-20">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <line x1="18" y1="6" x2="6" y2="18"></line>
                        <line x1="6" y1="6" x2="18" y2="18"></line>
                    </svg>
                </button>
            </div>
            
            <div class="space-y-4 relative z-10">
                <div>
                    <label class="block text-sm font-medium mb-1" for="giveawayName">Название розыгрыша</label>
                    <input type="text" id="giveawayName" class="w-full bg-gray-700 border border-gray-600 rounded px-3 py-2 focus:outline-none focus:ring-2 focus:ring-purple-500" placeholder="Например: Специальный дроп">
                </div>
                
                <div>
                    <label class="block text-sm font-medium mb-1" for="keyword">Ключевое слово</label>
                    <div class="relative">
                        <div class="absolute inset-y-0 left-0 flex items-center pl-3 pointer-events-none text-gray-400">
                            !
                        </div>
                        <input type="text" id="keyword" class="w-full bg-gray-700 border border-gray-600 rounded pl-7 pr-3 py-2 focus:outline-none focus:ring-2 focus:ring-purple-500" placeholder="drop">
                    </div>
                </div>
                
                <div>
                    <label class="block text-sm font-medium mb-1" for="winnerCount">Количество победителей</label>
                    <select id="winnerCount" class="w-full bg-gray-700 border border-gray-600 rounded px-3 py-2 focus:outline-none focus:ring-2 focus:ring-purple-500">
                        <option value="1">1 победитель</option>
                        <option value="3">3 победителя</option>
                        <option value="5">5 победителей</option>
                        <option value="10">10 победителей</option>
                    </select>
                </div>
                
                <div class="flex justify-center space-x-3 pt-2">
                    <button id="cancelGiveawayBtn" class="bg-gray-700 hover:bg-gray-600 text-white px-6 py-2 rounded-lg transition-all duration-200 text-sm">Отмена</button>
                    <button id="createGiveawayBtn" class="bg-gradient-to-r from-purple-600 to-pink-600 hover:from-purple-700 hover:to-pink-700 text-white px-6 py-2 rounded-lg transition-all duration-200 transform hover:scale-105 shadow-lg hover:shadow-xl relative overflow-hidden text-sm">
                        <span class="relative z-10">🎊 Начать розыгрыш</span>
                        <div class="absolute inset-0 bg-gradient-to-r from-transparent via-white/20 to-transparent transform -skew-x-12 translate-x-[-100%] transition-transform duration-700 hover:translate-x-[100%]"></div>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Winner Announcement Modal -->
    <div id="winnerModal" class="fixed inset-0 bg-black bg-opacity-80 z-50 flex items-center justify-center p-4 hidden">
        <div class="bg-gray-800 rounded-xl max-w-6xl w-full p-8 neon-border">
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                <!-- Left side - Winner announcement -->
                <div class="text-center">
                    <div class="mb-6">
                        <div class="text-6xl mx-auto w-16 h-16 flex items-center justify-center">
                            🎊
                        </div>
                    </div>
                    <h2 class="text-3xl font-bold mb-4 celebrate-animation">Победители розыгрыша!</h2>
                    <div id="winnerNames" class="space-y-2 mb-6">
                        <!-- Winners will be added here -->
                    </div>
                    <div class="flex space-x-3 justify-center">
                        <button id="rerollWinnerBtn" class="bg-orange-600 hover:bg-orange-500 text-white px-6 py-2 rounded-lg transition transform hover:scale-105">
                            🎲 Перевыбрать
                        </button>
                        <button id="closeWinnerModal" class="bg-purple-700 hover:bg-purple-600 text-white px-6 py-2 rounded-lg transition">Закрыть</button>
                    </div>
                </div>
                
                <!-- Right side - Winner chat monitor -->
                <div class="bg-gray-700 rounded-xl overflow-hidden">
                    <div class="bg-gray-600 px-4 py-3 border-b border-gray-500 flex justify-between items-center">
                        <h3 class="font-bold text-lg">Чат победителя</h3>
                        <div class="flex items-center space-x-2">
                            <div id="winnerStatus" class="w-3 h-3 rounded-full bg-red-500 animate-pulse"></div>
                            <span id="winnerTimer" class="text-sm font-mono bg-gray-800 px-2 py-1 rounded">01:00</span>
                        </div>
                    </div>
                    <div id="winnerChatContainer" class="h-80 overflow-y-auto p-4">
                        <div class="text-center text-gray-400 py-8">
                            Ожидание сообщений от победителя...
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Mobile Floating Button -->
    <button id="mobileActionBtn" class="lg:hidden floating-btn bg-purple-700 text-white rounded-full w-14 h-14 flex items-center justify-center shadow-lg">
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="12" y1="5" x2="12" y2="19"></line><line x1="5" y1="12" x2="19" y2="12"></line></svg>
    </button>

    <!-- Mobile Menu -->
    <div id="mobileMenu" class="fixed inset-0 bg-black bg-opacity-80 z-40 hidden">
        <div class="absolute bottom-0 left-0 right-0 bg-gray-800 rounded-t-xl p-6">
            <button id="closeMobileMenu" class="absolute top-4 right-4 text-gray-400">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>
            </button>
            <div class="space-y-4">
                <button id="mobileNewGiveawayBtn" class="w-full bg-purple-700 hover:bg-purple-600 text-white px-4 py-3 rounded-lg transition">Новый розыгрыш</button>
                <button id="mobileDisconnectBtn" class="w-full bg-gray-700 hover:bg-red-600 text-gray-300 hover:text-white px-4 py-3 rounded-lg transition-all duration-300 flex items-center justify-center gap-2">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"></path>
                        <polyline points="16,17 21,12 16,7"></polyline>
                        <line x1="21" y1="12" x2="9" y2="12"></line>
                    </svg>
                    Отключить аккаунт
                </button>
                <div id="mobileUsername" class="text-center text-gray-400 mt-2">Подключен как: BambooFury</div>
            </div>
        </div>
    </div>

    <!-- Channel Settings Modal (BambooFury only) -->
    <div id="channelSettingsModal" class="fixed inset-0 bg-black bg-opacity-90 z-50 flex items-center justify-center p-4 hidden">
        <div class="bg-gray-800 rounded-xl max-w-4xl w-full max-h-[90vh] overflow-y-auto p-6 neon-border relative">
            <!-- Animated Background -->
            <div class="giveaway-bg">
                <!-- Settings Icons -->
                <div class="giveaway-icon">
                    <svg width="60" height="60" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M12 8c1.1 0 2-.9 2-2s-.9-2-2-2-2 .9-2 2 .9 2 2 2zm0 2c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm0 6c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2z"/>
                    </svg>
                </div>
                <div class="giveaway-icon">
                    <svg width="45" height="45" viewBox="0 0 24 24" fill="currentColor">
                        <circle cx="12" cy="12" r="3"></circle>
                        <path d="M12 1v6m0 6v6M5.64 7.05l4.95 4.95m4.95-4.95l-4.95 4.95M1 12h6m6 0h6"></path>
                    </svg>
                </div>
                <div class="giveaway-icon">
                    <svg width="55" height="55" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M3 17v2h6v-2H3zM3 5v2h10V5H3zm10 16v-2h8v-2h-8v-2h-2v6h2zM7 9v2H3v2h4v2h2V9H7zm14 4v-2H11v2h10zm-6-4h2V7h4V5h-4V3h-2v6z"/>
                    </svg>
                </div>
                <div class="giveaway-icon">
                    <svg width="50" height="50" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M19.14,12.94c0.04-0.3,0.06-0.61,0.06-0.94c0-0.32-0.02-0.64-0.07-0.94l2.03-1.58c0.18-0.14,0.23-0.41,0.12-0.61 l-1.92-3.32c-0.12-0.22-0.37-0.29-0.59-0.22l-2.39,0.96c-0.5-0.38-1.03-0.7-1.62-0.94L14.4,2.81c-0.04-0.24-0.24-0.41-0.48-0.41 h-3.84c-0.24,0-0.43,0.17-0.47,0.41L9.25,5.35C8.66,5.59,8.12,5.92,7.63,6.29L5.24,5.33c-0.22-0.08-0.47,0-0.59,0.22L2.74,8.87 C2.62,9.08,2.66,9.34,2.86,9.48l2.03,1.58C4.84,11.36,4.82,11.69,4.82,12s0.02,0.64,0.07,0.94l-2.03,1.58 c-0.18,0.14-0.23,0.41-0.12,0.61l1.92,3.32c0.12,0.22,0.37,0.29,0.59,0.22l2.39-0.96c0.5,0.38,1.03,0.7,1.62,0.94l0.36,2.54 c0.05,0.24,0.24,0.41,0.48,0.41h3.84c0.24,0,0.44-0.17,0.47-0.41l0.36-2.54c0.59-0.24,1.13-0.56,1.62-0.94l2.39,0.96 c0.22,0.08,0.47,0,0.59-0.22l1.92-3.32c0.12-0.22,0.07-0.47-0.12-0.61L19.14,12.94z M12,15.6c-1.98,0-3.6-1.62-3.6-3.6 s1.62-3.6,3.6-3.6s3.6,1.62,3.6,3.6S13.98,15.6,12,15.6z"/>
                    </svg>
                </div>
            </div>
            
            <div class="flex justify-between items-center mb-6 relative z-10">
                <div class="flex items-center space-x-3">
                    <div class="w-10 h-10 bg-gradient-to-r from-purple-600 to-pink-600 rounded-full flex items-center justify-center">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="white">
                            <circle cx="12" cy="12" r="3"></circle>
                            <path d="M12 1v6m0 6v6M5.64 7.05l4.95 4.95m4.95-4.95l-4.95 4.95M1 12h6m6 0h6"></path>
                        </svg>
                    </div>
                    <div>
                        <h2 class="text-2xl font-bold bg-gradient-to-r from-purple-400 to-pink-400 bg-clip-text text-transparent">Настройки канала</h2>
                        <p class="text-sm text-gray-400">Специальные настройки для владельца BambooFury</p>
                    </div>
                </div>
                <button id="closeChannelSettingsModal" class="text-gray-400 hover:text-white transition-all duration-200 hover:scale-110 relative z-20">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <line x1="18" y1="6" x2="6" y2="18"></line>
                        <line x1="6" y1="6" x2="18" y2="18"></line>
                    </svg>
                </button>
            </div>
            
            <!-- Settings Content -->
            <div class="space-y-6 relative z-10">
                <!-- General Settings -->
                <div class="bg-gray-700 rounded-xl p-6">
                    <h3 class="text-xl font-bold mb-4 flex items-center space-x-2">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <circle cx="12" cy="12" r="3"></circle>
                            <path d="M12 1v6m0 6v6M5.64 7.05l4.95 4.95m4.95-4.95l-4.95 4.95M1 12h6m6 0h6"></path>
                        </svg>
                        <span>Общие настройки</span>
                    </h3>
                    
                    <div class="space-y-4">
                        <div class="flex items-center justify-between">
                            <div>
                                <label class="text-sm font-medium">Автоматические объявления побед</label>
                                <p class="text-xs text-gray-400">Автоматически объявлять победителей в чате</p>
                            </div>
                            <label class="relative inline-flex items-center cursor-pointer">
                                <input type="checkbox" id="autoAnnounce" class="sr-only peer" checked>
                                <div class="w-11 h-6 bg-gray-600 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-purple-600"></div>
                            </label>
                        </div>
                        
                        <div class="flex items-center justify-between">
                            <div>
                                <label class="text-sm font-medium">Звуковые уведомления</label>
                                <p class="text-xs text-gray-400">Воспроизводить звук при новых участниках</p>
                            </div>
                            <label class="relative inline-flex items-center cursor-pointer">
                                <input type="checkbox" id="soundNotifications" class="sr-only peer">
                                <div class="w-11 h-6 bg-gray-600 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-purple-600"></div>
                            </label>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium mb-2">Таймер ожидания ответа (секунды)</label>
                            <input type="number" id="responseTimeout" min="30" max="300" value="60" class="w-full bg-gray-600 border border-gray-500 rounded px-3 py-2 focus:outline-none focus:ring-2 focus:ring-purple-500">
                        </div>
                    </div>
                </div>
                
                <!-- Moderation Settings -->
                <div class="bg-gray-700 rounded-xl p-6">
                    <h3 class="text-xl font-bold mb-4 flex items-center space-x-2">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"></path>
                        </svg>
                        <span>Настройки модерации</span>
                    </h3>
                    
                    <div class="space-y-4">
                        <div class="flex items-center justify-between">
                            <div>
                                <label class="text-sm font-medium">Автомодерация</label>
                                <p class="text-xs text-gray-400">Автоматически модерировать подозрительные сообщения</p>
                            </div>
                            <label class="relative inline-flex items-center cursor-pointer">
                                <input type="checkbox" id="autoModeration" class="sr-only peer">
                                <div class="w-11 h-6 bg-gray-600 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-purple-600"></div>
                            </label>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium mb-2">Длительность тайм-аута (минуты)</label>
                            <select id="timeoutDuration" class="w-full bg-gray-600 border border-gray-500 rounded px-3 py-2 focus:outline-none focus:ring-2 focus:ring-purple-500">
                                <option value="1">1 минута</option>
                                <option value="5">5 минут</option>
                                <option value="10" selected>10 минут</option>
                                <option value="30">30 минут</option>
                                <option value="60">1 час</option>
                            </select>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium mb-2">Запрещенные слова (через запятую)</label>
                            <textarea id="bannedWords" placeholder="слово1, слово2, слово3" rows="3" class="w-full bg-gray-600 border border-gray-500 rounded px-3 py-2 focus:outline-none focus:ring-2 focus:ring-purple-500 resize-none"></textarea>
                        </div>
                    </div>
                </div>
                
                <!-- Giveaway Settings -->
                <div class="bg-gray-700 rounded-xl p-6">
                    <h3 class="text-xl font-bold mb-4 flex items-center space-x-2">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/>
                        </svg>
                        <span>Настройки розыгрышей</span>
                    </h3>
                    
                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium mb-2">Максимальное количество участников</label>
                            <input type="number" id="maxParticipants" min="1" max="10000" value="1000" class="w-full bg-gray-600 border border-gray-500 rounded px-3 py-2 focus:outline-none focus:ring-2 focus:ring-purple-500">
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium mb-2">Минимальное время подписки (дни)</label>
                            <input type="number" id="minFollowDays" min="0" max="365" value="0" class="w-full bg-gray-600 border border-gray-500 rounded px-3 py-2 focus:outline-none focus:ring-2 focus:ring-purple-500">
                            <p class="text-xs text-gray-400 mt-1">0 = без ограничений</p>
                        </div>
                        
                        <div class="flex items-center justify-between">
                            <div>
                                <label class="text-sm font-medium">Только подписчики</label>
                                <p class="text-xs text-gray-400">Разрешить участие только подписчикам</p>
                            </div>
                            <label class="relative inline-flex items-center cursor-pointer">
                                <input type="checkbox" id="followersOnly" class="sr-only peer">
                                <div class="w-11 h-6 bg-gray-600 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-purple-600"></div>
                            </label>
                        </div>
                    </div>
                </div>
                
                <!-- Statistics & Data -->
                <div class="bg-gray-700 rounded-xl p-6">
                    <h3 class="text-xl font-bold mb-4 flex items-center space-x-2">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M18 20V10"></path>
                            <path d="M12 20V4"></path>
                            <path d="M6 20v-6"></path>
                        </svg>
                        <span>Статистика и данные</span>
                    </h3>
                    
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-4">
                        <div class="bg-gray-600 rounded-lg p-4 text-center">
                            <div class="text-2xl font-bold text-purple-400" id="totalGiveaways">0</div>
                            <div class="text-sm text-gray-400">Всего розыгрышей</div>
                        </div>
                        <div class="bg-gray-600 rounded-lg p-4 text-center">
                            <div class="text-2xl font-bold text-green-400" id="totalWinners">0</div>
                            <div class="text-sm text-gray-400">Всего победителей</div>
                        </div>
                        <div class="bg-gray-600 rounded-lg p-4 text-center">
                            <div class="text-2xl font-bold text-blue-400" id="totalParticipants">0</div>
                            <div class="text-sm text-gray-400">Всего участников</div>
                        </div>
                    </div>
                    
                    <div class="space-y-3">
                        <button id="exportDataBtn" class="w-full bg-blue-600 hover:bg-blue-500 text-white px-4 py-2 rounded-lg transition-all duration-200 flex items-center justify-center space-x-2">
                            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                                <polyline points="7,10 12,15 17,10"></polyline>
                                <line x1="12" y1="15" x2="12" y2="3"></line>
                            </svg>
                            <span>Экспорт данных</span>
                        </button>
                        
                        <button id="clearAllDataBtn" class="w-full bg-red-600 hover:bg-red-500 text-white px-4 py-2 rounded-lg transition-all duration-200 flex items-center justify-center space-x-2">
                            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <path d="M3 6h18"></path>
                                <path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"></path>
                                <path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"></path>
                                <line x1="10" y1="11" x2="10" y2="17"></line>
                                <line x1="14" y1="11" x2="14" y2="17"></line>
                            </svg>
                            <span>Очистить все данные</span>
                        </button>
                    </div>
                </div>
                
                <!-- Action Buttons -->
                <div class="flex space-x-3">
                    <button id="saveChannelSettings" class="flex-1 bg-gradient-to-r from-purple-600 to-pink-600 hover:from-purple-700 hover:to-pink-700 text-white px-6 py-3 rounded-lg transition-all duration-200 transform hover:scale-105 shadow-lg hover:shadow-xl relative overflow-hidden">
                        <span class="relative z-10">Сохранить настройки</span>
                        <div class="absolute inset-0 bg-gradient-to-r from-transparent via-white/20 to-transparent transform -skew-x-12 translate-x-[-100%] transition-transform duration-700 hover:translate-x-[100%]"></div>
                    </button>
                    <button id="resetChannelSettings" class="bg-gray-600 hover:bg-gray-500 text-white px-6 py-3 rounded-lg transition-all duration-200">
                        Сброс
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Global Settings Modal (for all users) -->
    <div id="globalSettingsModal" class="fixed inset-0 bg-black bg-opacity-90 z-50 flex items-center justify-center p-4 hidden">
        <div class="bg-gray-800 rounded-xl max-w-4xl w-full max-h-[90vh] overflow-y-auto p-6 neon-border relative">
            <!-- Animated Background -->
            <div class="giveaway-bg">
                <!-- Settings Icons -->
                <div class="giveaway-icon">
                    <svg width="60" height="60" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M21.32 9.55l-1.89-.63.89-1.78A1 1 0 0 0 20.13 6L18 3.87a1 1 0 1 0-1.14.19l-1.78.89-.63-1.89A1 1 0 0 0 13.5 2h-3a1 1 0 0 0-.95.66l-.63 1.89-1.78-.89A1 1 0 0 0 6 3.87L3.87 6a1 1 0 0 0 .19 1.14l.89 1.78-1.89.63A1 1 0 0 0 2 10.5v3a1 1 0 0 0 .66.95l1.89.63-.89 1.78A1 1 0 0 0 3.87 18L6 20.13a1 1 0 0 0 1.14-.19l1.78-.89.63 1.89A1 1 0 0 0 10.5 22h3a1 1 0 0 0 .95-.66l.63-1.89 1.78.89A1 1 0 0 0 18 20.13L20.13 18a1 1 0 0 0-.19-1.14l-.89-1.78 1.89-.63A1 1 0 0 0 22 13.5v-3a1 1 0 0 0-.68-.95z"/>
                    </svg>
                </div>
                <div class="giveaway-icon">
                    <svg width="45" height="45" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/>
                    </svg>
                </div>
                <div class="giveaway-icon">
                    <svg width="55" height="55" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M3 17v2h6v-2H3zM3 5v2h10V5H3zm10 16v-2h8v-2h-8v-2h-2v6h2zM7 9v2H3v2h4v2h2V9H7zm14 4v-2H11v2h10zm-6-4h2V7h4V5h-4V3h-2v6z"/>
                    </svg>
                </div>
                <div class="giveaway-icon">
                    <svg width="50" height="50" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 3c1.66 0 3 1.34 3 3s-1.34 3-3 3-3-1.34-3-3 1.34-3 3-3zm0 14.2c-2.5 0-4.71-1.28-6-3.22.03-1.99 4-3.08 6-3.08 1.99 0 5.97 1.09 6 3.08-1.29 1.94-3.5 3.22-6 3.22z"/>
                    </svg>
                </div>
            </div>
            
            <div class="flex justify-between items-center mb-6 relative z-10">
                <div class="flex items-center space-x-3">
                    <div class="w-10 h-10 bg-gradient-to-r from-purple-600 to-pink-600 rounded-full flex items-center justify-center">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none">
                            <defs>
                                <linearGradient id="gearGradientWhite" x1="0%" y1="0%" x2="100%" y2="100%">
                                    <stop offset="0%" style="stop-color:#FFFFFF;stop-opacity:1" />
                                    <stop offset="100%" style="stop-color:#F8F8FF;stop-opacity:1" />
                                </linearGradient>
                            </defs>
                            <path d="M21.32 9.55l-1.89-.63.89-1.78A1 1 0 0 0 20.13 6L18 3.87a1 1 0 1 0-1.14.19l-1.78.89-.63-1.89A1 1 0 0 0 13.5 2h-3a1 1 0 0 0-.95.66l-.63 1.89-1.78-.89A1 1 0 0 0 6 3.87L3.87 6a1 1 0 0 0 .19 1.14l.89 1.78-1.89.63A1 1 0 0 0 2 10.5v3a1 1 0 0 0 .66.95l1.89.63-.89 1.78A1 1 0 0 0 3.87 18L6 20.13a1 1 0 0 0 1.14-.19l1.78-.89.63 1.89A1 1 0 0 0 10.5 22h3a1 1 0 0 0 .95-.66l.63-1.89 1.78.89A1 1 0 0 0 18 20.13L20.13 18a1 1 0 0 0-.19-1.14l-.89-1.78 1.89-.63A1 1 0 0 0 22 13.5v-3a1 1 0 0 0-.68-.95z" 
                                  fill="url(#gearGradientWhite)" stroke="white" stroke-width="0.5"/>
                            <circle cx="12" cy="12" r="3" fill="none" stroke="white" stroke-width="1.5"/>
                            <circle cx="12" cy="12" r="1" fill="white"/>
                        </svg>
                    </div>
                    <div>
                        <h2 class="text-2xl font-bold bg-gradient-to-r from-purple-400 to-pink-400 bg-clip-text text-transparent">Настройки</h2>
                        <p class="text-sm text-gray-400">Персонализация интерфейса и конфиденциальность</p>
                    </div>
                </div>
                <button id="closeGlobalSettingsModal" class="text-gray-400 hover:text-white transition-all duration-200 hover:scale-110 relative z-20">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <line x1="18" y1="6" x2="6" y2="18"></line>
                        <line x1="6" y1="6" x2="18" y2="18"></line>
                    </svg>
                </button>
            </div>
            
            <!-- Settings Content -->
            <div class="space-y-6 relative z-10">
                <!-- Interface Settings -->
                <div class="bg-gray-700 rounded-xl p-6">
                    <h3 class="text-xl font-bold mb-4 flex items-center space-x-2">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <rect x="2" y="3" width="20" height="14" rx="2" ry="2"></rect>
                            <line x1="8" y1="21" x2="16" y2="21"></line>
                            <line x1="12" y1="17" x2="12" y2="21"></line>
                        </svg>
                        <span>🎨 Интерфейс</span>
                    </h3>
                    
                    <div class="space-y-4">
                        <div class="flex items-center justify-between">
                            <div>
                                <label class="text-sm font-medium">Скрыть ники участников</label>
                                <p class="text-xs text-gray-400">Показывать ******* вместо настоящих ников</p>
                            </div>
                            <label class="relative inline-flex items-center cursor-pointer">
                                <input type="checkbox" id="hideUsernames" class="sr-only peer">
                                <div class="w-11 h-6 bg-gray-600 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-purple-600"></div>
                            </label>
                        </div>
                        
                        <div class="flex items-center justify-between">
                            <div>
                                <label class="text-sm font-medium">Скрыть аватарки</label>
                                <p class="text-xs text-gray-400">Показывать только инициалы пользователей</p>
                            </div>
                            <label class="relative inline-flex items-center cursor-pointer">
                                <input type="checkbox" id="hideAvatars" class="sr-only peer">
                                <div class="w-11 h-6 bg-gray-600 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-purple-600"></div>
                            </label>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium mb-2">Язык интерфейса</label>
                            <div class="flex space-x-2">
                                <button id="langEN" class="language-btn px-4 py-2 rounded-lg border border-gray-600 text-gray-300 hover:text-white hover:border-purple-500 transition-all duration-200 flex items-center space-x-2">
                                    <span class="text-lg">🇺🇸</span>
                                    <span>EN</span>
                                </button>
                                <button id="langRU" class="language-btn px-4 py-2 rounded-lg border border-purple-500 bg-purple-600 text-white flex items-center space-x-2">
                                    <span class="text-lg">🇷🇺</span>
                                    <span>RU</span>
                                </button>
                                <button id="langUA" class="language-btn px-4 py-2 rounded-lg border border-gray-600 text-gray-300 hover:text-white hover:border-purple-500 transition-all duration-200 flex items-center space-x-2">
                                    <span class="text-lg">🇺🇦</span>
                                    <span>UA</span>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Privacy Settings -->
                <div class="bg-gray-700 rounded-xl p-6">
                    <h3 class="text-xl font-bold mb-4 flex items-center space-x-2">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"></path>
                        </svg>
                        <span>⚠️ Конфиденциальность</span>
                    </h3>
                    
                    <div class="space-y-4">
                        <div class="flex items-center justify-between">
                            <div>
                                <label class="text-sm font-medium">Скрыть мой Twitch логин в списках участников</label>
                                <p class="text-xs text-gray-400">Другие пользователи не увидят ваш ник в розыгрышах</p>
                            </div>
                            <label class="relative inline-flex items-center cursor-pointer">
                                <input type="checkbox" id="hideMyUsername" class="sr-only peer">
                                <div class="w-11 h-6 bg-gray-600 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-purple-600"></div>
                            </label>
                        </div>
                        
                        <div class="flex items-center justify-between">
                            <div>
                                <label class="text-sm font-medium">Отключить статистику по участию</label>
                                <p class="text-xs text-gray-400">Не сохранять данные о ваших участиях в розыгрышах</p>
                            </div>
                            <label class="relative inline-flex items-center cursor-pointer">
                                <input type="checkbox" id="disableStatistics" class="sr-only peer">
                                <div class="w-11 h-6 bg-gray-600 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-purple-600"></div>
                            </label>
                        </div>
                        
                        <div class="border-t border-gray-600 pt-4">
                            <button id="clearGiveawayHistory" class="w-full bg-orange-600 hover:bg-orange-500 text-white px-4 py-2 rounded-lg transition-all duration-200 flex items-center justify-center space-x-2">
                                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <path d="M3 6h18"></path>
                                    <path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"></path>
                                    <path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"></path>
                                </svg>
                                <span>Очистить историю розыгрышей</span>
                            </button>
                        </div>
                    </div>
                </div>
                
                <!-- Other Settings -->
                <div class="bg-gray-700 rounded-xl p-6">
                    <h3 class="text-xl font-bold mb-4 flex items-center space-x-2">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                            <polyline points="14,2 14,8 20,8"></polyline>
                            <line x1="16" y1="13" x2="8" y2="13"></line>
                            <line x1="16" y1="17" x2="8" y2="17"></line>
                            <polyline points="10,9 9,9 8,9"></polyline>
                        </svg>
                        <span>🧾 Прочее</span>
                    </h3>
                    
                    <div class="space-y-4">
                        <div class="bg-gray-600 rounded-lg p-4">
                            <div class="flex items-center space-x-3 mb-3">
                                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
                                    <circle cx="12" cy="7" r="4"></circle>
                                </svg>
                                <div>
                                    <p class="text-sm font-medium">Дата регистрации на сайте</p>
                                    <p class="text-xs text-gray-400" id="registrationDate">2025-07-06</p>
                                </div>
                            </div>
                        </div>
                        
                        <button id="deleteAccountBtn" class="w-full bg-red-600 hover:bg-red-500 text-white px-4 py-2 rounded-lg transition-all duration-200 flex items-center justify-center space-x-2">
                            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <path d="M3 6h18"></path>
                                <path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"></path>
                                <path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"></path>
                                <line x1="10" y1="11" x2="10" y2="17"></line>
                                <line x1="14" y1="11" x2="14" y2="17"></line>
                            </svg>
                            <span>Удалить аккаунт с сайта</span>
                        </button>
                        
                        <button id="reportBugBtn" class="w-full bg-blue-600 hover:bg-blue-500 text-white px-4 py-2 rounded-lg transition-all duration-200 flex items-center justify-center space-x-2">
                            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <path d="M14 9V5a3 3 0 0 0-6 0v4"></path>
                                <rect x="2" y="9" width="20" height="12" rx="2" ry="2"></rect>
                                <circle cx="12" cy="15" r="1"></circle>
                            </svg>
                            <span>Сообщить об ошибке / предложить идею</span>
                        </button>
                    </div>
                </div>
                
                <!-- Action Buttons -->
                <div class="flex space-x-3">
                    <button id="saveGlobalSettings" class="flex-1 bg-gradient-to-r from-purple-600 to-pink-600 hover:from-purple-700 hover:to-pink-700 text-white px-6 py-3 rounded-lg transition-all duration-200 transform hover:scale-105 shadow-lg hover:shadow-xl relative overflow-hidden">
                        <span class="relative z-10">Сохранить настройки</span>
                        <div class="absolute inset-0 bg-gradient-to-r from-transparent via-white/20 to-transparent transform -skew-x-12 translate-x-[-100%] transition-transform duration-700 hover:translate-x-[100%]"></div>
                    </button>
                    <button id="resetGlobalSettings" class="bg-gray-600 hover:bg-gray-500 text-white px-6 py-3 rounded-lg transition-all duration-200">
                        Сброс
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- User Management Modal (BambooFury only) -->
    <div id="userManagementModal" class="fixed inset-0 bg-black bg-opacity-90 z-50 flex items-center justify-center p-4 hidden">
        <div class="bg-gray-800 rounded-xl max-w-7xl w-full max-h-[95vh] overflow-y-auto p-6 neon-border relative">
            <!-- Animated Background -->
            <div class="giveaway-bg">
                <!-- User Management Icons -->
                <div class="giveaway-icon">
                    <svg width="60" height="60" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M16 4c0-1.11.89-2 2-2s2 .89 2 2-.89 2-2 2-2-.89-2-2zm4 18v-6h2.5l-2.54-7.63A1.5 1.5 0 0 0 18.5 7h-1c-.83 0-1.5.67-1.5 1.5v6c0 .83.67 1.5 1.5 1.5H19v4h1z"/>
                    </svg>
                </div>
                <div class="giveaway-icon">
                    <svg width="45" height="45" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"/>
                    </svg>
                </div>
                <div class="giveaway-icon">
                    <svg width="55" height="55" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-7 3c1.93 0 3.5 1.57 3.5 3.5S13.93 13 12 13s-3.5-1.57-3.5-3.5S10.07 6 12 6zm7 13H5v-.23c0-.62.28-1.2.76-1.58C7.47 15.82 9.64 15 12 15s4.53.82 6.24 2.19c.48.38.76.97.76 1.58V19z"/>
                    </svg>
                </div>
                <div class="giveaway-icon">
                    <svg width="50" height="50" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/>
                    </svg>
                </div>
            </div>
            
            <div class="flex justify-between items-center mb-6 relative z-10">
                <div class="flex items-center space-x-3">
                    <div class="w-10 h-10 bg-gradient-to-r from-blue-600 to-purple-600 rounded-full flex items-center justify-center">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="white">
                            <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
                            <circle cx="9" cy="7" r="4"></circle>
                            <path d="M23 21v-2a4 4 0 0 0-3-3.87"></path>
                            <path d="M16 3.13a4 4 0 0 1 0 7.75"></path>
                        </svg>
                    </div>
                    <div>
                        <h2 class="text-2xl font-bold bg-gradient-to-r from-blue-400 to-purple-400 bg-clip-text text-transparent">Управление пользователями</h2>
                        <p class="text-sm text-gray-400">Администрирование пользователей и стримеров</p>
                    </div>
                </div>
                <button id="closeUserManagementModal" class="text-gray-400 hover:text-white transition-all duration-200 hover:scale-110 relative z-20">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <line x1="18" y1="6" x2="6" y2="18"></line>
                        <line x1="6" y1="6" x2="18" y2="18"></line>
                    </svg>
                </button>
            </div>
            
            <!-- Tab Navigation -->
            <div class="flex space-x-1 bg-gray-700 rounded-lg p-1 mb-6 relative z-10">
                <button id="usersTab" class="flex-1 px-4 py-2 rounded-lg transition-all duration-200 bg-blue-600 text-white">
                    <div class="flex items-center justify-center space-x-2">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
                            <circle cx="9" cy="7" r="4"></circle>
                            <path d="M23 21v-2a4 4 0 0 0-3-3.87"></path>
                            <path d="M16 3.13a4 4 0 0 1 0 7.75"></path>
                        </svg>
                        <span>Пользователи</span>
                    </div>
                </button>
                <button id="streamersTab" class="flex-1 px-4 py-2 rounded-lg transition-all duration-200 text-gray-300 hover:text-white hover:bg-gray-600">
                    <div class="flex items-center justify-center space-x-2">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <polygon points="23 7 16 12 23 17 23 7"></polygon>
                            <rect x="1" y="5" width="15" height="14" rx="2" ry="2"></rect>
                        </svg>
                        <span>Стримеры</span>
                    </div>
                </button>
                <button id="notificationsTab" class="flex-1 px-4 py-2 rounded-lg transition-all duration-200 text-gray-300 hover:text-white hover:bg-gray-600">
                    <div class="flex items-center justify-center space-x-2">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"></path>
                            <path d="M13.73 21a2 2 0 0 1-3.46 0"></path>
                        </svg>
                        <span>Уведомления</span>
                    </div>
                </button>
            </div>
            
            <!-- Users Tab Content -->
            <div id="usersContent" class="space-y-6 relative z-10">
                <!-- Search and Filters -->
                <div class="bg-gray-700 rounded-xl p-4">
                    <div class="flex flex-col md:flex-row gap-4">
                        <div class="flex-1">
                            <input type="text" id="userSearch" placeholder="🔍 Поиск по логину или ID..." class="w-full bg-gray-600 border border-gray-500 rounded px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500">
                        </div>
                        <div class="flex gap-2">
                            <select id="userSortBy" class="bg-gray-600 border border-gray-500 rounded px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500">
                                <option value="date">По дате входа</option>
                                <option value="login">По логину</option>
                                <option value="type">По типу</option>
                                <option value="status">По статусу</option>
                            </select>
                            <select id="userFilterStatus" class="bg-gray-600 border border-gray-500 rounded px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500">
                                <option value="all">Все статусы</option>
                                <option value="verified">Подтверждённые</option>
                                <option value="blocked">Заблокированные</option>
                                <option value="unverified">Неподтверждённые</option>
                            </select>
                        </div>
                    </div>
                </div>
                
                <!-- Users Table -->
                <div class="bg-gray-700 rounded-xl overflow-hidden">
                    <div class="overflow-x-auto">
                        <table class="w-full">
                            <thead class="bg-gray-600">
                                <tr>
                                    <th class="px-4 py-3 text-left text-sm font-medium text-gray-300">Аватар</th>
                                    <th class="px-4 py-3 text-left text-sm font-medium text-gray-300">Twitch логин</th>
                                    <th class="px-4 py-3 text-left text-sm font-medium text-gray-300">ID</th>
                                    <th class="px-4 py-3 text-left text-sm font-medium text-gray-300">Дата входа</th>
                                    <th class="px-4 py-3 text-left text-sm font-medium text-gray-300">IP</th>
                                    <th class="px-4 py-3 text-left text-sm font-medium text-gray-300">Тип</th>
                                    <th class="px-4 py-3 text-left text-sm font-medium text-gray-300">Статус</th>
                                    <th class="px-4 py-3 text-center text-sm font-medium text-gray-300">Действия</th>
                                </tr>
                            </thead>
                            <tbody id="usersTableBody" class="divide-y divide-gray-600">
                                <!-- Users will be populated here -->
                            </tbody>
                        </table>
                    </div>
                    
                    <!-- Empty State -->
                    <div id="usersEmptyState" class="text-center py-8 text-gray-400 hidden">
                        <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="mx-auto mb-4 opacity-50">
                            <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
                            <circle cx="9" cy="7" r="4"></circle>
                            <path d="M23 21v-2a4 4 0 0 0-3-3.87"></path>
                            <path d="M16 3.13a4 4 0 0 1 0 7.75"></path>
                        </svg>
                        <p>Пользователи не найдены</p>
                    </div>
                </div>
            </div>
            
            <!-- Streamers Tab Content -->
            <div id="streamersContent" class="space-y-6 relative z-10 hidden">
                <!-- Streamers Stats -->
                <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-6">
                    <div class="bg-gray-700 rounded-lg p-4 text-center">
                        <div class="text-2xl font-bold text-green-400" id="totalStreamers">0</div>
                        <div class="text-sm text-gray-400">Всего стримеров</div>
                    </div>
                    <div class="bg-gray-700 rounded-lg p-4 text-center">
                        <div class="text-2xl font-bold text-blue-400" id="activeStreamers">0</div>
                        <div class="text-sm text-gray-400">Активных</div>
                    </div>
                    <div class="bg-gray-700 rounded-lg p-4 text-center">
                        <div class="text-2xl font-bold text-purple-400" id="totalStreamerGiveaways">0</div>
                        <div class="text-sm text-gray-400">Розыгрышей</div>
                    </div>
                    <div class="bg-gray-700 rounded-lg p-4 text-center">
                        <div class="text-2xl font-bold text-orange-400" id="onlineStreamers">0</div>
                        <div class="text-sm text-gray-400">Онлайн</div>
                    </div>
                </div>
                
                <!-- Streamers Search -->
                <div class="bg-gray-700 rounded-xl p-4">
                    <div class="flex flex-col md:flex-row gap-4">
                        <div class="flex-1">
                            <input type="text" id="streamerSearch" placeholder="🔍 Поиск стримеров..." class="w-full bg-gray-600 border border-gray-500 rounded px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500">
                        </div>
                        <div class="flex gap-2">
                            <select id="streamerSortBy" class="bg-gray-600 border border-gray-500 rounded px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500">
                                <option value="activity">По активности</option>
                                <option value="giveaways">По розыгрышам</option>
                                <option value="lastStream">По последнему стриму</option>
                                <option value="login">По логину</option>
                            </select>
                            <select id="streamerFilterActivity" class="bg-gray-600 border border-gray-500 rounded px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500">
                                <option value="all">Все уровни</option>
                                <option value="high">🔥 Высокий</option>
                                <option value="very_high">🚀 Очень активный</option>
                                <option value="low">💤 Низкий</option>
                            </select>
                        </div>
                    </div>
                </div>
                
                <!-- Streamers Table -->
                <div class="bg-gray-700 rounded-xl overflow-hidden">
                    <div class="overflow-x-auto">
                        <table class="w-full">
                            <thead class="bg-gray-600">
                                <tr>
                                    <th class="px-4 py-3 text-left text-sm font-medium text-gray-300">Стример</th>
                                    <th class="px-4 py-3 text-left text-sm font-medium text-gray-300">Розыгрыши</th>
                                    <th class="px-4 py-3 text-left text-sm font-medium text-gray-300">Последний стрим</th>
                                    <th class="px-4 py-3 text-left text-sm font-medium text-gray-300">Последний вход</th>
                                    <th class="px-4 py-3 text-left text-sm font-medium text-gray-300">Активность</th>
                                    <th class="px-4 py-3 text-center text-sm font-medium text-gray-300">Действия</th>
                                </tr>
                            </thead>
                            <tbody id="streamersTableBody" class="divide-y divide-gray-600">
                                <!-- Streamers will be populated here -->
                            </tbody>
                        </table>
                    </div>
                    
                    <!-- Empty State -->
                    <div id="streamersEmptyState" class="text-center py-8 text-gray-400 hidden">
                        <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="mx-auto mb-4 opacity-50">
                            <polygon points="23 7 16 12 23 17 23 7"></polygon>
                            <rect x="1" y="5" width="15" height="14" rx="2" ry="2"></rect>
                        </svg>
                        <p>Стримеры не найдены</p>
                    </div>
                </div>
            </div>
            
            <!-- Notifications Tab Content -->
            <div id="notificationsContent" class="space-y-6 relative z-10 hidden">
                <!-- Notification Settings -->
                <div class="bg-gray-700 rounded-xl p-6">
                    <h3 class="text-xl font-bold mb-4 flex items-center space-x-2">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"></path>
                            <path d="M13.73 21a2 2 0 0 1-3.46 0"></path>
                        </svg>
                        <span>Настройки уведомлений</span>
                    </h3>
                    
                    <div class="space-y-4">
                        <div class="flex items-center justify-between">
                            <div>
                                <label class="text-sm font-medium">Уведомления о новых стримерах</label>
                                <p class="text-xs text-gray-400">Получать уведомления при регистрации новых стримеров</p>
                            </div>
                            <label class="relative inline-flex items-center cursor-pointer">
                                <input type="checkbox" id="newStreamerNotifications" class="sr-only peer" checked>
                                <div class="w-11 h-6 bg-gray-600 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600"></div>
                            </label>
                        </div>
                        
                        <div class="flex items-center justify-between">
                            <div>
                                <label class="text-sm font-medium">Email отчёты</label>
                                <p class="text-xs text-gray-400">Ежедневные отчёты о новых авторизациях</p>
                            </div>
                            <label class="relative inline-flex items-center cursor-pointer">
                                <input type="checkbox" id="emailReports" class="sr-only peer">
                                <div class="w-11 h-6 bg-gray-600 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600"></div>
                            </label>
                        </div>
                        
                        <div class="flex items-center justify-between">
                            <div>
                                <label class="text-sm font-medium">Discord уведомления</label>
                                <p class="text-xs text-gray-400">Отправлять уведомления в Discord канал</p>
                            </div>
                            <label class="relative inline-flex items-center cursor-pointer">
                                <input type="checkbox" id="discordNotifications" class="sr-only peer">
                                <div class="w-11 h-6 bg-gray-600 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600"></div>
                            </label>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium mb-2">Email для отчётов</label>
                            <input type="email" id="reportEmail" placeholder="admin@example.com" class="w-full bg-gray-600 border border-gray-500 rounded px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500">
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium mb-2">Discord Webhook URL</label>
                            <input type="url" id="discordWebhook" placeholder="https://discord.com/api/webhooks/..." class="w-full bg-gray-600 border border-gray-500 rounded px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500">
                        </div>
                    </div>
                </div>
                
                <!-- Authorization Log -->
                <div class="bg-gray-700 rounded-xl p-6">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="text-xl font-bold flex items-center space-x-2">
                            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                                <polyline points="14,2 14,8 20,8"></polyline>
                                <line x1="16" y1="13" x2="8" y2="13"></line>
                                <line x1="16" y1="17" x2="8" y2="17"></line>
                                <polyline points="10,9 9,9 8,9"></polyline>
                            </svg>
                            <span>Лог авторизаций</span>
                        </h3>
                        <div class="flex space-x-2">
                            <input type="date" id="logStartDate" class="bg-gray-600 border border-gray-500 rounded px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500">
                            <input type="date" id="logEndDate" class="bg-gray-600 border border-gray-500 rounded px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500">
                            <button id="exportLogBtn" class="bg-blue-600 hover:bg-blue-500 text-white px-4 py-2 rounded text-sm transition-all duration-200">
                                📥 Экспорт
                            </button>
                        </div>
                    </div>
                    
                    <!-- Log Table -->
                    <div class="overflow-x-auto">
                        <table class="w-full">
                            <thead class="bg-gray-600">
                                <tr>
                                    <th class="px-4 py-3 text-left text-sm font-medium text-gray-300">Дата</th>
                                    <th class="px-4 py-3 text-left text-sm font-medium text-gray-300">Пользователь</th>
                                    <th class="px-4 py-3 text-left text-sm font-medium text-gray-300">Действие</th>
                                    <th class="px-4 py-3 text-left text-sm font-medium text-gray-300">IP адрес</th>
                                    <th class="px-4 py-3 text-left text-sm font-medium text-gray-300">User Agent</th>
                                </tr>
                            </thead>
                            <tbody id="authLogTableBody" class="divide-y divide-gray-600">
                                <!-- Log entries will be populated here -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Twitch OAuth Configuration
        const TWITCH_CLIENT_ID = '95oaw6ivk75yzuwbjveaav3823a8bd';
        const TWITCH_REDIRECT_URI = window.location.origin + window.location.pathname;
        const TWITCH_SCOPES = ['chat:read', 'user:read:email', 'moderator:manage:banned_users', 'moderator:manage:chat_messages'];
        const TWITCH_AUTH_URL = `https://id.twitch.tv/oauth2/authorize?client_id=${TWITCH_CLIENT_ID}&redirect_uri=${encodeURIComponent(TWITCH_REDIRECT_URI)}&response_type=token&scope=${TWITCH_SCOPES.join('+')}`;

        // Twitch WebSocket Chat Connection
        let twitchWebSocket = null;
        let twitchChannel = null;

        // DOM Elements
        const authModal = document.getElementById('authModal');
        const twitchAuthBtn = document.getElementById('twitchAuthBtn');
        const dashboard = document.getElementById('dashboard');
        const usernameDisplay = document.getElementById('username');
        const streamerAvatar = document.getElementById('streamerAvatar');
        const disconnectBtn = document.getElementById('disconnectBtn');
        const chatContainer = document.getElementById('chatContainer');
        const viewerCount = document.getElementById('viewerCount');
        const newGiveawayBtn = document.getElementById('newGiveawayBtn');
        const giveawaysList = document.getElementById('giveawaysList');
        const winnersList = document.getElementById('winnersList');
        const newGiveawayModal = document.getElementById('newGiveawayModal');
        const closeGiveawayModal = document.getElementById('closeGiveawayModal');
        const cancelGiveawayBtn = document.getElementById('cancelGiveawayBtn');
        const createGiveawayBtn = document.getElementById('createGiveawayBtn');
        const winnerModal = document.getElementById('winnerModal');
        const winnerNames = document.getElementById('winnerNames');
        const closeWinnerModal = document.getElementById('closeWinnerModal');
        const rerollWinnerBtn = document.getElementById('rerollWinnerBtn');
        const winnerChatContainer = document.getElementById('winnerChatContainer');
        const winnerStatus = document.getElementById('winnerStatus');
        const winnerTimerDisplay = document.getElementById('winnerTimer');
        const mobileActionBtn = document.getElementById('mobileActionBtn');
        const mobileMenu = document.getElementById('mobileMenu');
        const closeMobileMenu = document.getElementById('closeMobileMenu');
        const mobileNewGiveawayBtn = document.getElementById('mobileNewGiveawayBtn');
        const mobileDisconnectBtn = document.getElementById('mobileDisconnectBtn');
        const mobileUsername = document.getElementById('mobileUsername');
        const notificationsContainer = document.getElementById('notifications');

        // State
        let isAuthenticated = false;
        let currentUsername = '';
        let activeGiveaways = [];
        let recentWinners = [];
        let chatMessages = [];
        let accessToken = null;
        let giveawayParticipants = {}; // Хранит участников для каждого розыгрыша
        let currentGiveawayForReroll = null; // Для функции перевыбора
        let currentWinners = []; // Текущие победители
        let winnerTimer = null; // Таймер для победителя
        let winnerTimeLeft = 60; // Время в секундах (1 минута)
        let winnerHasResponded = false; // Отвечал ли победитель
        
        // Global settings (for all users)
        let globalSettings = {
            hideUsernames: false,
            hideAvatars: false,
            language: 'ru',
            hideMyUsername: false,
            disableStatistics: false,
            registrationDate: '2025-07-06'
        };

        // Language translations
        const translations = {
            ru: {
                // Header
                title: 'BambooFury Giveaways',
                settings: 'Настройки',
                disconnect: 'Отключить аккаунт',
                
                // Chat
                chatTitle: 'Чат стрима',
                viewers: 'зрителей',
                viewer: 'зритель',
                viewersPlural: 'зрителя',
                offline: 'Офлайн',
                
                // Giveaways
                activeGiveaways: 'Активные розыгрыши',
                newGiveaway: 'Новый розыгрыш',
                noActiveGiveaways: 'Нет активных розыгрышей',
                command: 'Команда',
                winners: 'Победителей',
                participants: 'участников',
                active: 'Активен',
                completed: 'Завершен',
                selectWinner: 'Выбрать победителя',
                end: 'Завершить',
                delete: 'Удалить',
                created: 'Создан',
                
                // Recent winners
                recentWinners: 'Последние победители',
                noWinners: 'Пока нет победителей',
                clearHistory: 'Очистить историю',
                
                // Modals
                newGiveawayTitle: 'Новый розыгрыш',
                giveawayName: 'Название розыгрыша',
                keyword: 'Ключевое слово',
                winnerCount: 'Количество победителей',
                cancel: 'Отмена',
                startGiveaway: '🎊 Начать розыгрыш',
                
                // Winner announcement
                winnersAnnouncement: 'Победители розыгрыша!',
                reroll: '🎲 Перевыбрать',
                close: 'Закрыть',
                winnerChat: 'Чат победителя',
                waitingForWinner: 'Ожидание сообщений от победителя...',
                
                // Settings modal
                settingsTitle: 'Настройки',
                interfaceSettings: '🎨 Интерфейс',
                privacySettings: '⚠️ Конфиденциальность',
                otherSettings: '🧾 Прочее',
                hideUsernames: 'Скрыть ники участников',
                hideUsernamesDesc: 'Показывать ******* вместо настоящих ников',
                hideAvatars: 'Скрыть аватарки',
                hideAvatarsDesc: 'Показывать только инициалы пользователей',
                language: 'Язык интерфейса',
                hideMyUsername: 'Скрыть мой Twitch логин в списках участников',
                hideMyUsernameDesc: 'Другие пользователи не увидят ваш ник в розыгрышах',
                disableStatistics: 'Отключить статистику по участию',
                disableStatisticsDesc: 'Не сохранять данные о ваших участиях в розыгрышах',
                clearGiveawayHistory: 'Очистить историю розыгрышей',
                registrationDate: 'Дата регистрации на сайте',
                deleteAccount: 'Удалить аккаунт с сайта',
                reportBug: 'Сообщить об ошибке / предложить идею',
                saveSettings: 'Сохранить настройки',
                reset: 'Сброс',
                
                // Notifications
                connected: 'Подключен к чату!',
                connectionLost: 'Соединение с чатом потеряно',
                chatError: 'Ошибка подключения к чату',
                settingsSaved: 'Настройки сохранены!',
                languageChanged: 'Язык изменен',
                dataCleared: 'Данные очищены',
                
                // Time
                justNow: 'только что',
                minuteAgo: 'минуту назад',
                minutesAgo: 'минут назад',
                hourAgo: 'час назад',
                hoursAgo: 'часов назад',
                dayAgo: 'день назад',
                daysAgo: 'дней назад'
            },
            en: {
                // Header
                title: 'BambooFury Giveaways',
                settings: 'Settings',
                disconnect: 'Disconnect account',
                
                // Chat
                chatTitle: 'Stream chat',
                viewers: 'viewers',
                viewer: 'viewer',
                viewersPlural: 'viewers',
                offline: 'Offline',
                
                // Giveaways
                activeGiveaways: 'Active giveaways',
                newGiveaway: 'New giveaway',
                noActiveGiveaways: 'No active giveaways',
                command: 'Command',
                winners: 'Winners',
                participants: 'participants',
                active: 'Active',
                completed: 'Completed',
                selectWinner: 'Select winner',
                end: 'End',
                delete: 'Delete',
                created: 'Created',
                
                // Recent winners
                recentWinners: 'Recent winners',
                noWinners: 'No winners yet',
                clearHistory: 'Clear history',
                
                // Modals
                newGiveawayTitle: 'New giveaway',
                giveawayName: 'Giveaway name',
                keyword: 'Keyword',
                winnerCount: 'Number of winners',
                cancel: 'Cancel',
                startGiveaway: '🎊 Start giveaway',
                
                // Winner announcement
                winnersAnnouncement: 'Giveaway winners!',
                reroll: '🎲 Reroll',
                close: 'Close',
                winnerChat: 'Winner chat',
                waitingForWinner: 'Waiting for winner messages...',
                
                // Settings modal
                settingsTitle: 'Settings',
                interfaceSettings: '🎨 Interface',
                privacySettings: '⚠️ Privacy',
                otherSettings: '🧾 Other',
                hideUsernames: 'Hide participant nicknames',
                hideUsernamesDesc: 'Show ******* instead of real nicknames',
                hideAvatars: 'Hide avatars',
                hideAvatarsDesc: 'Show only user initials',
                language: 'Interface language',
                hideMyUsername: 'Hide my Twitch login in participant lists',
                hideMyUsernameDesc: 'Other users will not see your nickname in giveaways',
                disableStatistics: 'Disable participation statistics',
                disableStatisticsDesc: 'Do not save data about your giveaway participation',
                clearGiveawayHistory: 'Clear giveaway history',
                registrationDate: 'Site registration date',
                deleteAccount: 'Delete account from site',
                reportBug: 'Report bug / suggest idea',
                saveSettings: 'Save settings',
                reset: 'Reset',
                
                // Notifications
                connected: 'Connected to chat!',
                connectionLost: 'Chat connection lost',
                chatError: 'Chat connection error',
                settingsSaved: 'Settings saved!',
                languageChanged: 'Language changed',
                dataCleared: 'Data cleared',
                
                // Time
                justNow: 'just now',
                minuteAgo: 'a minute ago',
                minutesAgo: 'minutes ago',
                hourAgo: 'an hour ago',
                hoursAgo: 'hours ago',
                dayAgo: 'a day ago',
                daysAgo: 'days ago'
            },
            ua: {
                // Header
                title: 'BambooFury Розіграші',
                settings: 'Налаштування',
                disconnect: 'Відключити аккаунт',
                
                // Chat
                chatTitle: 'Чат стріму',
                viewers: 'глядачів',
                viewer: 'глядач',
                viewersPlural: 'глядача',
                offline: 'Офлайн',
                
                // Giveaways
                activeGiveaways: 'Активні розіграші',
                newGiveaway: 'Новий розіграш',
                noActiveGiveaways: 'Немає активних розіграшів',
                command: 'Команда',
                winners: 'Переможців',
                participants: 'учасників',
                active: 'Активний',
                completed: 'Завершено',
                selectWinner: 'Обрати переможця',
                end: 'Завершити',
                delete: 'Видалити',
                created: 'Створено',
                
                // Recent winners
                recentWinners: 'Останні переможці',
                noWinners: 'Поки немає переможців',
                clearHistory: 'Очистити історію',
                
                // Modals
                newGiveawayTitle: 'Новий розіграш',
                giveawayName: 'Назва розіграшу',
                keyword: 'Ключове слово',
                winnerCount: 'Кількість переможців',
                cancel: 'Скасувати',
                startGiveaway: '🎊 Почати розіграш',
                
                // Winner announcement
                winnersAnnouncement: 'Переможці розіграшу!',
                reroll: '🎲 Перевибрати',
                close: 'Закрити',
                winnerChat: 'Чат переможця',
                waitingForWinner: 'Очікування повідомлень від переможця...',
                
                // Settings modal
                settingsTitle: 'Налаштування',
                interfaceSettings: '🎨 Інтерфейс',
                privacySettings: '⚠️ Конфіденційність',
                otherSettings: '🧾 Інше',
                hideUsernames: 'Приховати ніки учасників',
                hideUsernamesDesc: 'Показувати ******* замість справжніх ніків',
                hideAvatars: 'Приховати аватарки',
                hideAvatarsDesc: 'Показувати тільки ініціали користувачів',
                language: 'Мова інтерфейсу',
                hideMyUsername: 'Приховати мій Twitch логін у списках учасників',
                hideMyUsernameDesc: 'Інші користувачі не побачать ваш нік у розіграшах',
                disableStatistics: 'Вимкнути статистику участі',
                disableStatisticsDesc: 'Не зберігати дані про ваші участі в розіграшах',
                clearGiveawayHistory: 'Очистити історію розіграшів',
                registrationDate: 'Дата реєстрації на сайті',
                deleteAccount: 'Видалити аккаунт з сайту',
                reportBug: 'Повідомити про помилку / запропонувати ідею',
                saveSettings: 'Зберегти налаштування',
                reset: 'Скинути',
                
                // Notifications
                connected: 'Підключено до чату!',
                connectionLost: 'З\'єднання з чатом втрачено',
                chatError: 'Помилка підключення до чату',
                settingsSaved: 'Налаштування збережено!',
                languageChanged: 'Мову змінено',
                dataCleared: 'Дані очищено',
                
                // Time
                justNow: 'щойно',
                minuteAgo: 'хвилину тому',
                minutesAgo: 'хвилин тому',
                hourAgo: 'годину тому',
                hoursAgo: 'годин тому',
                dayAgo: 'день тому',
                daysAgo: 'днів тому'
            }
        };

        // Get translation function
        function t(key) {
            const lang = globalSettings.language || 'ru';
            return translations[lang] && translations[lang][key] ? translations[lang][key] : translations.ru[key] || key;
        }

        // Apply language to interface
        function applyLanguageToInterface() {
            try {
                // Header elements
                const titleElement = document.querySelector('h1');
                if (titleElement) {
                    titleElement.innerHTML = `<span class="bg-gradient-to-r from-purple-400 to-pink-500 bg-clip-text text-transparent">${t('title')}</span>`;
                }

                // Update button titles
                const settingsBtn = document.getElementById('globalSettingsBtn');
                if (settingsBtn) settingsBtn.title = t('settings');

                const disconnectBtn = document.getElementById('disconnectBtn');
                if (disconnectBtn) disconnectBtn.title = t('disconnect');

                // Chat section
                const chatTitle = document.querySelector('.bg-gray-700 h2');
                if (chatTitle && chatTitle.textContent.includes('Чат') || chatTitle && chatTitle.textContent.includes('Stream') || chatTitle && chatTitle.textContent.includes('стріму')) {
                    chatTitle.textContent = t('chatTitle');
                }

                // Giveaways section
                const activeGiveawaysTitle = document.querySelector('.bg-gray-800 h2');
                if (activeGiveawaysTitle && (activeGiveawaysTitle.textContent.includes('Активные') || activeGiveawaysTitle.textContent.includes('Active') || activeGiveawaysTitle.textContent.includes('Активні'))) {
                    activeGiveawaysTitle.textContent = t('activeGiveaways');
                }

                const newGiveawayBtn = document.getElementById('newGiveawayBtn');
                if (newGiveawayBtn) {
                    newGiveawayBtn.textContent = t('newGiveaway');
                }

                // Recent winners section
                const recentWinnersTitle = document.querySelectorAll('.bg-gray-800 h2')[1];
                if (recentWinnersTitle && (recentWinnersTitle.textContent.includes('Последние') || recentWinnersTitle.textContent.includes('Recent') || recentWinnersTitle.textContent.includes('Останні'))) {
                    recentWinnersTitle.textContent = t('recentWinners');
                }

                // Settings modal elements
                const settingsModalTitle = document.querySelector('#globalSettingsModal h2');
                if (settingsModalTitle) {
                    settingsModalTitle.innerHTML = `<span class="bg-gradient-to-r from-purple-400 to-pink-400 bg-clip-text text-transparent">${t('settingsTitle')}</span>`;
                }

                // Update all static text elements
                updateStaticTextElements();

                console.log(`Язык интерфейса изменен на: ${globalSettings.language}`);
            } catch (error) {
                console.error('Ошибка применения языка к интерфейсу:', error);
            }
        }

        // Update static text elements
        function updateStaticTextElements() {
            // Settings modal sections - используем правильный поиск по содержимому
            const allSpans = document.querySelectorAll('#globalSettingsModal span');
            
            allSpans.forEach(span => {
                const text = span.textContent.trim();
                if (text.includes('🎨')) {
                    span.textContent = t('interfaceSettings');
                } else if (text.includes('⚠️')) {
                    span.textContent = t('privacySettings');
                } else if (text.includes('🧾')) {
                    span.textContent = t('otherSettings');
                }
            });

            // Update labels and descriptions
            updateFormLabels();
        }

        // Update form labels
        function updateFormLabels() {
            try {
                // Settings form elements - используем более безопасный поиск
                const settingsModal = document.getElementById('globalSettingsModal');
                if (!settingsModal) return;

                // Обновляем чекбоксы и их описания
                const checkboxContainers = settingsModal.querySelectorAll('.flex.items-center.justify-between');
                checkboxContainers.forEach(container => {
                    const checkbox = container.querySelector('input[type="checkbox"]');
                    const label = container.querySelector('label');
                    const desc = container.querySelector('.text-xs.text-gray-400');
                    
                    if (checkbox && label) {
                        const checkboxId = checkbox.id;
                        switch(checkboxId) {
                            case 'hideUsernames':
                                label.textContent = t('hideUsernames');
                                if (desc) desc.textContent = t('hideUsernamesDesc');
                                break;
                            case 'hideAvatars':
                                label.textContent = t('hideAvatars');
                                if (desc) desc.textContent = t('hideAvatarsDesc');
                                break;
                            case 'hideMyUsername':
                                label.textContent = t('hideMyUsername');
                                if (desc) desc.textContent = t('hideMyUsernameDesc');
                                break;
                            case 'disableStatistics':
                                label.textContent = t('disableStatistics');
                                if (desc) desc.textContent = t('disableStatisticsDesc');
                                break;
                        }
                    }
                });

                // Обновляем кнопки
                const saveBtn = document.getElementById('saveGlobalSettings');
                if (saveBtn) {
                    const span = saveBtn.querySelector('span');
                    if (span) span.textContent = t('saveSettings');
                }

                const resetBtn = document.getElementById('resetGlobalSettings');
                if (resetBtn) resetBtn.textContent = t('reset');

                const clearHistoryBtn = document.getElementById('clearGiveawayHistory');
                if (clearHistoryBtn) {
                    const span = clearHistoryBtn.querySelector('span');
                    if (span) span.textContent = t('clearGiveawayHistory');
                }

                const deleteAccountBtn = document.getElementById('deleteAccountBtn');
                if (deleteAccountBtn) {
                    const span = deleteAccountBtn.querySelector('span');
                    if (span) span.textContent = t('deleteAccount');
                }

                const reportBugBtn = document.getElementById('reportBugBtn');
                if (reportBugBtn) {
                    const span = reportBugBtn.querySelector('span');
                    if (span) span.textContent = t('reportBug');
                }

                // Обновляем селектор языка
                const langLabel = settingsModal.querySelector('label[for="language"]');
                if (langLabel) langLabel.textContent = t('language');

                // Обновляем дату регистрации
                const allLabels = settingsModal.querySelectorAll('label');
                allLabels.forEach(label => {
                    if (label.textContent.includes('регистрации') || label.textContent.includes('registration') || label.textContent.includes('реєстрації')) {
                        label.textContent = t('registrationDate');
                    }
                });

            } catch (error) {
                console.error('Ошибка обновления форм:', error);
            }
        }
        
        // Channel settings (BambooFury only)
        let channelSettings = {
            autoAnnounce: true,
            soundNotifications: false,
            responseTimeout: 60,
            autoModeration: false,
            timeoutDuration: 10,
            bannedWords: [],
            maxParticipants: 1000,
            minFollowDays: 0,
            followersOnly: false
        };
        
        // Check if current user is BambooFury
        let isBambooFury = false;
        
        // User management data
        let registeredUsers = [];
        let registeredStreamers = [];
        let authorizationLog = [];
        let notificationSettings = {
            newStreamerNotifications: true,
            emailReports: false,
            discordNotifications: false,
            reportEmail: '',
            discordWebhook: ''
        };
        
        // User management UI settings
        let userManagementSettings = {
            // Users tab
            userSearch: '',
            userSortBy: 'date',
            userFilterStatus: 'all',
            // Streamers tab  
            streamerSearch: '',
            streamerSortBy: 'activity',
            streamerFilterActivity: 'all',
            // Notifications tab
            logStartDate: '',
            logEndDate: '',
            // Active tab
            activeTab: 'users'
        };

        // Notification System
        function showNotification(message, type = 'info') {
            const notification = document.createElement('div');
            notification.className = `px-4 py-3 rounded-lg text-white font-medium ${type === 'success' ? 'success-message' : type === 'error' ? 'error-message' : 'bg-blue-600'} slide-in`;
            notification.textContent = message;
            
            notificationsContainer.appendChild(notification);
            
            setTimeout(() => {
                notification.remove();
            }, 4000);
        }

        // Check for OAuth token in URL hash
        function checkAuth() {
            const hash = window.location.hash.substring(1);
            const params = new URLSearchParams(hash);
            const token = params.get('access_token');
            
            if (token) {
                // Store token and remove from URL
                localStorage.setItem('twitch_access_token', token);
                window.location.hash = '';
                
                // Get user info
                fetchUserInfo(token);
            } else {
                // Check for stored token
                const storedToken = localStorage.getItem('twitch_access_token');
                if (storedToken) {
                    fetchUserInfo(storedToken);
                } else {
                    // Show auth modal
                    authModal.classList.remove('hidden');
                }
            }
        }

        // Fetch user info from Twitch API
        async function fetchUserInfo(token) {
            try {
                const response = await fetch('https://api.twitch.tv/helix/users', {
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'Client-Id': TWITCH_CLIENT_ID
                    }
                });
                
                if (!response.ok) {
                    throw new Error('Failed to fetch user info');
                }
                
                const data = await response.json();
                
                if (data.data && data.data.length > 0) {
                    const user = data.data[0];
                    currentUsername = user.display_name;
                    twitchChannel = user.login; // Имя канала в нижнем регистре
                    accessToken = token;
                    
                    // Check if user is BambooFury
                    isBambooFury = checkIfBambooFury(user.login);
                    
                    // Hide auth modal and show dashboard
                    authModal.classList.add('hidden');
                    dashboard.classList.remove('hidden');
                    isAuthenticated = true;
                    
                    // Update UI
                    usernameDisplay.textContent = currentUsername;
                    mobileUsername.textContent = `Подключен как: ${currentUsername}`;
                    updateConnectionStatus(true);
                    
                    // Show BambooFury indicator if applicable
                    if (isBambooFury) {
                        usernameDisplay.innerHTML = `${currentUsername} <span class="text-xs bg-gradient-to-r from-purple-500 to-pink-500 px-2 py-1 rounded-full ml-2">ВЛАДЕЛЕЦ</span>`;
                        
                        // Load settings first, then initialize data with longer delay
                        setTimeout(() => {
                            console.log('Инициализация настроек BambooFury...');
                            loadChannelSettings();
                            initializeUserManagementData();
                        }, 500);
                    }
                    
                    // Load streamer avatar
                    loadStreamerAvatar(user.profile_image_url, currentUsername);
                    
                    // Show success notification
                    showNotification(`Добро пожаловать, ${currentUsername}!`, 'success');
                    
                    // Initialize demo data
                    initializeDemoData();
                    
                    // Connect to real Twitch chat
                    connectToTwitchChat();
                } else {
                    throw new Error('No user data received');
                }
            } catch (error) {
                console.error('Error fetching user info:', error);
                showNotification('Ошибка при получении данных пользователя', 'error');
                localStorage.removeItem('twitch_access_token');
                authModal.classList.remove('hidden');
                dashboard.classList.add('hidden');
            }
        }

        // Load saved data from localStorage
        function loadSavedData() {
            try {
                // Load recent winners
                const savedWinners = localStorage.getItem(`bamboofury_winners_${twitchChannel}`);
                if (savedWinners) {
                    recentWinners = JSON.parse(savedWinners);
                    
                    // Convert time strings back to Date objects for existing winners
                    recentWinners.forEach(winner => {
                        if (winner.time && typeof winner.time === 'string' && winner.time !== 'только что') {
                            try {
                                winner.time = new Date(winner.time);
                            } catch (e) {
                                winner.time = new Date(); // Fallback to current date
                            }
                        } else if (!winner.time || winner.time === 'только что') {
                            winner.time = new Date(); // Set current date for old entries
                        }
                    });
                    
                    console.log('Загружены сохраненные победители:', recentWinners.length);
                }
                
                // Load active giveaways
                const savedGiveaways = localStorage.getItem(`bamboofury_giveaways_${twitchChannel}`);
                if (savedGiveaways) {
                    activeGiveaways = JSON.parse(savedGiveaways);
                    
                    // Convert startTime strings back to Date objects
                    activeGiveaways.forEach(giveaway => {
                        if (giveaway.startTime && typeof giveaway.startTime === 'string') {
                            try {
                                giveaway.startTime = new Date(giveaway.startTime);
                            } catch (e) {
                                giveaway.startTime = new Date(); // Fallback to current date
                            }
                        }
                    });
                    
                    console.log('Загружены сохраненные розыгрыши:', activeGiveaways.length);
                }
                
                // Load giveaway participants
                const savedParticipants = localStorage.getItem(`bamboofury_participants_${twitchChannel}`);
                if (savedParticipants) {
                    giveawayParticipants = JSON.parse(savedParticipants);
                    console.log('Загружены сохраненные участники');
                }
                
                showNotification('Данные загружены из памяти', 'success');
            } catch (error) {
                console.error('Ошибка загрузки сохраненных данных:', error);
                // Reset to empty if error
                recentWinners = [];
                activeGiveaways = [];
                giveawayParticipants = {};
            }
        }

        // Save data to localStorage
        function saveData() {
            try {
                // Save recent winners
                localStorage.setItem(`bamboofury_winners_${twitchChannel}`, JSON.stringify(recentWinners));
                
                // Save active giveaways
                localStorage.setItem(`bamboofury_giveaways_${twitchChannel}`, JSON.stringify(activeGiveaways));
                
                // Save giveaway participants
                localStorage.setItem(`bamboofury_participants_${twitchChannel}`, JSON.stringify(giveawayParticipants));
                
                console.log('Данные сохранены в localStorage');
            } catch (error) {
                console.error('Ошибка сохранения данных:', error);
            }
        }

        // Initialize demo data
        function initializeDemoData() {
            // Load saved data first
            loadSavedData();
            
            renderActiveGiveaways();
            renderRecentWinners();
            
            // Get real viewer count
            fetchViewerCount();
            
            // Update viewer count every 30 seconds
            setInterval(fetchViewerCount, 30000);
            
            // Auto-save data every 30 seconds
            setInterval(saveData, 30000);
            
            // Update winner times every minute
            setInterval(updateWinnerTimes, 60000);
            
            // Preload avatars for known users
            setTimeout(preloadUserAvatars, 2000);
        }

        // Connect to real Twitch chat
        function connectToTwitchChat() {
            if (!twitchChannel) {
                showNotification('Не удалось получить имя канала', 'error');
                return;
            }

            // Clear existing chat
            chatContainer.innerHTML = '<div class="text-center text-gray-500 py-4">Подключение к чату...</div>';
            
            // Create WebSocket connection to Twitch IRC
            twitchWebSocket = new WebSocket('wss://irc-ws.chat.twitch.tv:443');
            
            twitchWebSocket.onopen = () => {
                console.log('Подключение к Twitch IRC установлено');
                
                // Authenticate with Twitch
                twitchWebSocket.send('CAP REQ :twitch.tv/tags twitch.tv/commands');
                twitchWebSocket.send(`PASS oauth:${accessToken}`);
                twitchWebSocket.send(`NICK ${twitchChannel}`);
                
                // Join your channel
                twitchWebSocket.send(`JOIN #${twitchChannel}`);
                
                showNotification('Подключен к чату!', 'success');
                chatContainer.innerHTML = '<div class="text-center text-gray-500 py-4">Подключен к чату. Ждем сообщения...</div>';
                
                // Get initial viewer count
                fetchViewerCount();
            };
            
            twitchWebSocket.onmessage = (event) => {
                handleTwitchMessage(event.data);
            };
            
            twitchWebSocket.onclose = () => {
                console.log('Соединение с Twitch IRC закрыто');
                showNotification('Соединение с чатом потеряно', 'error');
                
                // Попытка переподключения через 5 секунд
                setTimeout(() => {
                    if (isAuthenticated && twitchChannel) {
                        connectToTwitchChat();
                    }
                }, 5000);
            };
            
            twitchWebSocket.onerror = (error) => {
                console.error('Ошибка WebSocket:', error);
                showNotification('Ошибка подключения к чату', 'error');
            };
        }

        // Handle Twitch IRC messages
        function handleTwitchMessage(rawMessage) {
            const lines = rawMessage.split('\r\n');
            
            lines.forEach(line => {
                if (line.trim() === '') return;
                
                // Handle PING to keep connection alive
                if (line.startsWith('PING')) {
                    twitchWebSocket.send('PONG :tmi.twitch.tv');
                    return;
                }
                
                // Parse PRIVMSG (chat messages)
                if (line.includes('PRIVMSG')) {
                    const parsedMessage = parseTwitchMessage(line);
                    if (parsedMessage) {
                        addRealChatMessage(parsedMessage);
                    }
                }
            });
        }

        // Parse Twitch IRC message
        function parseTwitchMessage(line) {
            try {
                // Parse tags
                const tagMatch = line.match(/^@([^ ]+) /);
                const tags = {};
                if (tagMatch) {
                    tagMatch[1].split(';').forEach(tag => {
                        const [key, value] = tag.split('=');
                        tags[key] = value;
                    });
                }
                
                // Parse the message
                const messageMatch = line.match(/:([^!]+)![^ ]+ PRIVMSG #[^ ]+ :(.+)$/);
                if (messageMatch) {
                    const username = messageMatch[1];
                    const message = messageMatch[2];
                    
                    return {
                        username: tags['display-name'] || username,
                        message: message,
                        tags: tags,
                        userId: tags['user-id']
                    };
                }
            } catch (error) {
                console.error('Ошибка парсинга сообщения:', error);
            }
            return null;
        }

        // IP address cache to ensure consistency
        const ipAddressCache = {};
        
        // Simple hash function for consistency
        function hashString(str) {
            let hash = 0;
            for (let i = 0; i < str.length; i++) {
                const char = str.charCodeAt(i);
                hash = ((hash << 5) - hash) + char;
                hash = hash & hash; // Convert to 32-bit integer
            }
            return Math.abs(hash);
        }
        
        // Get user's IP address (simulated for demo with consistency)
        function getUserIP(userId = null, username = null) {
            // If we have a userId, use it as key for consistency
            const userKey = userId || username || 'anonymous';
            
            // Return cached IP if exists
            if (ipAddressCache[userKey]) {
                return ipAddressCache[userKey];
            }
            
            // Generate realistic IP based on user region
            let ipRange;
            
            // Different IP ranges for different user types
            if (username === 'bamboofury' || userKey === 'bamboofury_owner') {
                // Local IP for BambooFury
                ipRange = [192, 168, 1, Math.floor(Math.random() * 255) + 1];
            } else {
                // Common ISP ranges for regular users
                const ranges = [
                    // Russia - major ISP ranges
                    [95, 108], [178, 186], [37, 110], [31, 163], [46, 182],
                    // Europe - common ranges
                    [82, 165], [89, 249], [94, 103],
                    // USA - common ranges
                    [173, 252], [76, 126]
                ];
                
                // Select range based on username hash for consistency
                const hash = hashString(userKey);
                const selectedRange = ranges[hash % ranges.length];
                ipRange = [
                    selectedRange[0],
                    selectedRange[1],
                    (hash >> 8) % 256,
                    (hash >> 16) % 256
                ];
            }
            
            const ipAddress = ipRange.join('.');
            
            // Cache the IP for this user
            ipAddressCache[userKey] = ipAddress;
            
            return ipAddress;
        }
        
        // Get real user IP (in production, this would come from server)
        function getRealUserIP() {
            // In a real application, this would be provided by the server
            // For now, we'll try to get some client info and generate consistent IP
            try {
                // Use some browser/connection info to generate semi-consistent IP
                const connection = navigator.connection || navigator.mozConnection || navigator.webkitConnection;
                const userAgent = navigator.userAgent;
                const language = navigator.language;
                const platform = navigator.platform;
                
                // Create a hash from available info
                const infoString = `${userAgent}_${language}_${platform}_${connection ? connection.effectiveType : 'unknown'}`;
                const hash = hashString(infoString);
                
                // Generate IP based on hash for consistency
                const ranges = [
                    [95, 108], [178, 186], [37, 110], [31, 163], [46, 182],
                    [82, 165], [89, 249], [94, 103], [173, 252], [76, 126]
                ];
                
                const range = ranges[hash % ranges.length];
                return `${range[0]}.${range[1]}.${(hash >> 8) % 256}.${(hash >> 16) % 256}`;
            } catch (error) {
                // Fallback to localhost for errors
                return '127.0.0.1';
            }
        }

        // Add real chat message
        function addRealChatMessage(messageData) {
            const { username, message, tags, userId } = messageData;
            
            // Trigger avatar fetch for new users
            if (userId && !avatarCache[userId]) {
                fetchUserAvatar(userId, username).then(url => {
                    updateAvatarsInChat(userId, url);
                });
            }
            
            // Check if empty chat container
            if (chatContainer.innerHTML.includes('Ждем сообщения...') || chatContainer.innerHTML.includes('Подключен к чату')) {
                chatContainer.innerHTML = '';
            }
            
            // Check if this is a message from a current winner
            if (currentWinners.includes(username)) {
                addWinnerChatMessage(username, message, tags, userId);
            }
            
            // Check for giveaway participation
            const isGiveawayCommand = activeGiveaways.some(g => message.includes(g.keyword));
            
            if (isGiveawayCommand) {
                activeGiveaways.forEach(giveaway => {
                    if (message.includes(giveaway.keyword) && giveaway.status === 'active') {
                        // Initialize participants array if not exists
                        if (!giveawayParticipants[giveaway.id]) {
                            giveawayParticipants[giveaway.id] = [];
                        }
                        
                        // Add participant if not already in list
                        const existingParticipant = giveawayParticipants[giveaway.id].find(p => p.username === username);
                        if (!existingParticipant) {
                            giveawayParticipants[giveaway.id].push({
                                username: username,
                                userId: userId
                            });
                            giveaway.participants = giveawayParticipants[giveaway.id].length;
                            
                            // Track user participation in management system with consistent IP
                            trackUserParticipation(username, userId, giveaway.id);
                            
                            // Save data when new participant joins
                            saveData();
                            
                            // Show notification about new participant
                            showNotification(`${username} участвует в "${giveaway.name}"!`, 'info');
                        }
                    }
                });
                renderActiveGiveaways();
            } else {
                // Just add user to system for tracking (non-giveaway messages) with consistent IP
                addUserToSystem(username, {
                    id: userId,
                    login: username.toLowerCase(),
                    displayName: username,
                    userType: 'viewer',
                    status: 'verified',
                    ipAddress: getUserIP(userId, username)
                });
            }
            
            // Create message element
            const messageElement = document.createElement('div');
            messageElement.className = `chat-message mb-3 ${isGiveawayCommand ? 'border-l-4 border-purple-500 pl-3 bg-gray-700 bg-opacity-30 p-2 rounded' : ''}`;
            
            // Get user color from tags or use default
            const userColor = tags['color'] || '#9146FF';
            
            // Get user avatar
            const avatarUrl = getUserAvatar(userId, username);
            
            // Apply privacy settings
            const displayUsername = globalSettings.hideUsernames ? '*******' : username;
            const shouldHideAvatar = globalSettings.hideAvatars;
            
            messageElement.innerHTML = `
                <div class="flex items-start group">
                    <div class="w-8 h-8 rounded-full flex-shrink-0 flex items-center justify-center mr-2 mt-1 overflow-hidden" style="background-color: ${userColor}">
                        <img src="${avatarUrl}" alt="${username}" class="w-full h-full object-cover" 
                             data-user-id="${userId}" 
                             style="${shouldHideAvatar ? 'display: none;' : 'display: block;'}"
                             onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';">
                        <span class="text-xs text-white ${shouldHideAvatar || avatarUrl.includes('ui-avatars.com') ? 'flex' : 'hidden'} w-full h-full items-center justify-center">${username.charAt(0).toUpperCase()}</span>
                    </div>
                    <div class="flex-1">
                        <div class="flex items-center justify-between">
                            <div class="flex items-center">
                                <span class="font-medium" data-original-username="${username}" style="color: ${userColor}">${displayUsername}</span>
                                <span class="text-gray-400 text-xs ml-2">${new Date().toLocaleTimeString('ru-RU', { hour: '2-digit', minute: '2-digit' })}</span>
                            </div>
                            <div class="flex items-center space-x-2 opacity-0 group-hover:opacity-100 transition-all duration-300">
                                <button class="mod-action mod-warn" 
                                        data-action="warn" data-user="${username}" title="Предупреждение (1 сек мут)">
                                    <span class="relative z-10">
                                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none">
                                            <defs>
                                                <linearGradient id="warnGradient" x1="0%" y1="0%" x2="100%" y2="100%">
                                                    <stop offset="0%" style="stop-color:#FCD34D;stop-opacity:1" />
                                                    <stop offset="100%" style="stop-color:#F59E0B;stop-opacity:1" />
                                                </linearGradient>
                                            </defs>
                                            <path d="M12 2L2 22h20L12 2z" fill="url(#warnGradient)" stroke="#F59E0B" stroke-width="1"/>
                                            <circle cx="12" cy="17" r="1" fill="#FFFBEB"/>
                                            <path d="M12 8v6" stroke="#FFFBEB" stroke-width="2" stroke-linecap="round"/>
                                        </svg>
                                    </span>
                                </button>
                                <button class="mod-action mod-timeout" 
                                        data-action="timeout" data-user="${username}" title="Мут на 10 минут">
                                    <span class="relative z-10">
                                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none">
                                            <defs>
                                                <linearGradient id="timeoutGradient" x1="0%" y1="0%" x2="100%" y2="100%">
                                                    <stop offset="0%" style="stop-color:#FB923C;stop-opacity:1" />
                                                    <stop offset="100%" style="stop-color:#EA580C;stop-opacity:1" />
                                                </linearGradient>
                                            </defs>
                                            <!-- Иконка звука -->
                                            <path d="M11 5L6 9H2v6h4l5 4V5z" fill="url(#timeoutGradient)" stroke="#EA580C" stroke-width="1"/>
                                            <path d="M19.07 4.93l-1.41 1.41A8.5 8.5 0 0 1 20.5 12a8.5 8.5 0 0 1-2.84 5.66l1.41 1.41A10.5 10.5 0 0 0 22.5 12a10.5 10.5 0 0 0-3.43-7.07z" fill="url(#timeoutGradient)"/>
                                            <path d="M15.54 8.46l-1.41 1.41A2.5 2.5 0 0 1 15 12a2.5 2.5 0 0 1-.87 1.13l1.41 1.41A4.5 4.5 0 0 0 17 12a4.5 4.5 0 0 0-1.46-3.54z" fill="url(#timeoutGradient)"/>
                                            <!-- Перечеркивание -->
                                            <path d="M3 3l18 18" stroke="#FFF7ED" stroke-width="3" stroke-linecap="round"/>
                                        </svg>
                                    </span>
                                </button>
                                <button class="mod-action mod-ban" 
                                        data-action="ban" data-user="${username}" title="Постоянный бан">
                                    <span class="relative z-10">
                                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none">
                                            <defs>
                                                <linearGradient id="banGradient" x1="0%" y1="0%" x2="100%" y2="100%">
                                                    <stop offset="0%" style="stop-color:#EF4444;stop-opacity:1" />
                                                    <stop offset="100%" style="stop-color:#DC2626;stop-opacity:1" />
                                                </linearGradient>
                                            </defs>
                                            <!-- Красный круг -->
                                            <circle cx="12" cy="12" r="10" fill="url(#banGradient)" stroke="#DC2626" stroke-width="1"/>
                                            <!-- Горизонтальная линия в середине -->
                                            <path d="M6 12h12" stroke="#FEF2F2" stroke-width="3" stroke-linecap="round"/>
                                        </svg>
                                    </span>
                                </button>
                            </div>
                        </div>
                        <p class="text-gray-100">${message}</p>
                    </div>
                </div>
            `;
            
            chatContainer.appendChild(messageElement);
            
            // Add event listeners to moderation buttons
            messageElement.querySelectorAll('.mod-action').forEach(btn => {
                btn.addEventListener('click', function(e) {
                    e.stopPropagation();
                    const action = this.getAttribute('data-action');
                    const user = this.getAttribute('data-user');
                    handleModerationAction(action, user, messageElement);
                });
            });
            
            // Keep only last 100 messages
            while (chatContainer.children.length > 100) {
                chatContainer.removeChild(chatContainer.firstChild);
            }
            
            // Auto scroll to bottom
            chatContainer.scrollTop = chatContainer.scrollHeight;
        }

        // Add chat message (for demo purposes only)
        function addChatMessage(username, message) {
            const isGiveawayCommand = activeGiveaways.some(g => message.includes(g.keyword));
            
            const messageElement = document.createElement('div');
            messageElement.className = `chat-message mb-3 ${isGiveawayCommand ? 'border-l-4 border-purple-500 pl-3 bg-gray-700 bg-opacity-30 p-2 rounded' : ''}`;
            messageElement.innerHTML = `
                <div class="flex items-start">
                    <div class="w-8 h-8 rounded-full bg-purple-600 flex-shrink-0 flex items-center justify-center mr-2 mt-1">
                        <span class="text-xs">${username.charAt(0).toUpperCase()}</span>
                    </div>
                    <div>
                        <span class="font-medium text-purple-300">${username}</span>
                        <span class="text-gray-400 text-xs ml-2">${new Date().toLocaleTimeString('ru-RU', { hour: '2-digit', minute: '2-digit' })}</span>
                        <p class="text-gray-100">${message}</p>
                    </div>
                </div>
            `;
            
            chatContainer.appendChild(messageElement);
            
            // Keep only last 50 messages
            while (chatContainer.children.length > 50) {
                chatContainer.removeChild(chatContainer.firstChild);
            }
            
            // Auto scroll to bottom
            chatContainer.scrollTop = chatContainer.scrollHeight;
        }

        // Handle Twitch OAuth login
        twitchAuthBtn.addEventListener('click', () => {
            window.location.href = TWITCH_AUTH_URL;
        });

        // Disconnect button
        disconnectBtn.addEventListener('click', () => {
            // Save data before disconnecting
            if (twitchChannel) {
                saveData();
            }
            
            // Save global settings before disconnecting
            saveGlobalSettings();
            
            // Close WebSocket connection
            if (twitchWebSocket) {
                twitchWebSocket.close();
                twitchWebSocket = null;
            }
            
            localStorage.removeItem('twitch_access_token');
            dashboard.classList.add('hidden');
            authModal.classList.remove('hidden');
            isAuthenticated = false;
            currentUsername = '';
            twitchChannel = null;
            accessToken = null;
            
            // Reset current session data but keep saved data and global settings
            activeGiveaways = [];
            recentWinners = [];
            giveawayParticipants = {};
            
            updateConnectionStatus(false);
            showNotification('Аккаунт отключен, настройки сохранены', 'info');
        });

        // Mobile disconnect
        mobileDisconnectBtn.addEventListener('click', () => {
            mobileMenu.classList.add('hidden');
            disconnectBtn.click();
        });

        // Load streamer avatar
        function loadStreamerAvatar(profileImageUrl, username) {
            if (profileImageUrl && streamerAvatar) {
                streamerAvatar.innerHTML = `
                    <img src="${profileImageUrl}" alt="${username}" class="w-full h-full object-cover" 
                         onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';">
                    <span class="text-xs text-white ${profileImageUrl ? 'hidden' : 'flex'} w-full h-full items-center justify-center">${username.charAt(0).toUpperCase()}</span>
                `;
            } else if (streamerAvatar) {
                // Fallback to first letter
                streamerAvatar.innerHTML = `
                    <span class="text-xs text-white w-full h-full flex items-center justify-center">${username.charAt(0).toUpperCase()}</span>
                `;
            }
        }

        // Connection status
        function updateConnectionStatus(isConnected) {
            const statusElement = document.getElementById('connectionStatus');
            
            if (isConnected) {
                statusElement.querySelector('span:last-child').textContent = currentUsername;
                // Avatar is already loaded in loadStreamerAvatar function
            } else {
                statusElement.querySelector('span:last-child').textContent = 'Отключен';
                // Reset avatar to default state
                if (streamerAvatar) {
                    streamerAvatar.innerHTML = '<span class="text-xs text-white">?</span>';
                    streamerAvatar.className = 'w-8 h-8 rounded-full mr-2 overflow-hidden bg-gray-600 flex items-center justify-center';
                }
            }
        }

        // New giveaway modal
        newGiveawayBtn.addEventListener('click', () => {
            newGiveawayModal.classList.remove('hidden');
        });

        mobileNewGiveawayBtn.addEventListener('click', () => {
            mobileMenu.classList.add('hidden');
            newGiveawayModal.classList.remove('hidden');
        });

        // Close giveaway modal
        closeGiveawayModal.addEventListener('click', () => {
            newGiveawayModal.classList.add('hidden');
        });

        cancelGiveawayBtn.addEventListener('click', () => {
            newGiveawayModal.classList.add('hidden');
        });

        // Create new giveaway
        createGiveawayBtn.addEventListener('click', () => {
            const giveawayName = document.getElementById('giveawayName').value.trim();
            const keyword = document.getElementById('keyword').value.trim();
            const winnerCount = document.getElementById('winnerCount').value;
            
            if (!giveawayName || !keyword) {
                showNotification('Заполните все поля', 'error');
                return;
            }
            
            const newGiveaway = {
                id: Date.now().toString(),
                name: giveawayName,
                keyword: '!' + keyword,
                participants: 0,
                winnerCount: parseInt(winnerCount),
                startTime: new Date(),
                status: 'active'
            };
            
            activeGiveaways.push(newGiveaway);
            
            // Initialize participants list for new giveaway
            giveawayParticipants[newGiveaway.id] = [];
            
            // Save data immediately after creating giveaway
            saveData();
            
            renderActiveGiveaways();
            newGiveawayModal.classList.add('hidden');
            
            showNotification(`Розыгрыш "${giveawayName}" начат!`, 'success');
            
            // Clear form
            document.getElementById('giveawayName').value = '';
            document.getElementById('keyword').value = '';
            document.getElementById('winnerCount').value = '1';
        });

        // Render active giveaways
        function renderActiveGiveaways() {
            if (activeGiveaways.length === 0) {
                giveawaysList.innerHTML = `<div class="text-center text-gray-500 py-8">${t('noActiveGiveaways')}</div>`;
                return;
            }
            
            giveawaysList.innerHTML = '';
            
            activeGiveaways.forEach(giveaway => {
                const giveawayElement = document.createElement('div');
                giveawayElement.className = 'bg-gray-700 rounded-lg p-4 neon-border';
                giveawayElement.innerHTML = `
                    <div class="flex justify-between items-start mb-2">
                        <div>
                            <h3 class="font-bold text-lg">${giveaway.name}</h3>
                            <p class="text-sm text-gray-400">Команда: <span class="text-purple-300">${giveaway.keyword}</span></p>
                            <p class="text-sm text-gray-400">Победителей: ${giveaway.winnerCount}</p>
                        </div>
                        <span class="bg-purple-900 text-xs px-2 py-1 rounded-full">
                            ${giveaway.status === 'active' ? 'Активен' : giveaway.status === 'completed' ? 'Завершен' : 'Завершен'} • ${giveaway.participants} участников
                        </span>
                    </div>
                    <div class="mt-3 flex justify-between items-center">
                        <div class="flex space-x-2">
                            <button class="bg-purple-700 hover:bg-purple-600 px-3 py-1 rounded text-sm transition draw-winner ${giveaway.status !== 'active' ? 'opacity-50 cursor-not-allowed' : ''}" data-id="${giveaway.id}" ${giveaway.status !== 'active' ? 'disabled' : ''}>
                                ${giveaway.status === 'active' ? 'Выбрать победителя' : 'Завершен'}
                            </button>
                            <button class="bg-gray-600 hover:bg-gray-500 px-3 py-1 rounded text-sm transition end-giveaway" data-id="${giveaway.id}">
                                ${giveaway.status === 'active' ? 'Завершить' : 'Удалить'}
                            </button>
                        </div>
                        <span class="text-xs text-gray-400">Создан ${formatTimeAgo(giveaway.startTime)}</span>
                    </div>
                `;
                giveawaysList.appendChild(giveawayElement);
            });
            
            // Add event listeners to buttons
            document.querySelectorAll('.draw-winner').forEach(btn => {
                btn.addEventListener('click', function() {
                    if (this.disabled) return;
                    const giveawayId = this.getAttribute('data-id');
                    drawWinner(giveawayId);
                });
            });
            
            document.querySelectorAll('.end-giveaway').forEach(btn => {
                btn.addEventListener('click', function() {
                    const giveawayId = this.getAttribute('data-id');
                    endGiveaway(giveawayId);
                });
            });
        }

        // Render recent winners
        function renderRecentWinners() {
            if (recentWinners.length === 0) {
                winnersList.innerHTML = `<div class="text-center text-gray-500 py-8 col-span-full">${t('noWinners')}</div>`;
                return;
            }
            
            winnersList.innerHTML = '';
            
            recentWinners.forEach(winner => {
                const winnerElement = document.createElement('div');
                winnerElement.className = 'bg-gray-700 rounded-lg p-3';
                
                // Get avatar URL for winner and trigger loading
                let avatarUrl = getUserAvatar(winner.userId, winner.username);
                
                // If we have userId but no cached avatar, start loading and use placeholder
                if (winner.userId && !avatarCache[winner.userId]) {
                    avatarUrl = `https://ui-avatars.com/api/?name=${encodeURIComponent(winner.username)}&background=9146FF&color=fff&size=70&rounded=true`;
                    
                    // Trigger async loading
                    fetchUserAvatar(winner.userId, winner.username).then(realAvatarUrl => {
                        // Update this specific winner's avatar when loaded
                        const img = winnerElement.querySelector(`img[data-user-id="${winner.userId}"]`);
                        const fallbackSpan = winnerElement.querySelector('.text-lg');
                        
                        if (img && fallbackSpan && realAvatarUrl && !realAvatarUrl.includes('ui-avatars.com')) {
                            img.src = realAvatarUrl;
                            img.style.display = 'block';
                            fallbackSpan.style.display = 'none';
                        }
                    });
                }
                
                // Calculate time text
                const timeText = winner.time instanceof Date ? formatTimeAgo(winner.time) : (winner.timeText || winner.time);
                
                // Apply privacy settings
                const displayUsername = globalSettings.hideUsernames ? '*******' : winner.username;
                const shouldHideAvatar = globalSettings.hideAvatars;
                
                winnerElement.innerHTML = `
                    <div class="flex items-center space-x-3">
                        <div class="w-10 h-10 rounded-full bg-purple-600 flex items-center justify-center overflow-hidden">
                            <img src="${avatarUrl}" alt="${winner.username}" class="w-full h-full object-cover" 
                                 data-user-id="${winner.userId}" 
                                 style="${shouldHideAvatar || avatarUrl.includes('ui-avatars.com') ? 'display: none;' : 'display: block;'}"
                                 onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';">
                            <span class="text-lg ${shouldHideAvatar || avatarUrl.includes('ui-avatars.com') ? 'flex' : 'hidden'} w-full h-full items-center justify-center text-white">${winner.username.charAt(0).toUpperCase()}</span>
                        </div>
                        <div>
                            <p class="font-medium" data-original-username="${winner.username}">${displayUsername}</p>
                            <p class="text-xs text-gray-400">${winner.giveaway} • <span class="winner-time-text">${timeText}</span></p>
                        </div>
                    </div>
                `;
                winnersList.appendChild(winnerElement);
            });
        }

        // Draw winner
        function drawWinner(giveawayId) {
            const giveaway = activeGiveaways.find(g => g.id === giveawayId);
            const participants = giveawayParticipants[giveawayId] || [];
            
            if (!giveaway) {
                showNotification('Розыгрыш не найден', 'error');
                return;
            }
            
            if (participants.length === 0) {
                showNotification('Нет участников для розыгрыша. Попросите зрителей написать команду в чате!', 'error');
                return;
            }
            
            // Create a copy of participants to avoid modifying original
            const availableParticipants = [...participants];
            const winners = [];
            
            // Select random winners from real participants
            for (let i = 0; i < giveaway.winnerCount && i < availableParticipants.length; i++) {
                const randomIndex = Math.floor(Math.random() * availableParticipants.length);
                const selectedParticipant = availableParticipants[randomIndex];
                winners.push(typeof selectedParticipant === 'string' ? selectedParticipant : selectedParticipant.username);
                availableParticipants.splice(randomIndex, 1);
            }
            
            // Show winners
            announceWinners(winners, giveaway.name);
            
            // Store current giveaway for reroll
            currentGiveawayForReroll = giveaway;
            
            // Set current winners and start monitoring
            currentWinners = winners;
            startWinnerMonitoring();
            
            // Add to recent winners
            winners.forEach(winner => {
                // Find user ID from participants if available
                const participant = giveawayParticipants[giveaway.id] ? 
                    giveawayParticipants[giveaway.id].find(p => (typeof p === 'string' ? p : p.username) === winner) : null;
                
                recentWinners.unshift({
                    id: Date.now().toString() + Math.random(),
                    username: winner,
                    userId: participant && typeof participant === 'object' ? participant.userId : null,
                    giveaway: giveaway.name,
                    time: new Date(), // Сохраняем реальную дату
                    timeText: 'только что'
                });
            });
            
            // Auto-announce winners if enabled
            if (isBambooFury && channelSettings.autoAnnounce && twitchWebSocket && twitchWebSocket.readyState === WebSocket.OPEN) {
                const winnersList = winners.join(', ');
                const announcement = `🎊 Поздравляем победителей розыгрыша "${giveaway.name}": ${winnersList}! 🎉`;
                
                setTimeout(() => {
                    twitchWebSocket.send(`PRIVMSG #${twitchChannel} :${announcement}`);
                    console.log('Автоматически объявлены победители в чате');
                }, 1000);
            }
            
            // Limit recent winners to 6
            recentWinners = recentWinners.slice(0, 6);
            
            // Mark giveaway as completed
            giveaway.status = 'completed';
            
            // Save data after drawing winners
            saveData();
            
            renderRecentWinners();
            renderActiveGiveaways();
            
            showNotification(`Победители выбраны для "${giveaway.name}"!`, 'success');
        }

        // End giveaway
        function endGiveaway(giveawayId) {
            const giveawayIndex = activeGiveaways.findIndex(g => g.id === giveawayId);
            if (giveawayIndex === -1) return;
            
            const giveaway = activeGiveaways[giveawayIndex];
            
            if (giveaway.status === 'active') {
                activeGiveaways[giveawayIndex].status = 'ended';
                showNotification(`Розыгрыш "${giveaway.name}" завершен`, 'info');
            } else {
                activeGiveaways.splice(giveawayIndex, 1);
                // Remove participants data
                delete giveawayParticipants[giveawayId];
                showNotification(`Розыгрыш "${giveaway.name}" удален`, 'info');
            }
            
            // Save data after ending/deleting giveaway
            saveData();
            
            renderActiveGiveaways();
        }

        // Announce winners
        function announceWinners(winners, giveawayName) {
            winnerNames.innerHTML = '';
            
            // Show giveaway name
            const giveawayTitle = document.createElement('div');
            giveawayTitle.className = 'text-lg mb-4 text-gray-300';
            giveawayTitle.textContent = `Розыгрыш: ${giveawayName}`;
            winnerNames.appendChild(giveawayTitle);
            
            // Show winners
            winners.forEach((winner, index) => {
                const winnerElement = document.createElement('div');
                winnerElement.className = 'text-2xl font-bold celebrate-animation py-2 neon-text';
                
                // Different emojis for different positions
                const positionEmojis = ['🥇', '🥈', '🥉', '🏆', '⭐'];
                const emoji = positionEmojis[index] || '🎯';
                
                winnerElement.innerHTML = `
                    <div class="flex items-center justify-center space-x-2">
                        <span class="text-3xl">${emoji}</span>
                        <span>${winner}</span>
                        <span class="text-purple-400">🎉</span>
                    </div>
                `;
                winnerNames.appendChild(winnerElement);
            });
            
            winnerModal.classList.remove('hidden');
        }

        // Close winner modal
        closeWinnerModal.addEventListener('click', () => {
            winnerModal.classList.add('hidden');
            currentGiveawayForReroll = null;
            stopWinnerMonitoring();
        });
        
        // Reroll winner
        rerollWinnerBtn.addEventListener('click', () => {
            if (!currentGiveawayForReroll) {
                showNotification('Нет активного розыгрыша для перевыбора', 'error');
                return;
            }
            
            const participants = giveawayParticipants[currentGiveawayForReroll.id] || [];
            
            if (participants.length === 0) {
                showNotification('Нет участников для перевыбора', 'error');
                return;
            }
            
            // Create a copy of participants to avoid modifying original
            const availableParticipants = [...participants];
            const newWinners = [];
            
            // Select new random winners from real participants
            for (let i = 0; i < currentGiveawayForReroll.winnerCount && i < availableParticipants.length; i++) {
                const randomIndex = Math.floor(Math.random() * availableParticipants.length);
                const selectedParticipant = availableParticipants[randomIndex];
                newWinners.push(typeof selectedParticipant === 'string' ? selectedParticipant : selectedParticipant.username);
                availableParticipants.splice(randomIndex, 1);
            }
            
            // Update winner names display
            winnerNames.innerHTML = '';
            
            // Show giveaway name
            const giveawayTitle = document.createElement('div');
            giveawayTitle.className = 'text-lg mb-4 text-gray-300';
            giveawayTitle.textContent = `Розыгрыш: ${currentGiveawayForReroll.name}`;
            winnerNames.appendChild(giveawayTitle);
            
            // Show new winners
            newWinners.forEach((winner, index) => {
                const winnerElement = document.createElement('div');
                winnerElement.className = 'text-2xl font-bold celebrate-animation py-2 neon-text';
                
                // Different emojis for different positions
                const positionEmojis = ['🥇', '🥈', '🥉', '🏆', '⭐'];
                const emoji = positionEmojis[index] || '🎯';
                
                winnerElement.innerHTML = `
                    <div class="flex items-center justify-center space-x-2">
                        <span class="text-3xl">${emoji}</span>
                        <span>${winner}</span>
                        <span class="text-purple-400">🎉</span>
                    </div>
                `;
                winnerNames.appendChild(winnerElement);
            });
            
            // Add new winners to recent winners (replace old ones)
            // Remove previous winners from the same giveaway
            recentWinners = recentWinners.filter(w => w.giveaway !== currentGiveawayForReroll.name);
            
            newWinners.forEach(winner => {
                // Find user ID from participants if available
                const participant = giveawayParticipants[currentGiveawayForReroll.id] ? 
                    giveawayParticipants[currentGiveawayForReroll.id].find(p => (typeof p === 'string' ? p : p.username) === winner) : null;
                
                recentWinners.unshift({
                    id: Date.now().toString() + Math.random(),
                    username: winner,
                    userId: participant && typeof participant === 'object' ? participant.userId : null,
                    giveaway: currentGiveawayForReroll.name,
                    time: new Date(), // Сохраняем реальную дату
                    timeText: 'только что'
                });
            });
            
            // Limit recent winners to 6
            recentWinners = recentWinners.slice(0, 6);
            
            // Save data after reroll
            saveData();
            
            renderRecentWinners();
            
            showNotification(`Победители перевыбраны для "${currentGiveawayForReroll.name}"!`, 'success');
            
            // Update current winners and restart monitoring
            currentWinners = newWinners;
            startWinnerMonitoring();
        });

        // Mobile menu
        mobileActionBtn.addEventListener('click', () => {
            mobileMenu.classList.remove('hidden');
        });

        closeMobileMenu.addEventListener('click', () => {
            mobileMenu.classList.add('hidden');
        });

        // Fetch real viewer count from Twitch API
        async function fetchViewerCount() {
            if (!accessToken || !twitchChannel) return;
            
            try {
                const response = await fetch(`https://api.twitch.tv/helix/streams?user_login=${twitchChannel}`, {
                    headers: {
                        'Authorization': `Bearer ${accessToken}`,
                        'Client-Id': TWITCH_CLIENT_ID
                    }
                });
                
                if (response.ok) {
                    const data = await response.json();
                    
                    if (data.data && data.data.length > 0) {
                        const stream = data.data[0];
                        const viewers = stream.viewer_count;
                        updateViewerCount(viewers);
                    } else {
                        // Stream is offline
                        updateViewerCount(0);
                    }
                } else {
                    console.error('Ошибка получения данных о зрителях:', response.status);
                }
            } catch (error) {
                console.error('Ошибка при запросе количества зрителей:', error);
            }
        }

        // Update viewer count display
        function updateViewerCount(count) {
            let statusText;
            if (count === 0) {
                statusText = t('offline');
            } else {
                const viewerWord = count === 1 ? t('viewer') : count < 5 ? t('viewersPlural') : t('viewers');
                statusText = `${count} ${viewerWord}`;
            }
            
            viewerCount.textContent = statusText;
            
            // Update viewer count color based on status
            if (count === 0) {
                viewerCount.className = 'bg-gray-600 text-xs px-2 py-1 rounded-full';
            } else {
                viewerCount.className = 'bg-purple-900 text-xs px-2 py-1 rounded-full';
            }
        }

        // Format time ago
        function formatTimeAgo(date) {
            const seconds = Math.floor((new Date() - date) / 1000);
            
            if (seconds < 60) return t('justNow');
            
            const minutes = Math.floor(seconds / 60);
            if (minutes < 60) {
                if (minutes === 1) return t('minuteAgo');
                return `${minutes} ${t('minutesAgo')}`;
            }
            
            const hours = Math.floor(minutes / 60);
            if (hours < 24) {
                if (hours === 1) return t('hourAgo');
                return `${hours} ${t('hoursAgo')}`;
            }
            
            const days = Math.floor(hours / 24);
            if (days === 1) return t('dayAgo');
            return `${days} ${t('daysAgo')}`;
        }

        // Add winner chat message
        function addWinnerChatMessage(username, message, tags, userId) {
            // Check if empty winner chat container
            if (winnerChatContainer.innerHTML.includes('Ожидание сообщений') || winnerChatContainer.children.length === 0) {
                winnerChatContainer.innerHTML = '';
            }
            
            // Mark winner as responded
            if (!winnerHasResponded) {
                winnerHasResponded = true;
                updateWinnerStatus(true);
                showNotification(`${username} ответил в чате!`, 'success');
            }
            
            // Get user color from tags or use default
            const userColor = tags['color'] || '#9146FF';
            
            // Get user avatar
            const avatarUrl = getUserAvatar(userId, username);
            
            // Apply privacy settings
            const displayUsername = globalSettings.hideUsernames ? '*******' : username;
            const shouldHideAvatar = globalSettings.hideAvatars;
            
            // Create message element
            const messageElement = document.createElement('div');
            messageElement.className = 'winner-chat-message mb-3 border-l-4 border-green-500 pl-3 bg-green-700 bg-opacity-20 p-2 rounded';
            
            messageElement.innerHTML = `
                <div class="flex items-start group">
                    <div class="w-8 h-8 rounded-full flex-shrink-0 flex items-center justify-center mr-2 mt-1 overflow-hidden" style="background-color: ${userColor}">
                        <img src="${avatarUrl}" alt="${username}" class="w-full h-full object-cover" 
                             data-user-id="${userId}" 
                             style="${shouldHideAvatar ? 'display: none;' : 'display: block;'}"
                             onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';">
                        <span class="text-xs text-white ${shouldHideAvatar || avatarUrl.includes('ui-avatars.com') ? 'flex' : 'hidden'} w-full h-full items-center justify-center">${username.charAt(0).toUpperCase()}</span>
                    </div>
                    <div class="flex-1">
                        <div class="flex items-center justify-between">
                            <div class="flex items-center">
                                <span class="font-medium" data-original-username="${username}" style="color: ${userColor}">${displayUsername}</span>
                                <span class="text-yellow-400 text-xs ml-2">👑 ПОБЕДИТЕЛЬ</span>
                                <span class="text-gray-400 text-xs ml-2">${new Date().toLocaleTimeString('ru-RU', { hour: '2-digit', minute: '2-digit' })}</span>
                            </div>
                            <div class="flex items-center space-x-2 opacity-0 group-hover:opacity-100 transition-all duration-300">
                                <button class="mod-action mod-warn" 
                                        data-action="warn" data-user="${username}" title="Предупреждение (1 сек мут)">
                                    <span class="relative z-10">
                                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none">
                                            <defs>
                                                <linearGradient id="warnGradient2" x1="0%" y1="0%" x2="100%" y2="100%">
                                                    <stop offset="0%" style="stop-color:#FCD34D;stop-opacity:1" />
                                                    <stop offset="100%" style="stop-color:#F59E0B;stop-opacity:1" />
                                                </linearGradient>
                                            </defs>
                                            <path d="M12 2L2 22h20L12 2z" fill="url(#warnGradient2)" stroke="#F59E0B" stroke-width="1"/>
                                            <circle cx="12" cy="17" r="1" fill="#FFFBEB"/>
                                            <path d="M12 8v6" stroke="#FFFBEB" stroke-width="2" stroke-linecap="round"/>
                                        </svg>
                                    </span>
                                </button>
                                <button class="mod-action mod-timeout" 
                                        data-action="timeout" data-user="${username}" title="Мут на 10 минут">
                                    <span class="relative z-10">
                                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none">
                                            <defs>
                                                <linearGradient id="timeoutGradient2" x1="0%" y1="0%" x2="100%" y2="100%">
                                                    <stop offset="0%" style="stop-color:#FB923C;stop-opacity:1" />
                                                    <stop offset="100%" style="stop-color:#EA580C;stop-opacity:1" />
                                                </linearGradient>
                                            </defs>
                                            <circle cx="12" cy="12" r="9" fill="url(#timeoutGradient2)" stroke="#EA580C" stroke-width="1"/>
                                            <path d="M8 8l8 8M16 8l-8 8" stroke="#FFF7ED" stroke-width="2.5" stroke-linecap="round"/>
                                        </svg>
                                    </span>
                                </button>
                                <button class="mod-action mod-ban" 
                                        data-action="ban" data-user="${username}" title="Постоянный бан">
                                    <span class="relative z-10">
                                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none">
                                            <defs>
                                                <linearGradient id="banGradient2" x1="0%" y1="0%" x2="100%" y2="100%">
                                                    <stop offset="0%" style="stop-color:#EF4444;stop-opacity:1" />
                                                    <stop offset="100%" style="stop-color:#DC2626;stop-opacity:1" />
                                                </linearGradient>
                                            </defs>
                                            <rect x="4" y="6" width="16" height="12" rx="2" fill="url(#banGradient2)" stroke="#DC2626" stroke-width="1"/>
                                            <path d="M9 10l6 4M15 10l-6 4" stroke="#FEF2F2" stroke-width="2" stroke-linecap="round"/>
                                            <rect x="7" y="4" width="10" height="4" rx="2" fill="none" stroke="url(#banGradient2)" stroke-width="2"/>
                                        </svg>
                                    </span>
                                </button>
                            </div>
                        </div>
                        <p class="text-gray-100">${message}</p>
                    </div>
                </div>
            `;
            
            winnerChatContainer.appendChild(messageElement);
            
            // Add event listeners to moderation buttons in winner chat
            messageElement.querySelectorAll('.mod-action').forEach(btn => {
                btn.addEventListener('click', function(e) {
                    e.stopPropagation();
                    const action = this.getAttribute('data-action');
                    const user = this.getAttribute('data-user');
                    handleModerationAction(action, user, messageElement);
                });
            });
            
            // Keep only last 20 messages
            while (winnerChatContainer.children.length > 20) {
                winnerChatContainer.removeChild(winnerChatContainer.firstChild);
            }
            
            // Auto scroll to bottom
            winnerChatContainer.scrollTop = winnerChatContainer.scrollHeight;
        }
        
        // Start winner monitoring
        function startWinnerMonitoring() {
            // Use timeout from settings
            winnerTimeLeft = channelSettings.responseTimeout || 60;
            winnerHasResponded = false;
            
            // Clear winner chat
            winnerChatContainer.innerHTML = '<div class="text-center text-gray-400 py-8">Ожидание сообщений от победителя...</div>';
            
            // Update status
            updateWinnerStatus(false);
            
            // Clear existing timer
            if (winnerTimer) {
                clearInterval(winnerTimer);
            }
            
            console.log('Запуск мониторинга победителя с таймером:', winnerTimeLeft, 'секунд');
            
            // Start new timer
            winnerTimer = setInterval(() => {
                winnerTimeLeft--;
                updateWinnerTimer();
                
                if (winnerTimeLeft <= 0) {
                    clearInterval(winnerTimer);
                    if (!winnerHasResponded) {
                        showNotification('Время ожидания истекло. Победитель не ответил.', 'error');
                    }
                }
            }, 1000);
        }
        
        // Stop winner monitoring
        function stopWinnerMonitoring() {
            if (winnerTimer) {
                clearInterval(winnerTimer);
                winnerTimer = null;
            }
            currentWinners = [];
            winnerHasResponded = false;
            winnerTimeLeft = channelSettings.responseTimeout || 60;
        }
        
        // Update winner timer display
        function updateWinnerTimer() {
            const minutes = Math.floor(winnerTimeLeft / 60);
            const seconds = winnerTimeLeft % 60;
            winnerTimerDisplay.textContent = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
        }
        
        // Update winner status indicator
        function updateWinnerStatus(hasResponded) {
            if (hasResponded) {
                winnerStatus.className = 'w-3 h-3 rounded-full bg-green-500';
                winnerStatus.style.animation = 'none';
                
                // Stop timer when winner responds
                if (winnerTimer) {
                    clearInterval(winnerTimer);
                    winnerTimer = null;
                    showNotification('Таймер остановлен - победитель ответил!', 'success');
                }
            } else {
                winnerStatus.className = 'w-3 h-3 rounded-full bg-red-500 animate-pulse';
            }
        }

        // Get user avatar URL with real Twitch avatar
        function getUserAvatar(userId, username) {
            if (userId && avatarCache[userId]) {
                // Return cached real avatar
                return avatarCache[userId];
            } else if (userId) {
                // Start async fetch for real avatar and return placeholder
                fetchUserAvatar(userId, username).then(url => {
                    if (url !== avatarCache[userId]) {
                        // Update all existing avatars for this user
                        updateAvatarsInChat(userId, url);
                    }
                });
                // Return placeholder while loading
                return `https://ui-avatars.com/api/?name=${encodeURIComponent(username)}&background=9146FF&color=fff&size=70&rounded=true`;
            } else {
                // Fallback to a default avatar based on username
                return `https://ui-avatars.com/api/?name=${encodeURIComponent(username)}&background=9146FF&color=fff&size=70&rounded=true`;
            }
        }

        // Cache for user avatars
        const avatarCache = {};

        // Fetch real user avatar from Twitch API
        async function fetchUserAvatar(userId, username) {
            if (!userId || !accessToken) {
                const fallbackUrl = `https://ui-avatars.com/api/?name=${encodeURIComponent(username)}&background=9146FF&color=fff&size=70&rounded=true`;
                avatarCache[userId] = fallbackUrl;
                return fallbackUrl;
            }
            
            // Check cache first
            if (avatarCache[userId]) {
                return avatarCache[userId];
            }
            
            try {
                const response = await fetch(`https://api.twitch.tv/helix/users?id=${userId}`, {
                    headers: {
                        'Authorization': `Bearer ${accessToken}`,
                        'Client-Id': TWITCH_CLIENT_ID
                    }
                });
                
                if (response.ok) {
                    const data = await response.json();
                    if (data.data && data.data.length > 0) {
                        const avatarUrl = data.data[0].profile_image_url;
                        console.log(`Получен аватар для ${username}:`, avatarUrl);
                        avatarCache[userId] = avatarUrl;
                        return avatarUrl;
                    }
                }
            } catch (error) {
                console.error('Ошибка получения аватара:', error);
            }
            
            // Fallback
            const fallbackUrl = `https://ui-avatars.com/api/?name=${encodeURIComponent(username)}&background=9146FF&color=fff&size=70&rounded=true`;
            avatarCache[userId] = fallbackUrl;
            return fallbackUrl;
        }

        // Update avatars in chat after loading real ones
        function updateAvatarsInChat(userId, newAvatarUrl) {
            // Update all avatar images with this userId (both in chat and winners list)
            const avatarImages = document.querySelectorAll(`img[data-user-id="${userId}"]`);
            avatarImages.forEach(img => {
                if (newAvatarUrl && !newAvatarUrl.includes('ui-avatars.com')) {
                    img.src = newAvatarUrl;
                    img.style.display = 'block';
                    // Hide fallback text
                    const fallback = img.nextElementSibling;
                    if (fallback && fallback.tagName === 'SPAN') {
                        fallback.style.display = 'none';
                    }
                }
            });
        }

        // Preload avatars for active users
        function preloadUserAvatars() {
            // Get unique user IDs from recent participants
            const userIds = new Set();
            
            Object.values(giveawayParticipants).forEach(participants => {
                participants.forEach(participant => {
                    if (participant.userId) {
                        userIds.add(participant.userId);
                    }
                });
            });
            
            // Also add user IDs from recent winners
            recentWinners.forEach(winner => {
                if (winner.userId) {
                    userIds.add(winner.userId);
                }
            });
            
            // Preload avatars for these users
            userIds.forEach(userId => {
                if (!avatarCache[userId]) {
                    // Find username from winners or participants
                    let username = 'user';
                    const winner = recentWinners.find(w => w.userId === userId);
                    if (winner) {
                        username = winner.username;
                    }
                    
                    fetchUserAvatar(userId, username).then(url => {
                        // Update all avatars when loaded
                        updateAvatarsInChat(userId, url);
                    });
                }
            });
        }

        // Handle moderation actions
        async function handleModerationAction(action, username, messageElement) {
            let actionText = '';
            let actionColor = '';
            let success = false;
            let timeoutDuration = 0;
            
            // Get current timeout duration from settings
            const currentTimeoutMinutes = channelSettings.timeoutDuration || 10;
            const currentTimeoutSeconds = currentTimeoutMinutes * 60;
            
            // Disable buttons immediately to prevent spam
            if (messageElement) {
                messageElement.querySelectorAll('.mod-action').forEach(btn => {
                    btn.style.opacity = '0.5';
                    btn.disabled = true;
                    btn.style.pointerEvents = 'none';
                });
            }
            
            showNotification(`Выполняется модерация ${username}...`, 'info');
            
            switch(action) {
                case 'warn':
                    actionText = 'предупрежден';
                    actionColor = 'text-yellow-400';
                    timeoutDuration = 1;
                    // Send a 1-second timeout as warning
                    success = await sendModerationCommand(`/timeout ${username} 1`, username, 1);
                    if (success) {
                        showNotification(`${username} получил предупреждение`, 'success');
                    } else {
                        showNotification(`Ошибка при предупреждении ${username}`, 'error');
                    }
                    break;
                    
                case 'timeout':
                    actionText = `замучен на ${currentTimeoutMinutes} ${currentTimeoutMinutes === 1 ? 'минуту' : currentTimeoutMinutes < 5 ? 'минуты' : 'минут'}`;
                    actionColor = 'text-orange-400';
                    timeoutDuration = currentTimeoutSeconds;
                    // Send timeout with settings duration
                    success = await sendModerationCommand(`/timeout ${username} ${currentTimeoutSeconds}`, username, currentTimeoutSeconds);
                    if (success) {
                        showNotification(`${username} замучен на ${currentTimeoutMinutes} ${currentTimeoutMinutes === 1 ? 'минуту' : currentTimeoutMinutes < 5 ? 'минуты' : 'минут'}`, 'success');
                    } else {
                        showNotification(`Ошибка при муте ${username}`, 'error');
                    }
                    break;
                    
                case 'ban':
                    actionText = 'забанен';
                    actionColor = 'text-red-400';
                    // Send permanent ban
                    success = await sendModerationCommand(`/ban ${username}`, username);
                    if (success) {
                        showNotification(`${username} забанен`, 'success');
                    } else {
                        showNotification(`Ошибка при бане ${username}`, 'error');
                    }
                    break;
            }
            
            // Add moderation indicator to message only if successful
            if (messageElement && success) {
                const moderationBadge = document.createElement('span');
                
                // Determine badge class and icon based on action
                let badgeClass = 'mod-badge ';
                let badgeIcon = '';
                let badgeText = '';
                
                switch(action) {
                    case 'warn':
                        badgeClass += 'mod-badge-warned';
                        badgeIcon = `<svg width="12" height="12" viewBox="0 0 24 24" fill="none" style="display: inline; margin-right: 4px;">
                            <defs>
                                <linearGradient id="warnBadgeGradient" x1="0%" y1="0%" x2="100%" y2="100%">
                                    <stop offset="0%" style="stop-color:#FCD34D;stop-opacity:1" />
                                    <stop offset="100%" style="stop-color:#F59E0B;stop-opacity:1" />
                                </linearGradient>
                            </defs>
                            <path d="M12 2L2 22h20L12 2z" fill="url(#warnBadgeGradient)" stroke="#F59E0B" stroke-width="1"/>
                            <circle cx="12" cy="17" r="1" fill="#FFFBEB"/>
                            <path d="M12 8v6" stroke="#FFFBEB" stroke-width="2" stroke-linecap="round"/>
                        </svg>`;
                        badgeText = 'ПРЕДУПРЕЖДЕН';
                        break;
                    case 'timeout':
                        badgeClass += 'mod-badge-timeout';
                        badgeIcon = `<svg width="12" height="12" viewBox="0 0 24 24" fill="none" style="display: inline; margin-right: 4px;">
                            <defs>
                                <linearGradient id="timeoutBadgeGradient" x1="0%" y1="0%" x2="100%" y2="100%">
                                    <stop offset="0%" style="stop-color:#FB923C;stop-opacity:1" />
                                    <stop offset="100%" style="stop-color:#EA580C;stop-opacity:1" />
                                </linearGradient>
                            </defs>
                            <!-- Иконка звука -->
                            <path d="M11 5L6 9H2v6h4l5 4V5z" fill="url(#timeoutBadgeGradient)" stroke="#EA580C" stroke-width="1"/>
                            <path d="M19.07 4.93l-1.41 1.41A8.5 8.5 0 0 1 20.5 12a8.5 8.5 0 0 1-2.84 5.66l1.41 1.41A10.5 10.5 0 0 0 22.5 12a10.5 10.5 0 0 0-3.43-7.07z" fill="url(#timeoutBadgeGradient)"/>
                            <path d="M15.54 8.46l-1.41 1.41A2.5 2.5 0 0 1 15 12a2.5 2.5 0 0 1-.87 1.13l1.41 1.41A4.5 4.5 0 0 0 17 12a4.5 4.5 0 0 0-1.46-3.54z" fill="url(#timeoutBadgeGradient)"/>
                            <!-- Перечеркивание -->
                            <path d="M3 3l18 18" stroke="#FFF7ED" stroke-width="2" stroke-linecap="round"/>
                        </svg>`;
                        badgeText = `ЗАМУЧЕН НА ${currentTimeoutMinutes} МИН`;
                        break;
                    case 'ban':
                        badgeClass += 'mod-badge-banned';
                        badgeIcon = `<svg width="12" height="12" viewBox="0 0 24 24" fill="none" style="display: inline; margin-right: 4px;">
                            <defs>
                                <linearGradient id="banBadgeGradient" x1="0%" y1="0%" x2="100%" y2="100%">
                                    <stop offset="0%" style="stop-color:#EF4444;stop-opacity:1" />
                                    <stop offset="100%" style="stop-color:#DC2626;stop-opacity:1" />
                                </linearGradient>
                            </defs>
                            <!-- Красный круг -->
                            <circle cx="12" cy="12" r="10" fill="url(#banBadgeGradient)" stroke="#DC2626" stroke-width="1"/>
                            <!-- Горизонтальная линия в середине -->
                            <path d="M6 12h12" stroke="#FEF2F2" stroke-width="2" stroke-linecap="round"/>
                        </svg>`;
                        badgeText = 'ЗАБАНЕН';
                        break;
                }
                
                moderationBadge.className = badgeClass;
                moderationBadge.innerHTML = `${badgeIcon}${badgeText}`;
                moderationBadge.style.marginLeft = '8px';
                
                // Find the username element and add badge after it
                const usernameElement = messageElement.querySelector('.font-medium');
                if (usernameElement && usernameElement.parentNode) {
                    usernameElement.parentNode.insertBefore(moderationBadge, usernameElement.nextSibling);
                }
            } else if (messageElement && !success) {
                // Re-enable buttons if action failed
                messageElement.querySelectorAll('.mod-action').forEach(btn => {
                    btn.style.opacity = '1';
                    btn.disabled = false;
                    btn.style.pointerEvents = 'auto';
                });
            }
        }
        
        // Send moderation command to Twitch (if connected)
        async function sendModerationCommand(command, username, duration = null) {
            if (!accessToken || !twitchChannel) {
                showNotification('Нет доступа к API Twitch для модерации', 'error');
                return false;
            }

            try {
                let apiUrl = '';
                let requestBody = {};
                let method = 'POST';

                // Determine API endpoint based on command
                if (command.startsWith('/timeout')) {
                    // Use Twitch API for timeout
                    apiUrl = `https://api.twitch.tv/helix/moderation/bans`;
                    requestBody = {
                        data: {
                            user_id: await getUserIdByUsername(username),
                            duration: duration || 600, // 10 minutes default
                            reason: 'Модерация через BambooFury Giveaways'
                        }
                    };
                } else if (command.startsWith('/ban')) {
                    // Use Twitch API for ban
                    apiUrl = `https://api.twitch.tv/helix/moderation/bans`;
                    requestBody = {
                        data: {
                            user_id: await getUserIdByUsername(username),
                            reason: 'Модерация через BambooFury Giveaways'
                        }
                    };
                } else {
                    // For warnings, just send through IRC
                    if (twitchWebSocket && twitchWebSocket.readyState === WebSocket.OPEN) {
                        twitchWebSocket.send(`PRIVMSG #${twitchChannel} :/timeout ${username} 1`);
                        return true;
                    }
                    return false;
                }

                // Get broadcaster ID (your channel ID)
                const broadcasterData = await fetch(`https://api.twitch.tv/helix/users?login=${twitchChannel}`, {
                    headers: {
                        'Authorization': `Bearer ${accessToken}`,
                        'Client-Id': TWITCH_CLIENT_ID
                    }
                });

                if (!broadcasterData.ok) {
                    throw new Error('Не удалось получить ID канала');
                }

                const broadcasterInfo = await broadcasterData.json();
                const broadcasterId = broadcasterInfo.data[0].id;

                // Add broadcaster_id to URL params
                const urlParams = new URLSearchParams({
                    broadcaster_id: broadcasterId,
                    moderator_id: broadcasterId // Same as broadcaster for self-moderation
                });

                // Send moderation request
                const response = await fetch(`${apiUrl}?${urlParams}`, {
                    method: method,
                    headers: {
                        'Authorization': `Bearer ${accessToken}`,
                        'Client-Id': TWITCH_CLIENT_ID,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(requestBody)
                });

                if (response.ok) {
                    console.log(`Команда модерации выполнена: ${command} для ${username}`);
                    return true;
                } else {
                    const errorData = await response.json();
                    console.error('Ошибка API модерации:', errorData);
                    
                    // Fallback to IRC command
                    if (twitchWebSocket && twitchWebSocket.readyState === WebSocket.OPEN) {
                        twitchWebSocket.send(`PRIVMSG #${twitchChannel} :${command}`);
                        console.log(`Отправлена IRC команда: ${command}`);
                        return true;
                    }
                    return false;
                }
            } catch (error) {
                console.error('Ошибка отправки команды модерации:', error);
                
                // Fallback to IRC command
                if (twitchWebSocket && twitchWebSocket.readyState === WebSocket.OPEN) {
                    try {
                        twitchWebSocket.send(`PRIVMSG #${twitchChannel} :${command}`);
                        console.log(`Отправлена IRC команда как fallback: ${command}`);
                        return true;
                    } catch (ircError) {
                        console.error('Ошибка IRC команды:', ircError);
                        return false;
                    }
                }
                return false;
            }
        }

        // Get user ID by username
        async function getUserIdByUsername(username) {
            try {
                const response = await fetch(`https://api.twitch.tv/helix/users?login=${username.toLowerCase()}`, {
                    headers: {
                        'Authorization': `Bearer ${accessToken}`,
                        'Client-Id': TWITCH_CLIENT_ID
                    }
                });

                if (response.ok) {
                    const data = await response.json();
                    if (data.data && data.data.length > 0) {
                        return data.data[0].id;
                    }
                }
            } catch (error) {
                console.error('Ошибка получения ID пользователя:', error);
            }
            return null;
        }

        // Update winner times periodically
        function updateWinnerTimes() {
            // Update time text for all winners
            const winnerTimeElements = document.querySelectorAll('.winner-time-text');
            
            winnerTimeElements.forEach((element, index) => {
                if (recentWinners[index] && recentWinners[index].time instanceof Date) {
                    element.textContent = formatTimeAgo(recentWinners[index].time);
                }
            });
        }

        // Clear only winners function
        function clearWinnersHistory() {
            if (!twitchChannel) return;
            
            // Show confirmation modal
            showConfirmationModal(
                'Очистить историю победителей?',
                'Это действие удалит всех последних победителей из списка. Данные нельзя будет восстановить.',
                () => {
                    // Clear winners data
                    recentWinners = [];
                    localStorage.removeItem(`bamboofury_winners_${twitchChannel}`);
                    
                    renderRecentWinners();
                    showNotification('История победителей очищена', 'success');
                }
            );
        }
        
        // Check if user is BambooFury
        function checkIfBambooFury(username) {
            return username.toLowerCase() === 'bamboofury';
        }
        
        // Load global settings (for all users) - независимо от аккаунта
        function loadGlobalSettings() {
            try {
                // Используем ключ без привязки к конкретному аккаунту
                const saved = localStorage.getItem('bamboofury_global_user_settings');
                if (saved) {
                    const savedSettings = JSON.parse(saved);
                    globalSettings = {
                        hideUsernames: false,
                        hideAvatars: false,
                        language: 'ru',
                        hideMyUsername: false,
                        disableStatistics: false,
                        registrationDate: '2025-07-06',
                        ...savedSettings
                    };
                    console.log('Глобальные настройки загружены (независимо от аккаунта):', globalSettings);
                } else {
                    console.log('Глобальные настройки не найдены, используются по умолчанию');
                    saveGlobalSettings();
                }
                
                // Apply settings to UI and functionality
                applyGlobalSettingsToUI();
                applyGlobalSettingsToChat();
                
                // Apply language to interface
                setTimeout(() => {
                    applyLanguageToInterface();
                }, 100);
                
            } catch (error) {
                console.error('Ошибка загрузки глобальных настроек:', error);
                globalSettings = {
                    hideUsernames: false,
                    hideAvatars: false,
                    language: 'ru',
                    hideMyUsername: false,
                    disableStatistics: false,
                    registrationDate: '2025-07-06'
                };
            }
        }
        
        // Save global settings - сохраняются независимо от аккаунта
        function saveGlobalSettings() {
            try {
                // Используем ключ без привязки к конкретному аккаунту
                localStorage.setItem('bamboofury_global_user_settings', JSON.stringify(globalSettings));
                console.log('Глобальные настройки сохранены (независимо от аккаунта):', globalSettings);
                showNotification(t('settingsSaved'), 'success');
                
                // Apply settings immediately
                applyGlobalSettingsToUI();
                applyGlobalSettingsToChat();
                applyLanguageToInterface();
                
            } catch (error) {
                console.error('Ошибка сохранения глобальных настроек:', error);
                showNotification('Ошибка сохранения настроек', 'error');
            }
        }
        
        // Apply global settings to UI
        function applyGlobalSettingsToUI() {
            try {
                const elements = {
                    hideUsernames: document.getElementById('hideUsernames'),
                    hideAvatars: document.getElementById('hideAvatars'),
                    hideMyUsername: document.getElementById('hideMyUsername'),
                    disableStatistics: document.getElementById('disableStatistics'),
                    registrationDate: document.getElementById('registrationDate')
                };
                
                // Apply checkbox settings
                Object.keys(elements).forEach(key => {
                    const element = elements[key];
                    if (element && element.type === 'checkbox') {
                        element.checked = Boolean(globalSettings[key]);
                    } else if (element && key === 'registrationDate') {
                        element.textContent = globalSettings[key] || '2025-07-06';
                    }
                });
                
                // Apply language setting
                updateLanguageButtons(globalSettings.language);
                
                console.log('Глобальные настройки применены к UI');
                
            } catch (error) {
                console.error('Ошибка применения глобальных настроек к UI:', error);
            }
        }
        
        // Update language buttons
        function updateLanguageButtons(activeLanguage) {
            try {
                console.log('Обновление кнопок языка, активный:', activeLanguage);
                
                const languageButtons = document.querySelectorAll('.language-btn');
                languageButtons.forEach(btn => {
                    btn.className = 'language-btn px-4 py-2 rounded-lg border border-gray-600 text-gray-300 hover:text-white hover:border-purple-500 transition-all duration-200';
                });
                
                const activeLangBtn = document.getElementById(`lang${activeLanguage.toUpperCase()}`);
                if (activeLangBtn) {
                    activeLangBtn.className = 'language-btn px-4 py-2 rounded-lg border border-purple-500 bg-purple-600 text-white';
                    console.log('Активирована кнопка языка:', activeLanguage);
                } else {
                    console.warn('Кнопка для языка не найдена:', activeLanguage);
                }
            } catch (error) {
                console.error('Ошибка обновления кнопок языка:', error);
            }
        }
        
        // Apply global settings to chat display
        function applyGlobalSettingsToChat() {
            // Update existing chat messages with new settings
            const chatMessages = document.querySelectorAll('.chat-message, .winner-chat-message');
            
            chatMessages.forEach(message => {
                // Handle username hiding
                const usernameElement = message.querySelector('.font-medium');
                if (usernameElement && globalSettings.hideUsernames) {
                    const originalText = usernameElement.getAttribute('data-original-username') || usernameElement.textContent;
                    usernameElement.setAttribute('data-original-username', originalText);
                    usernameElement.textContent = '*******';
                } else if (usernameElement && !globalSettings.hideUsernames) {
                    const originalText = usernameElement.getAttribute('data-original-username');
                    if (originalText) {
                        usernameElement.textContent = originalText;
                    }
                }
                
                // Handle avatar hiding
                const avatarImg = message.querySelector('img[data-user-id]');
                const avatarSpan = message.querySelector('.text-xs.text-white');
                if (avatarImg && avatarSpan) {
                    if (globalSettings.hideAvatars) {
                        avatarImg.style.display = 'none';
                        avatarSpan.style.display = 'flex';
                    } else {
                        avatarImg.style.display = 'block';
                        avatarSpan.style.display = avatarImg.complete && !avatarImg.src.includes('ui-avatars.com') ? 'none' : 'flex';
                    }
                }
            });
        }
        
        // Collect global settings from UI
        function collectGlobalSettingsFromUI() {
            try {
                const elements = {
                    hideUsernames: document.getElementById('hideUsernames'),
                    hideAvatars: document.getElementById('hideAvatars'),
                    hideMyUsername: document.getElementById('hideMyUsername'),
                    disableStatistics: document.getElementById('disableStatistics')
                };
                
                Object.keys(elements).forEach(key => {
                    const element = elements[key];
                    if (element && element.type === 'checkbox') {
                        globalSettings[key] = element.checked;
                    }
                });
                
                console.log('Глобальные настройки собраны из UI:', globalSettings);
                
            } catch (error) {
                console.error('Ошибка сбора глобальных настроек из UI:', error);
            }
        }
        
        // Clear giveaway history
        function clearGiveawayHistory() {
            showConfirmationModal(
                'Очистить историю розыгрышей?',
                'Это действие удалит всю вашу историю участия в розыгрышах. Данные нельзя будет восстановить.',
                () => {
                    // Clear only user's participation data, not the entire giveaway system
                    Object.keys(giveawayParticipants).forEach(giveawayId => {
                        const participants = giveawayParticipants[giveawayId];
                        if (Array.isArray(participants)) {
                            giveawayParticipants[giveawayId] = participants.filter(p => {
                                const participantName = typeof p === 'string' ? p : p.username;
                                return participantName.toLowerCase() !== currentUsername.toLowerCase();
                            });
                        }
                    });
                    
                    // Remove user from winners list
                    recentWinners = recentWinners.filter(winner => 
                        winner.username.toLowerCase() !== currentUsername.toLowerCase()
                    );
                    
                    // Update displays
                    renderActiveGiveaways();
                    renderRecentWinners();
                    saveData();
                    
                    showNotification('Ваша история розыгрышей очищена', 'success');
                }
            );
        }
        
        // Delete account
        function deleteAccount() {
            showConfirmationModal(
                'Удалить аккаунт с сайта?',
                'Это действие выйдет из аккаунта и очистит ваши данные розыгрышей. Глобальные настройки интерфейса сохранятся.',
                () => {
                    // Clear auth data
                    localStorage.removeItem('twitch_access_token');
                    
                    // Clear user-specific data from giveaways and winners but keep global settings
                    clearGiveawayHistory();
                    
                    // Clear channel-specific data
                    if (twitchChannel) {
                        localStorage.removeItem(`bamboofury_winners_${twitchChannel}`);
                        localStorage.removeItem(`bamboofury_giveaways_${twitchChannel}`);
                        localStorage.removeItem(`bamboofury_participants_${twitchChannel}`);
                    }
                    
                    // DON'T remove global settings - they should persist
                    // localStorage.removeItem('bamboofury_global_user_settings'); // Не удаляем!
                    
                    // Disconnect and reload
                    if (twitchWebSocket) {
                        twitchWebSocket.close();
                    }
                    
                    showNotification('Аккаунт отключен, настройки интерфейса сохранены', 'success');
                    
                    setTimeout(() => {
                        window.location.reload();
                    }, 2000);
                }
            );
        }
        
        // Report bug or suggest idea
        function reportBugOrIdea() {
            const userAgent = navigator.userAgent;
            const url = window.location.href;
            const timestamp = new Date().toISOString();
            
            const emailBody = `
Привет! Я хочу сообщить об ошибке или предложить идею для BambooFury Giveaways:

ОПИСАНИЕ:
[Опишите ошибку или вашу идею здесь]

ТЕХНИЧЕСКАЯ ИНФОРМАЦИЯ:
- Дата: ${timestamp}
- Браузер: ${userAgent}
- URL: ${url}
- Пользователь: ${currentUsername || 'Не авторизован'}

ШАГИ ДЛЯ ВОСПРОИЗВЕДЕНИЯ (для ошибок):
1. [Опишите шаги]
2. [что вы делали]
3. [когда произошла ошибка]

ОЖИДАЕМОЕ ПОВЕДЕНИЕ:
[Что должно было произойти]

ФАКТИЧЕСКОЕ ПОВЕДЕНИЕ:
[Что произошло на самом деле]

Спасибо за улучшение сервиса!
            `.trim();
            
            const mailtoLink = `mailto:support@bamboofury.com?subject=Bug Report / Feature Request - BambooFury Giveaways&body=${encodeURIComponent(emailBody)}`;
            
            try {
                window.open(mailtoLink, '_blank');
                showNotification('Клиент электронной почты открыт', 'success');
            } catch (error) {
                // Fallback - copy to clipboard
                navigator.clipboard.writeText(emailBody).then(() => {
                    showNotification('Шаблон отчета скопирован в буфер обмена', 'success');
                }).catch(() => {
                    showNotification('Отправьте отчет на: support@bamboofury.com', 'info');
                });
            }
        }
        
        // Load channel settings
        function loadChannelSettings() {
            if (!isBambooFury || !twitchChannel) return;
            
            try {
                const settingsKey = `bamboofury_channel_settings_${twitchChannel}`;
                const saved = localStorage.getItem(settingsKey);
                
                if (saved) {
                    const savedSettings = JSON.parse(saved);
                    // Merge with defaults to ensure all properties exist
                    channelSettings = {
                        autoAnnounce: true,
                        soundNotifications: false,
                        responseTimeout: 60,
                        autoModeration: false,
                        timeoutDuration: 10,
                        bannedWords: [],
                        maxParticipants: 1000,
                        minFollowDays: 0,
                        followersOnly: false,
                        ...savedSettings
                    };
                    console.log('Настройки канала загружены:', channelSettings);
                } else {
                    console.log('Настройки канала не найдены, используются по умолчанию');
                    // Save default settings
                    saveChannelSettings();
                }
                
                // Force apply settings to UI after a short delay
                setTimeout(() => {
                    applyChannelSettingsToUI();
                    updateTimeoutDuration();
                    updateResponseTimeout();
                }, 200);
                
            } catch (error) {
                console.error('Ошибка загрузки настроек канала:', error);
                // Reset to defaults on error
                channelSettings = {
                    autoAnnounce: true,
                    soundNotifications: false,
                    responseTimeout: 60,
                    autoModeration: false,
                    timeoutDuration: 10,
                    bannedWords: [],
                    maxParticipants: 1000,
                    minFollowDays: 0,
                    followersOnly: false
                };
            }
        }
        
        // Save channel settings
        function saveChannelSettings() {
            if (!isBambooFury || !twitchChannel) return;
            
            try {
                const settingsKey = `bamboofury_channel_settings_${twitchChannel}`;
                const settingsToSave = JSON.stringify(channelSettings);
                
                localStorage.setItem(settingsKey, settingsToSave);
                console.log('Настройки канала сохранены для канала:', twitchChannel);
                console.log('Сохраненные настройки:', channelSettings);
                
                // Verify the save was successful
                const verification = localStorage.getItem(settingsKey);
                if (verification === settingsToSave) {
                    showNotification('Настройки канала сохранены и проверены!', 'success');
                } else {
                    throw new Error('Верификация сохранения не прошла');
                }
                
                // Immediately update all dependent variables
                updateTimeoutDuration();
                updateResponseTimeout();
                
            } catch (error) {
                console.error('Ошибка сохранения настроек канала:', error);
                showNotification('Ошибка сохранения настроек: ' + error.message, 'error');
            }
        }
        
        // Apply channel settings to UI
        function applyChannelSettingsToUI() {
            if (!isBambooFury) return;
            
            try {
                console.log('Применение настроек к UI:', channelSettings);
                
                const elements = {
                    autoAnnounce: document.getElementById('autoAnnounce'),
                    soundNotifications: document.getElementById('soundNotifications'),
                    responseTimeout: document.getElementById('responseTimeout'),
                    autoModeration: document.getElementById('autoModeration'),
                    timeoutDuration: document.getElementById('timeoutDuration'),
                    bannedWords: document.getElementById('bannedWords'),
                    maxParticipants: document.getElementById('maxParticipants'),
                    minFollowDays: document.getElementById('minFollowDays'),
                    followersOnly: document.getElementById('followersOnly')
                };
                
                // Apply settings with detailed logging
                Object.keys(elements).forEach(key => {
                    const element = elements[key];
                    if (element) {
                        const setting = channelSettings[key];
                        if (element.type === 'checkbox') {
                            element.checked = Boolean(setting);
                            console.log(`Установлен ${key}:`, element.checked);
                        } else if (element.type === 'number' || element.tagName === 'SELECT') {
                            element.value = setting;
                            console.log(`Установлен ${key}:`, element.value);
                        } else if (element.tagName === 'TEXTAREA') {
                            element.value = Array.isArray(setting) ? setting.join(', ') : setting;
                            console.log(`Установлен ${key}:`, element.value);
                        }
                    } else {
                        console.warn(`Элемент ${key} не найден в DOM`);
                    }
                });
                
                console.log('UI успешно обновлен настройками канала');
                
                // Update global timeout variables
                updateTimeoutDuration();
                updateResponseTimeout();
                
                // Show current settings in console for debugging
                console.log('Текущие настройки после применения:', {
                    timeoutDuration: channelSettings.timeoutDuration,
                    responseTimeout: channelSettings.responseTimeout,
                    autoAnnounce: channelSettings.autoAnnounce,
                    autoModeration: channelSettings.autoModeration
                });
                
            } catch (error) {
                console.error('Ошибка применения настроек к UI:', error);
            }
        }
        
        // Collect channel settings from UI
        function collectChannelSettingsFromUI() {
            if (!isBambooFury) return;
            
            try {
                console.log('Сбор настроек из UI...');
                
                const elements = {
                    autoAnnounce: document.getElementById('autoAnnounce'),
                    soundNotifications: document.getElementById('soundNotifications'),
                    responseTimeout: document.getElementById('responseTimeout'),
                    autoModeration: document.getElementById('autoModeration'),
                    timeoutDuration: document.getElementById('timeoutDuration'),
                    bannedWords: document.getElementById('bannedWords'),
                    maxParticipants: document.getElementById('maxParticipants'),
                    minFollowDays: document.getElementById('minFollowDays'),
                    followersOnly: document.getElementById('followersOnly')
                };
                
                // Collect settings with validation
                if (elements.autoAnnounce) {
                    channelSettings.autoAnnounce = elements.autoAnnounce.checked;
                    console.log('autoAnnounce собран:', channelSettings.autoAnnounce);
                }
                
                if (elements.soundNotifications) {
                    channelSettings.soundNotifications = elements.soundNotifications.checked;
                    console.log('soundNotifications собран:', channelSettings.soundNotifications);
                }
                
                if (elements.responseTimeout) {
                    const timeout = parseInt(elements.responseTimeout.value);
                    channelSettings.responseTimeout = isNaN(timeout) ? 60 : Math.max(30, Math.min(300, timeout));
                    console.log('responseTimeout собран:', channelSettings.responseTimeout);
                }
                
                if (elements.autoModeration) {
                    channelSettings.autoModeration = elements.autoModeration.checked;
                    console.log('autoModeration собран:', channelSettings.autoModeration);
                }
                
                if (elements.timeoutDuration) {
                    const duration = parseInt(elements.timeoutDuration.value);
                    channelSettings.timeoutDuration = isNaN(duration) ? 10 : Math.max(1, Math.min(1440, duration));
                    console.log('timeoutDuration собран:', channelSettings.timeoutDuration);
                }
                
                if (elements.bannedWords) {
                    const bannedWordsText = elements.bannedWords.value.trim();
                    channelSettings.bannedWords = bannedWordsText ? 
                        bannedWordsText.split(',').map(word => word.trim()).filter(word => word.length > 0) : [];
                    console.log('bannedWords собран:', channelSettings.bannedWords);
                }
                
                if (elements.maxParticipants) {
                    const maxP = parseInt(elements.maxParticipants.value);
                    channelSettings.maxParticipants = isNaN(maxP) ? 1000 : Math.max(1, maxP);
                    console.log('maxParticipants собран:', channelSettings.maxParticipants);
                }
                
                if (elements.minFollowDays) {
                    const minDays = parseInt(elements.minFollowDays.value);
                    channelSettings.minFollowDays = isNaN(minDays) ? 0 : Math.max(0, minDays);
                    console.log('minFollowDays собран:', channelSettings.minFollowDays);
                }
                
                if (elements.followersOnly) {
                    channelSettings.followersOnly = elements.followersOnly.checked;
                    console.log('followersOnly собран:', channelSettings.followersOnly);
                }
                
                console.log('Все настройки собраны:', channelSettings);
                
            } catch (error) {
                console.error('Ошибка сбора настроек из UI:', error);
            }
        }
        
        // Update statistics in settings
        function updateChannelStatistics() {
            if (!isBambooFury) return;
            
            try {
                // Calculate total giveaways from localStorage
                let totalGiveaways = 0;
                let totalParticipants = 0;
                
                // Get all stored giveaway data
                for (let i = 0; i < localStorage.length; i++) {
                    const key = localStorage.key(i);
                    if (key && key.startsWith('bamboofury_giveaways_')) {
                        try {
                            const giveaways = JSON.parse(localStorage.getItem(key) || '[]');
                            totalGiveaways += giveaways.length;
                        } catch (e) {
                            // Ignore parse errors
                        }
                    }
                    if (key && key.startsWith('bamboofury_participants_')) {
                        try {
                            const participants = JSON.parse(localStorage.getItem(key) || '{}');
                            Object.values(participants).forEach(pList => {
                                if (Array.isArray(pList)) {
                                    totalParticipants += pList.length;
                                }
                            });
                        } catch (e) {
                            // Ignore parse errors
                        }
                    }
                }
                
                const totalWinners = recentWinners.length;
                
                // Update UI
                document.getElementById('totalGiveaways').textContent = totalGiveaways;
                document.getElementById('totalWinners').textContent = totalWinners;
                document.getElementById('totalParticipants').textContent = totalParticipants;
            } catch (error) {
                console.error('Ошибка обновления статистики:', error);
            }
        }
        
        // Export data function
        function exportChannelData() {
            if (!isBambooFury) return;
            
            try {
                const exportData = {
                    exported: new Date().toISOString(),
                    channel: twitchChannel,
                    settings: channelSettings,
                    giveaways: activeGiveaways,
                    winners: recentWinners,
                    participants: giveawayParticipants
                };
                
                const dataStr = JSON.stringify(exportData, null, 2);
                const dataBlob = new Blob([dataStr], { type: 'application/json' });
                
                const link = document.createElement('a');
                link.href = URL.createObjectURL(dataBlob);
                link.download = `bamboofury_data_${new Date().toISOString().split('T')[0]}.json`;
                link.click();
                
                showNotification('Данные экспортированы', 'success');
            } catch (error) {
                console.error('Ошибка экспорта данных:', error);
                showNotification('Ошибка экспорта данных', 'error');
            }
        }
        
        // Clear all data function (enhanced for BambooFury)
        function clearAllChannelData() {
            if (!isBambooFury) return;
            
            showConfirmationModal(
                'Очистить ВСЕ данные канала?',
                'Это действие удалит все розыгрыши, победителей, участников и настройки. Данные нельзя будет восстановить!',
                () => {
                    // Clear all localStorage data related to BambooFury
                    const keysToRemove = [];
                    for (let i = 0; i < localStorage.length; i++) {
                        const key = localStorage.key(i);
                        if (key && key.startsWith('bamboofury_')) {
                            keysToRemove.push(key);
                        }
                    }
                    
                    keysToRemove.forEach(key => localStorage.removeItem(key));
                    
                    // Reset all data
                    recentWinners = [];
                    activeGiveaways = [];
                    giveawayParticipants = {};
                    channelSettings = {
                        autoAnnounce: true,
                        soundNotifications: false,
                        responseTimeout: 60,
                        autoModeration: false,
                        timeoutDuration: 10,
                        bannedWords: [],
                        maxParticipants: 1000,
                        minFollowDays: 0,
                        followersOnly: false
                    };
                    
                    // Update UI
                    renderActiveGiveaways();
                    renderRecentWinners();
                    applyChannelSettingsToUI();
                    updateChannelStatistics();
                    
                    showNotification('Все данные канала очищены', 'success');
                }
            );
        }
        
        // Initialize user management data
        function initializeUserManagementData() {
            if (!isBambooFury) return;
            
            // Load from localStorage - no demo data, only real users
            const savedUsers = localStorage.getItem('bamboofury_users');
            const savedStreamers = localStorage.getItem('bamboofury_streamers');
            const savedAuthLog = localStorage.getItem('bamboofury_auth_log');
            const savedNotifications = localStorage.getItem('bamboofury_notifications');
            
            if (savedUsers) {
                registeredUsers = JSON.parse(savedUsers);
                // Ensure all users have IP addresses
                registeredUsers.forEach(user => {
                    if (!user.ipAddress || user.ipAddress === 'unknown') {
                        user.ipAddress = user.userType === 'owner' ? 'localhost' : getUserIP();
                    }
                });
            } else {
                // Start with empty arrays - data will be populated from real users
                registeredUsers = [];
            }
            
            if (savedStreamers) {
                registeredStreamers = JSON.parse(savedStreamers);
                // Ensure all streamers have IP addresses
                registeredStreamers.forEach(streamer => {
                    if (!streamer.ipAddress || streamer.ipAddress === 'unknown') {
                        streamer.ipAddress = getUserIP();
                    }
                });
            } else {
                // Start with empty arrays - data will be populated from real streamers
                registeredStreamers = [];
            }
            
            if (savedAuthLog) {
                authorizationLog = JSON.parse(savedAuthLog).map(entry => ({
                    ...entry,
                    timestamp: new Date(entry.timestamp)
                }));
            } else {
                // Start with empty log - will be populated with real actions
                authorizationLog = [];
            }
            
            if (savedNotifications) {
                notificationSettings = { ...notificationSettings, ...JSON.parse(savedNotifications) };
            }
            
            // Load user management settings
            loadUserManagementSettings();
            
            // Add current user to the system if BambooFury
            addUserToSystem(currentUsername, {
                id: 'bamboofury_owner',
                login: currentUsername.toLowerCase(),
                displayName: currentUsername,
                avatarUrl: streamerAvatar?.querySelector('img')?.src || `https://ui-avatars.com/api/?name=${encodeURIComponent(currentUsername)}&background=9146FF&color=fff&size=50`,
                joinDate: new Date(),
                lastSeen: new Date(),
                ipAddress: getRealUserIP(), // Use real IP function for current user
                userType: 'owner',
                status: 'verified',
                followerCount: 0,
                giveawayCount: 0
            });
            
            // Save updated data with IP addresses
            saveUserManagementData();
        }
        
        // Save user management data
        function saveUserManagementData() {
            if (!isBambooFury) return;
            
            localStorage.setItem('bamboofury_users', JSON.stringify(registeredUsers));
            localStorage.setItem('bamboofury_streamers', JSON.stringify(registeredStreamers));
            localStorage.setItem('bamboofury_auth_log', JSON.stringify(authorizationLog));
            localStorage.setItem('bamboofury_notifications', JSON.stringify(notificationSettings));
            localStorage.setItem('bamboofury_user_management_settings', JSON.stringify(userManagementSettings));
        }
        
        // Load user management settings
        function loadUserManagementSettings() {
            if (!isBambooFury) return;
            
            try {
                const savedSettings = localStorage.getItem('bamboofury_user_management_settings');
                if (savedSettings) {
                    userManagementSettings = { ...userManagementSettings, ...JSON.parse(savedSettings) };
                    console.log('Настройки управления пользователями загружены:', userManagementSettings);
                }
            } catch (error) {
                console.error('Ошибка загрузки настроек управления пользователями:', error);
            }
        }
        
        // Apply user management settings to UI
        function applyUserManagementSettingsToUI() {
            if (!isBambooFury) return;
            
            try {
                // Apply search and filter values
                const userSearch = document.getElementById('userSearch');
                const userSortBy = document.getElementById('userSortBy');
                const userFilterStatus = document.getElementById('userFilterStatus');
                const streamerSearch = document.getElementById('streamerSearch');
                const streamerSortBy = document.getElementById('streamerSortBy');
                const streamerFilterActivity = document.getElementById('streamerFilterActivity');
                const logStartDate = document.getElementById('logStartDate');
                const logEndDate = document.getElementById('logEndDate');
                
                if (userSearch) userSearch.value = userManagementSettings.userSearch || '';
                if (userSortBy) userSortBy.value = userManagementSettings.userSortBy || 'date';
                if (userFilterStatus) userFilterStatus.value = userManagementSettings.userFilterStatus || 'all';
                if (streamerSearch) streamerSearch.value = userManagementSettings.streamerSearch || '';
                if (streamerSortBy) streamerSortBy.value = userManagementSettings.streamerSortBy || 'activity';
                if (streamerFilterActivity) streamerFilterActivity.value = userManagementSettings.streamerFilterActivity || 'all';
                if (logStartDate) logStartDate.value = userManagementSettings.logStartDate || '';
                if (logEndDate) logEndDate.value = userManagementSettings.logEndDate || '';
                
                // Apply notification settings
                const newStreamerNotifications = document.getElementById('newStreamerNotifications');
                const emailReports = document.getElementById('emailReports');
                const discordNotifications = document.getElementById('discordNotifications');
                const reportEmail = document.getElementById('reportEmail');
                const discordWebhook = document.getElementById('discordWebhook');
                
                if (newStreamerNotifications) newStreamerNotifications.checked = notificationSettings.newStreamerNotifications;
                if (emailReports) emailReports.checked = notificationSettings.emailReports;
                if (discordNotifications) discordNotifications.checked = notificationSettings.discordNotifications;
                if (reportEmail) reportEmail.value = notificationSettings.reportEmail || '';
                if (discordWebhook) discordWebhook.value = notificationSettings.discordWebhook || '';
                
                // Switch to saved active tab
                if (userManagementSettings.activeTab === 'streamers') {
                    document.getElementById('streamersTab')?.click();
                } else if (userManagementSettings.activeTab === 'notifications') {
                    document.getElementById('notificationsTab')?.click();
                } else {
                    document.getElementById('usersTab')?.click();
                }
                
                console.log('Настройки управления пользователями применены к UI');
            } catch (error) {
                console.error('Ошибка применения настроек управления пользователями к UI:', error);
            }
        }
        
        // Collect user management settings from UI
        function collectUserManagementSettingsFromUI() {
            if (!isBambooFury) return;
            
            try {
                const userSearch = document.getElementById('userSearch');
                const userSortBy = document.getElementById('userSortBy');
                const userFilterStatus = document.getElementById('userFilterStatus');
                const streamerSearch = document.getElementById('streamerSearch');
                const streamerSortBy = document.getElementById('streamerSortBy');
                const streamerFilterActivity = document.getElementById('streamerFilterActivity');
                const logStartDate = document.getElementById('logStartDate');
                const logEndDate = document.getElementById('logEndDate');
                
                userManagementSettings.userSearch = userSearch?.value || '';
                userManagementSettings.userSortBy = userSortBy?.value || 'date';
                userManagementSettings.userFilterStatus = userFilterStatus?.value || 'all';
                userManagementSettings.streamerSearch = streamerSearch?.value || '';
                userManagementSettings.streamerSortBy = streamerSortBy?.value || 'activity';
                userManagementSettings.streamerFilterActivity = streamerFilterActivity?.value || 'all';
                userManagementSettings.logStartDate = logStartDate?.value || '';
                userManagementSettings.logEndDate = logEndDate?.value || '';
                
                // Collect notification settings
                const newStreamerNotifications = document.getElementById('newStreamerNotifications');
                const emailReports = document.getElementById('emailReports');
                const discordNotifications = document.getElementById('discordNotifications');
                const reportEmail = document.getElementById('reportEmail');
                const discordWebhook = document.getElementById('discordWebhook');
                
                if (newStreamerNotifications) notificationSettings.newStreamerNotifications = newStreamerNotifications.checked;
                if (emailReports) notificationSettings.emailReports = emailReports.checked;
                if (discordNotifications) notificationSettings.discordNotifications = discordNotifications.checked;
                if (reportEmail) notificationSettings.reportEmail = reportEmail.value;
                if (discordWebhook) notificationSettings.discordWebhook = discordWebhook.value;
                
                console.log('Настройки управления пользователями собраны:', userManagementSettings);
            } catch (error) {
                console.error('Ошибка сбора настроек управления пользователями:', error);
            }
        }
        
        // Render users table
        function renderUsersTable() {
            if (!isBambooFury) return;
            
            const tableBody = document.getElementById('usersTableBody');
            const emptyState = document.getElementById('usersEmptyState');
            const searchTerm = document.getElementById('userSearch').value.toLowerCase();
            const sortBy = document.getElementById('userSortBy').value;
            const statusFilter = document.getElementById('userFilterStatus').value;
            
            // Filter users
            let filteredUsers = registeredUsers.filter(user => {
                const matchesSearch = user.login.toLowerCase().includes(searchTerm) || 
                                    user.id.includes(searchTerm) ||
                                    user.displayName.toLowerCase().includes(searchTerm);
                                    
                const matchesStatus = statusFilter === 'all' || user.status === statusFilter;
                
                return matchesSearch && matchesStatus;
            });
            
            // Sort users
            filteredUsers.sort((a, b) => {
                switch(sortBy) {
                    case 'login':
                        return a.login.localeCompare(b.login);
                    case 'type':
                        return a.userType.localeCompare(b.userType);
                    case 'status':
                        return a.status.localeCompare(b.status);
                    case 'date':
                    default:
                        return new Date(b.joinDate) - new Date(a.joinDate);
                }
            });
            
            if (filteredUsers.length === 0) {
                tableBody.innerHTML = '';
                emptyState.classList.remove('hidden');
                return;
            }
            
            emptyState.classList.add('hidden');
            
            tableBody.innerHTML = filteredUsers.map(user => {
                const statusBadges = {
                    verified: '<span class="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-green-100 text-green-800">✅ Подтверждён</span>',
                    blocked: '<span class="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-red-100 text-red-800">⛔ Заблокирован</span>',
                    unverified: '<span class="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-yellow-100 text-yellow-800">❓ Неподтверждён</span>'
                };
                
                const typeBadges = {
                    streamer: '<span class="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-purple-100 text-purple-800">🎥 Стример</span>',
                    viewer: '<span class="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-blue-100 text-blue-800">👤 Зритель</span>',
                    bot: '<span class="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-gray-100 text-gray-800">🤖 Бот</span>'
                };
                
                return `
                    <tr class="hover:bg-gray-600 transition-colors duration-200">
                        <td class="px-4 py-3">
                            <img src="${user.avatarUrl}" alt="${user.displayName}" class="w-10 h-10 rounded-full">
                        </td>
                        <td class="px-4 py-3">
                            <div class="flex flex-col">
                                <span class="font-medium">${user.displayName}</span>
                                <span class="text-sm text-gray-400">@${user.login}</span>
                            </div>
                        </td>
                        <td class="px-4 py-3 font-mono text-sm">${user.id}</td>
                        <td class="px-4 py-3 text-sm">${formatDate(user.joinDate)}</td>
                        <td class="px-4 py-3 font-mono text-sm">${user.ipAddress}</td>
                        <td class="px-4 py-3">${typeBadges[user.userType]}</td>
                        <td class="px-4 py-3">${statusBadges[user.status]}</td>
                        <td class="px-4 py-3">
                            <div class="flex justify-center space-x-2">
                                <button class="user-action-btn text-blue-400 hover:text-blue-300 p-1" data-action="view" data-user-id="${user.id}" title="Просмотр профиля">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                        <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
                                        <circle cx="12" cy="12" r="3"></circle>
                                    </svg>
                                </button>
                                ${user.status === 'blocked' ? 
                                    `<button class="user-action-btn text-green-400 hover:text-green-300 p-1" data-action="unblock" data-user-id="${user.id}" title="Разблокировать">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                            <rect x="3" y="11" width="18" height="10" rx="2" ry="2"></rect>
                                            <path d="M7 11V7a5 5 0 0 1 9.9-1"></path>
                                        </svg>
                                    </button>` :
                                    `<button class="user-action-btn text-red-400 hover:text-red-300 p-1" data-action="block" data-user-id="${user.id}" title="Заблокировать">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                            <rect x="3" y="11" width="18" height="10" rx="2" ry="2"></rect>
                                            <circle cx="12" cy="16" r="1"></circle>
                                            <path d="M7 11V7a5 5 0 0 1 10 0v4"></path>
                                        </svg>
                                    </button>`
                                }
                                <button class="user-action-btn text-red-400 hover:text-red-300 p-1" data-action="delete" data-user-id="${user.id}" title="Удалить">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                        <polyline points="3,6 5,6 21,6"></polyline>
                                        <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
                                    </svg>
                                </button>
                            </div>
                        </td>
                    </tr>
                `;
            }).join('');
            
            // Add event listeners to action buttons
            document.querySelectorAll('.user-action-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const action = this.dataset.action;
                    const userId = this.dataset.userId;
                    handleUserAction(action, userId);
                });
            });
        }
        
        // Render streamers table
        function renderStreamersTable() {
            if (!isBambooFury) return;
            
            const tableBody = document.getElementById('streamersTableBody');
            const emptyState = document.getElementById('streamersEmptyState');
            const searchTerm = document.getElementById('streamerSearch').value.toLowerCase();
            const sortBy = document.getElementById('streamerSortBy').value;
            const activityFilter = document.getElementById('streamerFilterActivity').value;
            
            // Filter streamers
            let filteredStreamers = registeredStreamers.filter(streamer => {
                const matchesSearch = streamer.login.toLowerCase().includes(searchTerm) || 
                                    streamer.displayName.toLowerCase().includes(searchTerm);
                                    
                const matchesActivity = activityFilter === 'all' || streamer.activityLevel === activityFilter;
                
                return matchesSearch && matchesActivity;
            });
            
            // Sort streamers
            filteredStreamers.sort((a, b) => {
                switch(sortBy) {
                    case 'login':
                        return a.login.localeCompare(b.login);
                    case 'giveaways':
                        return b.giveawayCount - a.giveawayCount;
                    case 'lastStream':
                        return new Date(b.lastStreamDate) - new Date(a.lastStreamDate);
                    case 'activity':
                    default:
                        const activityOrder = { 'very_high': 4, 'high': 3, 'medium': 2, 'low': 1 };
                        return (activityOrder[b.activityLevel] || 0) - (activityOrder[a.activityLevel] || 0);
                }
            });
            
            if (filteredStreamers.length === 0) {
                tableBody.innerHTML = '';
                emptyState.classList.remove('hidden');
                return;
            }
            
            emptyState.classList.add('hidden');
            
            tableBody.innerHTML = filteredStreamers.map(streamer => {
                const activityLabels = {
                    'very_high': '🚀 Очень активный',
                    'high': '🔥 Высокий',
                    'medium': '⚡ Средний',
                    'low': '💤 Низкий'
                };
                
                const activityColors = {
                    'very_high': 'bg-red-100 text-red-800',
                    'high': 'bg-orange-100 text-orange-800',
                    'medium': 'bg-yellow-100 text-yellow-800',
                    'low': 'bg-gray-100 text-gray-800'
                };
                
                return `
                    <tr class="hover:bg-gray-600 transition-colors duration-200">
                        <td class="px-4 py-3">
                            <div class="flex items-center space-x-3">
                                <div class="relative">
                                    <img src="${streamer.avatarUrl}" alt="${streamer.displayName}" class="w-12 h-12 rounded-full">
                                    ${streamer.isOnline ? '<div class="absolute -top-1 -right-1 w-4 h-4 bg-green-500 rounded-full border-2 border-gray-700"></div>' : ''}
                                </div>
                                <div>
                                    <div class="font-medium">${streamer.displayName}</div>
                                    <div class="text-sm text-gray-400">${streamer.followerCount.toLocaleString()} подписчиков</div>
                                    ${streamer.isOnline ? '<div class="text-xs text-green-400">🔴 В эфире</div>' : ''}
                                </div>
                            </div>
                        </td>
                        <td class="px-4 py-3">
                            <div class="flex flex-col">
                                <span class="text-lg font-bold">${streamer.giveawayCount}</span>
                                <span class="text-sm text-gray-400">${streamer.totalWinners} победителей</span>
                            </div>
                        </td>
                        <td class="px-4 py-3 text-sm">${formatDate(streamer.lastStreamDate)}</td>
                        <td class="px-4 py-3 text-sm">${formatDate(streamer.lastLoginDate)}</td>
                        <td class="px-4 py-3">
                            <span class="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium ${activityColors[streamer.activityLevel]}">
                                ${activityLabels[streamer.activityLevel]}
                            </span>
                        </td>
                        <td class="px-4 py-3">
                            <div class="flex justify-center space-x-2">
                                <button class="streamer-action-btn text-blue-400 hover:text-blue-300 p-1" data-action="stats" data-streamer-id="${streamer.id}" title="Статистика">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                        <path d="M18 20V10"></path>
                                        <path d="M12 20V4"></path>
                                        <path d="M6 20v-6"></path>
                                    </svg>
                                </button>
                                <button class="streamer-action-btn text-yellow-400 hover:text-yellow-300 p-1" data-action="ban" data-streamer-id="${streamer.id}" title="Бан/разбан">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                        <circle cx="12" cy="12" r="10"></circle>
                                        <path d="M4.93 4.93l14.14 14.14"></path>
                                    </svg>
                                </button>
                                <button class="streamer-action-btn text-red-400 hover:text-red-300 p-1" data-action="clear" data-streamer-id="${streamer.id}" title="Очистить розыгрыши">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                        <polyline points="3,6 5,6 21,6"></polyline>
                                        <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
                                    </svg>
                                </button>
                            </div>
                        </td>
                    </tr>
                `;
            }).join('');
            
            // Add event listeners to action buttons
            document.querySelectorAll('.streamer-action-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const action = this.dataset.action;
                    const streamerId = this.dataset.streamerId;
                    handleStreamerAction(action, streamerId);
                });
            });
        }
        
        // Update streamer statistics
        function updateStreamerStatistics() {
            if (!isBambooFury) return;
            
            const totalStreamers = registeredStreamers.length;
            const activeStreamers = registeredStreamers.filter(s => s.activityLevel === 'high' || s.activityLevel === 'very_high').length;
            const totalGiveaways = registeredStreamers.reduce((sum, s) => sum + s.giveawayCount, 0);
            const onlineStreamers = registeredStreamers.filter(s => s.isOnline).length;
            
            document.getElementById('totalStreamers').textContent = totalStreamers;
            document.getElementById('activeStreamers').textContent = activeStreamers;
            document.getElementById('totalStreamerGiveaways').textContent = totalGiveaways;
            document.getElementById('onlineStreamers').textContent = onlineStreamers;
        }
        
        // Render authorization log
        function renderAuthorizationLog() {
            if (!isBambooFury) return;
            
            const tableBody = document.getElementById('authLogTableBody');
            const startDate = document.getElementById('logStartDate').value;
            const endDate = document.getElementById('logEndDate').value;
            
            let filteredLog = [...authorizationLog];
            
            // Filter by date range
            if (startDate) {
                const start = new Date(startDate);
                filteredLog = filteredLog.filter(entry => entry.timestamp >= start);
            }
            
            if (endDate) {
                const end = new Date(endDate);
                end.setHours(23, 59, 59, 999); // End of day
                filteredLog = filteredLog.filter(entry => entry.timestamp <= end);
            }
            
            // Sort by most recent first
            filteredLog.sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));
            
            const actionColors = {
                'LOGIN': 'text-green-400',
                'LOGOUT': 'text-gray-400',
                'REGISTER': 'text-blue-400',
                'BLOCKED': 'text-red-400',
                'UNBLOCKED': 'text-yellow-400'
            };
            
            tableBody.innerHTML = filteredLog.map(entry => `
                <tr class="hover:bg-gray-600 transition-colors duration-200">
                    <td class="px-4 py-3 text-sm">${formatDateTime(entry.timestamp)}</td>
                    <td class="px-4 py-3">
                        <div class="flex flex-col">
                            <span class="font-medium">${entry.username}</span>
                            <span class="text-xs text-gray-400 font-mono">${entry.userId}</span>
                        </div>
                    </td>
                    <td class="px-4 py-3">
                        <span class="font-medium ${actionColors[entry.action] || 'text-white'}">${entry.action}</span>
                    </td>
                    <td class="px-4 py-3 font-mono text-sm">${entry.ipAddress}</td>
                    <td class="px-4 py-3 text-sm text-gray-400 max-w-xs truncate" title="${entry.userAgent}">${entry.userAgent}</td>
                </tr>
            `).join('');
        }
        
        // Handle user actions
        function handleUserAction(action, userId) {
            const user = registeredUsers.find(u => u.id === userId);
            if (!user) return;
            
            switch(action) {
                case 'view':
                    showUserProfile(user);
                    break;
                case 'block':
                    blockUser(user);
                    break;
                case 'unblock':
                    unblockUser(user);
                    break;
                case 'delete':
                    deleteUser(user);
                    break;
            }
        }
        
        // Handle streamer actions
        function handleStreamerAction(action, streamerId) {
            const streamer = registeredStreamers.find(s => s.id === streamerId);
            if (!streamer) return;
            
            switch(action) {
                case 'stats':
                    showStreamerStats(streamer);
                    break;
                case 'ban':
                    banStreamer(streamer);
                    break;
                case 'clear':
                    clearStreamerGiveaways(streamer);
                    break;
            }
        }
        
        // Show user profile
        function showUserProfile(user) {
            alert(`Профиль пользователя: ${user.displayName}\n\nID: ${user.id}\nЛогин: @${user.login}\nПодписчики: ${user.followerCount}\nРозыгрыши: ${user.giveawayCount}\nТип: ${user.userType}\nСтатус: ${user.status}\nПоследний вход: ${formatDateTime(user.lastSeen)}`);
        }
        
        // Block user
        function blockUser(user) {
            showConfirmationModal(
                `Заблокировать ${user.displayName}?`,
                `Пользователь не сможет участвовать в розыгрышах и будет исключен из чата.`,
                () => {
                    user.status = 'blocked';
                    authorizationLog.unshift({
                        timestamp: new Date(),
                        userId: user.id,
                        username: user.login,
                        action: 'BLOCKED',
                        ipAddress: user.ipAddress,
                        userAgent: 'Admin Action'
                    });
                    saveUserManagementData();
                    renderUsersTable();
                    showNotification(`${user.displayName} заблокирован`, 'success');
                }
            );
        }
        
        // Unblock user
        function unblockUser(user) {
            user.status = 'verified';
            authorizationLog.unshift({
                timestamp: new Date(),
                userId: user.id,
                username: user.login,
                action: 'UNBLOCKED',
                ipAddress: user.ipAddress,
                userAgent: 'Admin Action'
            });
            saveUserManagementData();
            renderUsersTable();
            showNotification(`${user.displayName} разблокирован`, 'success');
        }
        
        // Delete user
        function deleteUser(user) {
            showConfirmationModal(
                `Удалить ${user.displayName}?`,
                `Все данные пользователя будут удалены безвозвратно.`,
                () => {
                    const index = registeredUsers.findIndex(u => u.id === user.id);
                    if (index !== -1) {
                        registeredUsers.splice(index, 1);
                    }
                    saveUserManagementData();
                    renderUsersTable();
                    showNotification(`${user.displayName} удален`, 'success');
                }
            );
        }
        
        // Show streamer statistics
        function showStreamerStats(streamer) {
            alert(`Статистика стримера: ${streamer.displayName}\n\nПодписчики: ${streamer.followerCount.toLocaleString()}\nРозыгрыши: ${streamer.giveawayCount}\nПобедители: ${streamer.totalWinners}\nСредние зрители: ${streamer.avgViewers}\nПоследний стрим: ${formatDateTime(streamer.lastStreamDate)}\nАктивность: ${streamer.activityLevel}`);
        }
        
        // Ban streamer
        function banStreamer(streamer) {
            alert(`Функция бана для ${streamer.displayName} будет добавлена в следующем обновлении.`);
        }
        
        // Clear streamer giveaways
        function clearStreamerGiveaways(streamer) {
            showConfirmationModal(
                `Очистить все розыгрыши ${streamer.displayName}?`,
                `Все розыгрыши и данные участников будут удалены безвозвратно.`,
                () => {
                    streamer.giveawayCount = 0;
                    streamer.totalWinners = 0;
                    saveUserManagementData();
                    renderStreamersTable();
                    updateStreamerStatistics();
                    showNotification(`Розыгрыши ${streamer.displayName} очищены`, 'success');
                }
            );
        }
        
        // Format date for display
        function formatDate(date) {
            return new Date(date).toLocaleDateString('ru-RU', {
                year: 'numeric',
                month: '2-digit',
                day: '2-digit'
            });
        }
        
        // Format date and time for display
        function formatDateTime(date) {
            return new Date(date).toLocaleString('ru-RU', {
                year: 'numeric',
                month: '2-digit',
                day: '2-digit',
                hour: '2-digit',
                minute: '2-digit'
            });
        }
        
        // Export authorization log
        function exportAuthorizationLog() {
            const startDate = document.getElementById('logStartDate').value;
            const endDate = document.getElementById('logEndDate').value;
            
            let exportData = [...authorizationLog];
            
            // Filter by date range
            if (startDate) {
                const start = new Date(startDate);
                exportData = exportData.filter(entry => entry.timestamp >= start);
            }
            
            if (endDate) {
                const end = new Date(endDate);
                end.setHours(23, 59, 59, 999);
                exportData = exportData.filter(entry => entry.timestamp <= end);
            }
            
            // Convert to CSV
            const csvHeaders = ['Дата', 'Пользователь', 'ID', 'Действие', 'IP адрес', 'User Agent'];
            const csvRows = exportData.map(entry => [
                formatDateTime(entry.timestamp),
                entry.username,
                entry.userId,
                entry.action,
                entry.ipAddress,
                entry.userAgent
            ]);
            
            const csvContent = [csvHeaders, ...csvRows]
                .map(row => row.map(field => `"${field}"`).join(','))
                .join('\n');
            
            // Download CSV
            const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            const url = URL.createObjectURL(blob);
            link.setAttribute('href', url);
            link.setAttribute('download', `auth_log_${new Date().toISOString().split('T')[0]}.csv`);
            link.style.visibility = 'hidden';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
            showNotification('Лог авторизаций экспортирован', 'success');
        }
        
        // Update timeout duration when settings change
        function updateTimeoutDuration() {
            console.log('Обновление длительности тайм-аута:', channelSettings.timeoutDuration, 'минут');
            
            // Update any active timers or UI that depends on this setting
            if (typeof window.currentModerationTimeout !== 'undefined') {
                window.currentModerationTimeout = channelSettings.timeoutDuration;
            }
        }
        
        // Update response timeout when settings change
        function updateResponseTimeout() {
            console.log('Обновление таймера ответа победителя:', channelSettings.responseTimeout, 'секунд');
            
            // Update the winner timer if it's currently running
            if (winnerTimer && !winnerHasResponded) {
                const newTimeout = channelSettings.responseTimeout;
                if (winnerTimeLeft > newTimeout) {
                    winnerTimeLeft = newTimeout;
                    updateWinnerTimer();
                }
            }
        }
        
        // Add user to system (for real user tracking)
        function addUserToSystem(username, userData) {
            if (!isBambooFury || !username) return;
            
            // Check if user already exists
            const existingUser = registeredUsers.find(u => u.login.toLowerCase() === username.toLowerCase());
            if (existingUser) {
                // Update last seen - keep existing IP for consistency
                existingUser.lastSeen = new Date();
                
                // Only update IP if the user doesn't have one or it's invalid
                if (!existingUser.ipAddress || existingUser.ipAddress === 'unknown' || existingUser.ipAddress === 'N/A') {
                    existingUser.ipAddress = userData.ipAddress || getUserIP(userData.id, username);
                }
                
                saveUserManagementData();
                return;
            }
            
            // Generate consistent IP address for new user
            const ipAddress = userData.ipAddress || getUserIP(userData.id, username);
            
            // Add new user
            const newUser = {
                id: userData.id || Date.now().toString(),
                login: userData.login || username.toLowerCase(),
                displayName: userData.displayName || username,
                avatarUrl: userData.avatarUrl || `https://ui-avatars.com/api/?name=${encodeURIComponent(username)}&background=9146FF&color=fff&size=50`,
                joinDate: userData.joinDate || new Date(),
                lastSeen: new Date(),
                ipAddress: ipAddress,
                userType: userData.userType || 'viewer',
                status: userData.status || 'verified',
                followerCount: userData.followerCount || 0,
                giveawayCount: userData.giveawayCount || 0
            };
            
            registeredUsers.push(newUser);
            
            // Log the registration
            authorizationLog.unshift({
                timestamp: new Date(),
                userId: newUser.id,
                username: newUser.login,
                action: 'REGISTER',
                ipAddress: newUser.ipAddress,
                userAgent: navigator.userAgent || 'Unknown'
            });
            
            saveUserManagementData();
            console.log('Добавлен новый пользователь с IP:', newUser.ipAddress, newUser);
        }
        
        // Track user participation in giveaways
        function trackUserParticipation(username, userId, giveawayId) {
            if (!isBambooFury) return;
            
            // Add user to system if not exists with consistent IP tracking
            addUserToSystem(username, {
                id: userId,
                login: username.toLowerCase(),
                displayName: username,
                userType: 'viewer',
                status: 'verified',
                ipAddress: getUserIP(userId, username)
            });
            
            // Update user's giveaway count
            const user = registeredUsers.find(u => u.login.toLowerCase() === username.toLowerCase());
            if (user) {
                user.giveawayCount = (user.giveawayCount || 0) + 1;
                user.lastSeen = new Date();
                saveUserManagementData();
            }
        }
        
        // Show confirmation modal
        function showConfirmationModal(title, message, onConfirm) {
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-90 z-50 flex items-center justify-center p-4 confirm-modal';
            
            modal.innerHTML = `
                <div class="bg-gray-800 rounded-xl max-w-md w-full p-6 border border-gray-600 neon-border confirm-modal-content">
                    <div class="flex items-center space-x-3 mb-4">
                        <div class="w-10 h-10 rounded-full bg-red-600 bg-opacity-20 flex items-center justify-center">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="#EF4444" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <path d="M3 6h18"></path>
                                <path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"></path>
                                <path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"></path>
                                <line x1="10" y1="11" x2="10" y2="17"></line>
                                <line x1="14" y1="11" x2="14" y2="17"></line>
                            </svg>
                        </div>
                        <h3 class="text-xl font-bold text-white">${title}</h3>
                    </div>
                    
                    <p class="text-gray-300 mb-6">${message}</p>
                    
                    <div class="flex space-x-3">
                        <button class="cancel-btn flex-1 bg-gray-700 hover:bg-gray-600 text-white px-4 py-2 rounded-lg transition-all duration-200">
                            Отмена
                        </button>
                        <button class="confirm-btn flex-1 bg-red-600 hover:bg-red-500 text-white px-4 py-2 rounded-lg transition-all duration-200 transform hover:scale-105 relative overflow-hidden">
                            <span class="relative z-10">Удалить</span>
                            <div class="absolute inset-0 bg-gradient-to-r from-transparent via-white/20 to-transparent transform -skew-x-12 translate-x-[-100%] transition-transform duration-700 hover:translate-x-[100%]"></div>
                        </button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
            
            // Add event listeners
            const cancelBtn = modal.querySelector('.cancel-btn');
            const confirmBtn = modal.querySelector('.confirm-btn');
            
            const closeModal = () => {
                modal.style.animation = 'modalFadeOut 0.3s ease-in forwards';
                setTimeout(() => {
                    document.body.removeChild(modal);
                }, 300);
            };
            
            cancelBtn.addEventListener('click', closeModal);
            
            confirmBtn.addEventListener('click', () => {
                onConfirm();
                closeModal();
            });
            
            // Close on background click
            modal.addEventListener('click', (e) => {
                if (e.target === modal) {
                    closeModal();
                }
            });
            
            // Close on Escape key
            const handleEscape = (e) => {
                if (e.key === 'Escape') {
                    closeModal();
                    document.removeEventListener('keydown', handleEscape);
                }
            };
            document.addEventListener('keydown', handleEscape);
        }
        
        // Clear data function (for manual cleanup)
        function clearAllSavedData() {
            if (!twitchChannel) return;
            
            localStorage.removeItem(`bamboofury_winners_${twitchChannel}`);
            localStorage.removeItem(`bamboofury_giveaways_${twitchChannel}`);
            localStorage.removeItem(`bamboofury_participants_${twitchChannel}`);
            
            recentWinners = [];
            activeGiveaways = [];
            giveawayParticipants = {};
            
            renderActiveGiveaways();
            renderRecentWinners();
            
            showNotification('Все сохраненные данные очищены', 'success');
        }

        // Add keyboard shortcut for clearing data (Ctrl+Shift+C)
        document.addEventListener('keydown', (e) => {
            if (e.ctrlKey && e.shiftKey && e.key === 'C' && isAuthenticated) {
                if (confirm('Очистить все сохраненные данные? Это действие нельзя отменить.')) {
                    clearAllSavedData();
                }
            }
        });

        // Initialize on page load
        window.addEventListener('load', () => {
            // Load global settings FIRST, before auth
            loadGlobalSettings();
            
            checkAuth();
            
            // Add event listener for clear winners button
            document.getElementById('clearWinnersBtn')?.addEventListener('click', clearWinnersHistory);
            
            // Add event listeners for channel settings (BambooFury only)
            const usernameBtn = document.getElementById('username');
            const ownerDropdown = document.getElementById('ownerSettingsDropdown');
            const channelSettingsBtn = document.getElementById('channelSettingsBtn');
            const channelSettingsModal = document.getElementById('channelSettingsModal');
            const closeChannelSettingsModal = document.getElementById('closeChannelSettingsModal');
            const saveChannelSettingsBtn = document.getElementById('saveChannelSettings');
            const resetChannelSettingsBtn = document.getElementById('resetChannelSettings');
            const exportDataBtn = document.getElementById('exportDataBtn');
            const clearAllDataBtn = document.getElementById('clearAllDataBtn');
            
            // User management elements
            const userManagementBtn = document.getElementById('userManagementBtn');
            const userManagementModal = document.getElementById('userManagementModal');
            const closeUserManagementModal = document.getElementById('closeUserManagementModal');
            
            // Tab elements
            const usersTab = document.getElementById('usersTab');
            const streamersTab = document.getElementById('streamersTab');
            const notificationsTab = document.getElementById('notificationsTab');
            
            const usersContent = document.getElementById('usersContent');
            const streamersContent = document.getElementById('streamersContent');
            const notificationsContent = document.getElementById('notificationsContent');
            
            // Search and filter elements
            const userSearch = document.getElementById('userSearch');
            const userSortBy = document.getElementById('userSortBy');
            const userFilterStatus = document.getElementById('userFilterStatus');
            
            const streamerSearch = document.getElementById('streamerSearch');
            const streamerSortBy = document.getElementById('streamerSortBy');
            const streamerFilterActivity = document.getElementById('streamerFilterActivity');
            
            const exportLogBtn = document.getElementById('exportLogBtn');
            
            // Username click handler
            usernameBtn?.addEventListener('click', (e) => {
                e.stopPropagation();
                if (isBambooFury) {
                    if (ownerDropdown.classList.contains('hidden')) {
                        // Create a new high-level container for dropdown
                        let dropdownContainer = document.getElementById('dropdown-container');
                        if (!dropdownContainer) {
                            dropdownContainer = document.createElement('div');
                            dropdownContainer.id = 'dropdown-container';
                            dropdownContainer.className = 'owner-dropdown-container';
                            dropdownContainer.style.cssText = `
                                position: fixed !important;
                                top: 0 !important;
                                left: 0 !important;
                                width: 100vw !important;
                                height: 100vh !important;
                                z-index: 100000 !important;
                                pointer-events: none !important;
                            `;
                            document.body.appendChild(dropdownContainer);
                        }
                        
                        // Position dropdown relative to button
                        const rect = usernameBtn.getBoundingClientRect();
                        
                        // Remove dropdown from current position and add to container
                        ownerDropdown.remove();
                        dropdownContainer.appendChild(ownerDropdown);
                        
                        // Position and show dropdown
                        ownerDropdown.style.cssText = `
                            position: absolute !important;
                            top: ${rect.bottom + 8}px !important;
                            right: ${window.innerWidth - rect.right}px !important;
                            left: auto !important;
                            z-index: 100001 !important;
                            background: rgba(31, 41, 55, 0.98) !important;
                            backdrop-filter: blur(15px) !important;
                            border: 2px solid rgba(147, 51, 234, 0.8) !important;
                            box-shadow: 0 20px 50px rgba(0, 0, 0, 0.8), 0 0 0 1px rgba(147, 51, 234, 0.5) !important;
                            border-radius: 0.5rem !important;
                            min-width: 12rem !important;
                            pointer-events: auto !important;
                        `;
                        ownerDropdown.classList.remove('hidden');
                    } else {
                        ownerDropdown.classList.add('hidden');
                        // Clean up container
                        const dropdownContainer = document.getElementById('dropdown-container');
                        if (dropdownContainer) {
                            dropdownContainer.remove();
                        }
                    }
                }
            });
            
            // Close dropdown when clicking outside
            document.addEventListener('click', (e) => {
                if (!usernameBtn?.contains(e.target) && !ownerDropdown?.contains(e.target)) {
                    ownerDropdown?.classList.add('hidden');
                    // Clean up container
                    const dropdownContainer = document.getElementById('dropdown-container');
                    if (dropdownContainer) {
                        dropdownContainer.remove();
                    }
                }
            });
            
            // Channel settings modal handlers
            channelSettingsBtn?.addEventListener('click', () => {
                ownerDropdown?.classList.add('hidden');
                // Clean up dropdown container
                const dropdownContainer = document.getElementById('dropdown-container');
                if (dropdownContainer) {
                    dropdownContainer.remove();
                }
                
                console.log('Открытие модала настроек канала');
                channelSettingsModal?.classList.remove('hidden');
                
                // Ensure settings are loaded and applied
                setTimeout(() => {
                    console.log('Применение настроек к модалу:', channelSettings);
                    loadChannelSettings(); // Reload from localStorage
                    applyChannelSettingsToUI();
                    updateChannelStatistics();
                }, 50);
            });
            
            closeChannelSettingsModal?.addEventListener('click', () => {
                channelSettingsModal?.classList.add('hidden');
            });
            
            // Settings buttons
            saveChannelSettingsBtn?.addEventListener('click', () => {
                console.log('Кнопка сохранения настроек нажата');
                collectChannelSettingsFromUI();
                saveChannelSettings();
            });
            
            // Auto-save settings when they change
            const settingsInputs = [
                'autoAnnounce', 'soundNotifications', 'responseTimeout', 
                'autoModeration', 'timeoutDuration', 'bannedWords', 
                'maxParticipants', 'minFollowDays', 'followersOnly'
            ];
            
            settingsInputs.forEach(inputId => {
                const element = document.getElementById(inputId);
                if (element) {
                    const eventType = element.type === 'checkbox' ? 'change' : 'input';
                    element.addEventListener(eventType, () => {
                        if (isBambooFury) {
                            console.log(`Настройка ${inputId} изменена, автосохранение...`);
                            setTimeout(() => {
                                collectChannelSettingsFromUI();
                                saveChannelSettings();
                            }, 100);
                        }
                    });
                }
            });
            
            resetChannelSettingsBtn?.addEventListener('click', () => {
                if (confirm('Сбросить настройки к значениям по умолчанию?')) {
                    console.log('Сброс настроек к умолчанию');
                    channelSettings = {
                        autoAnnounce: true,
                        soundNotifications: false,
                        responseTimeout: 60,
                        autoModeration: false,
                        timeoutDuration: 10,
                        bannedWords: [],
                        maxParticipants: 1000,
                        minFollowDays: 0,
                        followersOnly: false
                    };
                    
                    // Apply to UI and save
                    setTimeout(() => {
                        applyChannelSettingsToUI();
                        saveChannelSettings();
                        updateTimeoutDuration();
                        updateResponseTimeout();
                        showNotification('Настройки сброшены и сохранены!', 'success');
                    }, 100);
                }
            });
            
            exportDataBtn?.addEventListener('click', exportChannelData);
            clearAllDataBtn?.addEventListener('click', clearAllChannelData);
            
            // User management handlers
            userManagementBtn?.addEventListener('click', () => {
                ownerDropdown?.classList.add('hidden');
                // Clean up dropdown container
                const dropdownContainer = document.getElementById('dropdown-container');
                if (dropdownContainer) {
                    dropdownContainer.remove();
                }
                
                if (isBambooFury) {
                    initializeUserManagementData();
                    userManagementModal?.classList.remove('hidden');
                    
                    // Apply saved settings after a short delay
                    setTimeout(() => {
                        applyUserManagementSettingsToUI();
                        renderUsersTable();
                        updateStreamerStatistics();
                        renderAuthorizationLog();
                    }, 100);
                }
            });
            
            closeUserManagementModal?.addEventListener('click', () => {
                // Save settings before closing
                collectUserManagementSettingsFromUI();
                saveUserManagementData();
                userManagementModal?.classList.add('hidden');
            });
            
            // Tab switching
            usersTab?.addEventListener('click', () => {
                // Save current settings before switching
                collectUserManagementSettingsFromUI();
                userManagementSettings.activeTab = 'users';
                saveUserManagementData();
                
                // Update tab styles
                document.querySelectorAll('#userManagementModal button[id$="Tab"]').forEach(tab => {
                    tab.className = 'flex-1 px-4 py-2 rounded-lg transition-all duration-200 text-gray-300 hover:text-white hover:bg-gray-600';
                });
                usersTab.className = 'flex-1 px-4 py-2 rounded-lg transition-all duration-200 bg-blue-600 text-white';
                
                // Show/hide content
                usersContent?.classList.remove('hidden');
                streamersContent?.classList.add('hidden');
                notificationsContent?.classList.add('hidden');
                
                renderUsersTable();
            });
            
            streamersTab?.addEventListener('click', () => {
                // Save current settings before switching
                collectUserManagementSettingsFromUI();
                userManagementSettings.activeTab = 'streamers';
                saveUserManagementData();
                
                // Update tab styles
                document.querySelectorAll('#userManagementModal button[id$="Tab"]').forEach(tab => {
                    tab.className = 'flex-1 px-4 py-2 rounded-lg transition-all duration-200 text-gray-300 hover:text-white hover:bg-gray-600';
                });
                streamersTab.className = 'flex-1 px-4 py-2 rounded-lg transition-all duration-200 bg-blue-600 text-white';
                
                // Show/hide content
                usersContent?.classList.add('hidden');
                streamersContent?.classList.remove('hidden');
                notificationsContent?.classList.add('hidden');
                
                renderStreamersTable();
                updateStreamerStatistics();
            });
            
            notificationsTab?.addEventListener('click', () => {
                // Save current settings before switching
                collectUserManagementSettingsFromUI();
                userManagementSettings.activeTab = 'notifications';
                saveUserManagementData();
                
                // Update tab styles
                document.querySelectorAll('#userManagementModal button[id$="Tab"]').forEach(tab => {
                    tab.className = 'flex-1 px-4 py-2 rounded-lg transition-all duration-200 text-gray-300 hover:text-white hover:bg-gray-600';
                });
                notificationsTab.className = 'flex-1 px-4 py-2 rounded-lg transition-all duration-200 bg-blue-600 text-white';
                
                // Show/hide content
                usersContent?.classList.add('hidden');
                streamersContent?.classList.add('hidden');
                notificationsContent?.classList.remove('hidden');
                
                renderAuthorizationLog();
            });
            
            // Search and filter handlers with auto-save
            userSearch?.addEventListener('input', () => {
                userManagementSettings.userSearch = userSearch.value;
                saveUserManagementData();
                renderUsersTable();
            });
            userSortBy?.addEventListener('change', () => {
                userManagementSettings.userSortBy = userSortBy.value;
                saveUserManagementData();
                renderUsersTable();
            });
            userFilterStatus?.addEventListener('change', () => {
                userManagementSettings.userFilterStatus = userFilterStatus.value;
                saveUserManagementData();
                renderUsersTable();
            });
            
            streamerSearch?.addEventListener('input', () => {
                userManagementSettings.streamerSearch = streamerSearch.value;
                saveUserManagementData();
                renderStreamersTable();
            });
            streamerSortBy?.addEventListener('change', () => {
                userManagementSettings.streamerSortBy = streamerSortBy.value;
                saveUserManagementData();
                renderStreamersTable();
            });
            streamerFilterActivity?.addEventListener('change', () => {
                userManagementSettings.streamerFilterActivity = streamerFilterActivity.value;
                saveUserManagementData();
                renderStreamersTable();
            });
            
            // Date filter handlers with auto-save
            document.getElementById('logStartDate')?.addEventListener('change', () => {
                userManagementSettings.logStartDate = document.getElementById('logStartDate').value;
                saveUserManagementData();
                renderAuthorizationLog();
            });
            document.getElementById('logEndDate')?.addEventListener('change', () => {
                userManagementSettings.logEndDate = document.getElementById('logEndDate').value;
                saveUserManagementData();
                renderAuthorizationLog();
            });
            
            // Notification settings auto-save
            document.getElementById('newStreamerNotifications')?.addEventListener('change', () => {
                notificationSettings.newStreamerNotifications = document.getElementById('newStreamerNotifications').checked;
                saveUserManagementData();
            });
            document.getElementById('emailReports')?.addEventListener('change', () => {
                notificationSettings.emailReports = document.getElementById('emailReports').checked;
                saveUserManagementData();
            });
            document.getElementById('discordNotifications')?.addEventListener('change', () => {
                notificationSettings.discordNotifications = document.getElementById('discordNotifications').checked;
                saveUserManagementData();
            });
            document.getElementById('reportEmail')?.addEventListener('input', () => {
                notificationSettings.reportEmail = document.getElementById('reportEmail').value;
                saveUserManagementData();
            });
            document.getElementById('discordWebhook')?.addEventListener('input', () => {
                notificationSettings.discordWebhook = document.getElementById('discordWebhook').value;
                saveUserManagementData();
            });
            
            // Export log handler
            exportLogBtn?.addEventListener('click', exportAuthorizationLog);
            
            // Global Settings Modal Handlers
            const globalSettingsBtn = document.getElementById('globalSettingsBtn');
            const globalSettingsModal = document.getElementById('globalSettingsModal');
            const closeGlobalSettingsModal = document.getElementById('closeGlobalSettingsModal');
            const saveGlobalSettingsBtn = document.getElementById('saveGlobalSettings');
            const resetGlobalSettingsBtn = document.getElementById('resetGlobalSettings');
            const clearGiveawayHistoryBtn = document.getElementById('clearGiveawayHistory');
            const deleteAccountBtn = document.getElementById('deleteAccountBtn');
            const reportBugBtn = document.getElementById('reportBugBtn');
            
            // Language buttons
            const langEN = document.getElementById('langEN');
            const langRU = document.getElementById('langRU');
            const langUA = document.getElementById('langUA');
            
            // Open global settings modal
            globalSettingsBtn?.addEventListener('click', () => {
                globalSettingsModal?.classList.remove('hidden');
                applyGlobalSettingsToUI();
            });
            
            // Close global settings modal
            closeGlobalSettingsModal?.addEventListener('click', () => {
                globalSettingsModal?.classList.add('hidden');
            });
            
            // Save global settings
            saveGlobalSettingsBtn?.addEventListener('click', () => {
                collectGlobalSettingsFromUI();
                saveGlobalSettings();
            });
            
            // Reset global settings
            resetGlobalSettingsBtn?.addEventListener('click', () => {
                if (confirm('Сбросить все настройки к значениям по умолчанию?')) {
                    globalSettings = {
                        hideUsernames: false,
                        hideAvatars: false,
                        language: 'ru',
                        hideMyUsername: false,
                        disableStatistics: false,
                        registrationDate: globalSettings.registrationDate || '2025-07-06'
                    };
                    applyGlobalSettingsToUI();
                    saveGlobalSettings();
                    showNotification('Настройки сброшены!', 'success');
                }
            });
            
            // Language selection
            langEN?.addEventListener('click', (e) => {
                e.preventDefault();
                console.log('Переключение на английский язык');
                globalSettings.language = 'en';
                
                // Сразу обновляем UI
                updateLanguageButtons('en');
                applyLanguageToInterface();
                
                // Сохраняем настройки
                saveGlobalSettings();
                showNotification(t('languageChanged') + ' - English', 'success');
            });
            
            langRU?.addEventListener('click', (e) => {
                e.preventDefault();
                console.log('Переключение на русский язык');
                globalSettings.language = 'ru';
                
                // Сразу обновляем UI
                updateLanguageButtons('ru');
                applyLanguageToInterface();
                
                // Сохраняем настройки
                saveGlobalSettings();
                showNotification(t('languageChanged') + ' - Русский', 'success');
            });
            
            langUA?.addEventListener('click', (e) => {
                e.preventDefault();
                console.log('Переключение на украинский язык');
                globalSettings.language = 'ua';
                
                // Сразу обновляем UI
                updateLanguageButtons('ua');
                applyLanguageToInterface();
                
                // Сохраняем настройки
                saveGlobalSettings();
                showNotification(t('languageChanged') + ' - Українська', 'success');
            });
            
            // Auto-save settings when they change
            const globalSettingsInputs = [
                'hideUsernames', 'hideAvatars', 'hideMyUsername', 'disableStatistics'
            ];
            
            globalSettingsInputs.forEach(inputId => {
                const element = document.getElementById(inputId);
                if (element) {
                    element.addEventListener('change', () => {
                        setTimeout(() => {
                            collectGlobalSettingsFromUI();
                            saveGlobalSettings();
                        }, 100);
                    });
                }
            });
            
            // Action buttons
            clearGiveawayHistoryBtn?.addEventListener('click', clearGiveawayHistory);
            deleteAccountBtn?.addEventListener('click', deleteAccount);
            reportBugBtn?.addEventListener('click', reportBugOrIdea);
        });

        // Save data before page unload
        window.addEventListener('beforeunload', () => {
            if (twitchChannel) {
                saveData();
            }
        });
    </script>
</body>
</html>